<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ArtÄ±Bir BÃ¼tÃ¼nsel Sistem DenetÃ§isi - v6.0</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #090a0f;
        --card: #14161f;
        --accent: #6366f1;
        --accent-soft: rgba(99, 102, 241, 0.1);
        --text: #ffffff;
        --text-dim: #94a3b8;
        --border: rgba(255, 255, 255, 0.08);
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Outfit", sans-serif;
      }
      body {
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(9, 10, 15, 0.8);
        backdrop-filter: blur(20px);
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo h1 {
        font-size: 1.2rem;
        font-weight: 800;
        letter-spacing: 1px;
        color: #fff;
      }
      .logo span {
        color: var(--accent);
      }

      .container {
        max-width: 900px;
        margin: 2rem auto;
        padding-bottom: 5rem;
      }

      /* Accordion Style from User Reference */
      .accordion {
        border-radius: 8px;
        overflow: hidden;
      }

      .acc-item {
        border-bottom: 1px solid var(--border);
        background: var(--bg);
        transition: 0.3s;
      }

      .acc-header {
        padding: 1.2rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        user-select: none;
      }

      .acc-header:hover {
        background: rgba(255, 255, 255, 0.02);
      }
      .acc-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: #eee;
      }
      .acc-icon {
        font-size: 0.8rem;
        opacity: 0.5;
        transition: 0.3s;
      }

      .acc-content {
        max-height: 0;
        overflow: hidden;
        background: #0d0f17;
        transition: max-height 0.5s cubic-bezier(0, 1, 0, 1);
      }

      .acc-item.active .acc-content {
        max-height: 2000px;
        transition: max-height 1s ease-in;
      }

      .acc-item.active .acc-icon {
        transform: rotate(180deg);
        opacity: 1;
        color: var(--accent);
      }

      .inner-box {
        padding: 2rem;
      }

      /* Detail Elements */
      .grid-detail {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .info-block {
        padding: 1.2rem;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--border);
        border-radius: 12px;
      }
      .info-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        color: var(--accent);
        font-weight: 700;
        margin-bottom: 0.8rem;
        letter-spacing: 1px;
      }

      .check-item {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
        font-size: 0.85rem;
      }
      .ok {
        color: var(--success);
      }
      .warn {
        color: var(--warning);
      }
      .err {
        color: var(--error);
      }

      .code-box {
        background: #05060a;
        padding: 1.2rem;
        border-radius: 10px;
        font-family: "Fira Code", monospace;
        font-size: 0.75rem;
        overflow-x: auto;
        border: 1px solid var(--border);
        color: #cbd5e1;
        margin-top: 1rem;
        position: relative;
      }

      .tag {
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.65rem;
        font-weight: 700;
        background: var(--accent-soft);
        color: var(--accent);
        margin-right: 5px;
      }

      #loader {
        position: fixed;
        inset: 0;
        background: var(--bg);
        z-index: 2000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .spin {
        width: 30px;
        height: 30px;
        border: 2px solid var(--accent-soft);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: s 0.8s linear infinite;
      }
      @keyframes s {
        to {
          transform: rotate(360deg);
        }
      }

      .nav-link {
        color: var(--text-dim);
        text-decoration: none;
        font-size: 0.8rem;
        padding: 0.5rem 1rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        transition: 0.2s;
      }
      .nav-link:hover {
        color: #fff;
        border-color: var(--accent);
      }
    </style>
  </head>
  <body>
    <div id="loader">
      <div class="spin"></div>
      <p style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-dim)">
        SÄ°STEM ANALÄ°Z EDÄ°LÄ°YOR...
      </p>
    </div>

    <header>
      <div class="logo">
        <h1>ARTIBÄ°R <span>SÄ°STEM DENETÃ‡Ä°SÄ°</span></h1>
      </div>
      <div style="display: flex; gap: 10px">
        <a href="/admin" class="nav-link">ğŸ“Š Veri YÃ¶netimine Git</a>
        <div
          id="status-tag"
          class="tag"
          style="background: var(--success) 20; color: var(--success)"
        >
          SÄ°STEM AKTÄ°F
        </div>
      </div>
    </header>

    <div class="container" id="main-accordion">
      <!-- Categories will be injected here -->
    </div>

    <script>
      let dbData = null;

      async function init() {
          try {
              const res = await fetch('/data/master_backend_snapshot.json');
              dbData = await res.json();
              document.getElementById('loader').style.display = 'none';
              renderAccordion();
          } catch (e) {
              document.getElementById('loader').innerHTML = `<p style="color:var(--error)">Veri HatasÄ±: Snapshot bulunamadÄ±.</p>`;
          }
      }

      const categories = [
          { id: "users", title: "Users (KullanÄ±cÄ± YÃ¶netimi)", status: "Ã–nemli" },
          { id: "auth", title: "Authentication (Kimlik DoÄŸrulama)", status: "Kritik" },
          { id: "events", title: "Events (Etkinlik Sistemi)", status: "Aktif" },
          { id: "chat", title: "Chat (MesajlaÅŸma & Åifreleme)", status: "GÃ¼venli" },
          { id: "location", title: "Location (Konum Servisleri)", status: "Aktif" },
          { id: "wallet", title: "Wallet & Payments (CÃ¼zdan & Ã–demeler)", status: "Aktif" },
          { id: "discipline", title: "Discipline & Reporting (Moderasyon)", status: "Aktif" },
          { id: "gamification", title: "Gamification & Badges (OyunlaÅŸtÄ±rma)", status: "GeliÅŸiyor" },
          { id: "settings", title: "User Settings & Privacy (Gizlilik)", status: "GÃ¼venli" },
          { id: "history", title: "User Activity & History (Ä°ÅŸlem GeÃ§miÅŸi)", status: "Aktif" },
          { id: "support", title: "Support & Help (Destek Sistemi)", status: "Aktif" },
          { id: "marketplace", title: "Marketplace (Pazar Yeri Mimarisi)", status: "Aktif" },
          { id: "reviews", title: "Reviews (DeÄŸerlendirmeler)", status: "Aktif" },
          { id: "venues", title: "Venues (Mekan YÃ¶netimi)", status: "Aktif" },
          { id: "interactions", title: "Interactions (BuzkÄ±ran & Sesli)", status: "Aktif" },
          { id: "tracking", title: "Live Tracking (Uber Modu)", status: "Aktif" },
          { id: "media", title: "Media (Medya Ä°ÅŸleme)", status: "Aktif" },
          { id: "notifications", title: "Notifications (Bildirimler)", status: "Aktif" },
          { id: "participation", title: "Event Participation (KatÄ±lÄ±m Takibi)", status: "Aktif" },
          { id: "clubs", title: "Clubs & Societies (KulÃ¼p YÃ¶netimi)", status: "Yeni" },
          { id: "social", title: "Social & Friends (Sosyal EtkileÅŸim)", status: "Yeni" },
          { id: "intelligence", title: "AI & Intelligence (Yapay Zeka)", status: "Yeni" }
      ];

      function renderAccordion() {
          const container = document.getElementById('main-accordion');
          container.innerHTML = categories.map(cat => `
              <div class="acc-item" id="item-${cat.id}">
                  <div class="acc-header" onclick="toggleAcc('${cat.id}')">
                      <span class="acc-title">${cat.title}</span>
                      <div style="display:flex; align-items:center; gap:20px;">
                          <span style="font-size:0.7rem; color:var(--text-dim)">${cat.status}</span>
                          <span class="acc-icon">â–¼</span>
                      </div>
                  </div>
                  <div class="acc-content">
                      <div class="inner-box">
                          ${getFragment(cat.id)}
                      </div>
                  </div>
              </div>
          `).join('');
      }

      function toggleAcc(id) {
          const item = document.getElementById(`item-${id}`);
          const isActive = item.classList.contains('active');
          document.querySelectorAll('.acc-item').forEach(el => el.classList.remove('active'));
          if(!isActive) item.classList.add('active');
      }

      function getFragment(id) {
          const analysis = {
              "users": {
                  desc: "Sistemin temelini oluÅŸturan Ã¶ÄŸrenci verileri ve profil yÃ¶netimi.",
                  checks: [
                      { m: "E-posta formatÄ± (.edu.tr zorunluluÄŸu)", s: "ok" },
                      { m: "Åifreleme (Bcrypt 12 Rounds)", s: "ok" },
                      { m: "Profil FotoÄŸrafÄ± Depolama", s: "ok" },
                      { m: "Hata Tespiti: .com uzantÄ±lÄ± Ã¶rnekler temizlendi mi?", s: "warn" }
                  ],
                  details: "KullanÄ±cÄ± tablosu " + dbData.database.users.row_count + " kayÄ±t iÃ§eriyor. .edu.tr kontrolÃ¼ schemas.py iÃ§erisinde Pydantic validator ile yapÄ±lÄ±yor.",
                  code: `class UserLogin(BaseModel):\n    email: EmailStr = Field(..., examples=["ogrenci@universite.edu.tr"])\n    # Validator: if not v.endswith('.edu.tr'): raise ValueError`
              },
              "auth": {
                  desc: "GÃ¼venli giriÅŸ, token Ã¼retimi ve oturum yÃ¶netimi sÃ¼reÃ§leri.",
                  checks: [
                      { m: "JWT Token Ãœretimi (HS256)", s: "ok" },
                      { m: "Rate Limiting (Dakikada 5 istek)", s: "ok" },
                      { m: "Åifre SÄ±fÄ±rlama (OTP via Mail)", s: "ok" },
                      { m: "2FA (Ä°ki FaktÃ¶rlÃ¼ DoÄŸrulama)", s: "err" }
                  ],
                  details: "GiriÅŸ iÅŸlemlerirouters/auth.py Ã¼zerinden yÃ¶netilir. GÃ¼venlik ayarlarÄ± security.py iÃ§indedir.",
                  code: `@router.post("/login")\ndef login(user_data: schemas.UserLogin):\n    # KullanÄ±cÄ± doÄŸrulanÄ±r ve JWT Ã¼retilir.`
              },
              "events": {
                  desc: "KampÃ¼s etkinlikleri, katÄ±lÄ±m ve konum bazlÄ± listeleme.",
                  checks: [
                      { m: "Konum BazlÄ± Filtreleme (Spatial)", s: "ok" },
                      { m: "Kategori BazlÄ± Gruplama", s: "ok" },
                      { m: "Otomatik Zaman KontrolÃ¼", s: "ok" }
                  ],
                  details: "Etkinlikler tablosu " + dbData.database.events.row_count + " aktif kayÄ±t barÄ±ndÄ±rÄ±yor.",
                  code: `def get_nearby_events(db, lat, lon, radius):\n    # Bounding Box yÃ¶ntemi ile yakÄ±nlÄ±k hesabÄ±.`
              },
              "chat": {
                  desc: "KullanÄ±cÄ±lar arasÄ± gÃ¼venli, ÅŸifreli anlÄ±k iletiÅŸim.",
                  checks: [
                      { m: "Mesaj Åifreleme (AES-256)", s: "ok" },
                      { m: "GeÃ§miÅŸ Mesaj YÃ¼kleme", s: "ok" },
                      { m: "Dosya/Resim GÃ¶nderimi", s: "warn" }
                  ],
                  details: "Mesajlar gÃ¶nderilmeden Ã¶nce sistem tarafÄ±nda ÅŸifrelenir ve DB'de 'content' kolonunda binary/encrypted tutulur.",
                  code: `def create_message(db, message):\n    encrypted = encryption.encrypt(message.content)`
              },
              "clubs": {
                  desc: "Ãœniversite topluluklarÄ± ve resmi kulÃ¼plerin yÃ¶netim sistemi.",
                  checks: [
                      { m: "Resmi KulÃ¼p OnayÄ±", s: "ok" },
                      { m: "Ãœyelik & Rol YÃ¶netimi", s: "ok" },
                      { m: "KulÃ¼p Etkinlikleri Entegrasyonu", s: "ok" }
                  ],
                  details: "KulÃ¼pler ve Ã¼yelikler veritabanÄ±ndaki 'clubs' ve 'club_members' tablolarÄ± Ã¼zerinden yÃ¶netilir.",
                  code: `@router.post("/{club_id}/join")\ndef join_club(club_id, db, user):\n    # Ãœyelik kaydÄ± oluÅŸturulur.`
              },
              "social": {
                  desc: "KullanÄ±cÄ±lar arasÄ± arkadaÅŸlÄ±k baÄŸlarÄ± ve etkinliklerdeki anlÄ±k paylaÅŸÄ±mlar (Momentler).",
                  checks: [
                      { m: "Simetrik ArkadaÅŸlÄ±k Sistemi", s: "ok" },
                      { m: "Etkinlik Momentleri (24 Saat)", s: "ok" },
                      { m: "Dinamik Moment AkÄ±ÅŸÄ±", s: "ok" }
                  ],
                  details: "Momentler (hikayeler) 24 saat sonra sistemden otomatik olarak dÃ¼ÅŸer.",
                  code: `expires_at = datetime.utcnow() + timedelta(hours=24)`
              },
              "intelligence": {
                  desc: "Yapay zeka motoru ile iÃ§erik gÃ¼venliÄŸi ve kiÅŸiselleÅŸtirilmiÅŸ Ã¶neriler.",
                  checks: [
                      { m: "AI Ä°Ã§erik Moderasyonu", s: "ok" },
                      { m: "AkÄ±llÄ± Etkinlik Ã–nerileri", s: "ok" },
                      { m: "Otomatik GÃ¼venlik Filtreleme", s: "ok" }
                  ],
                  details: "AIEngine servisi Ã¼zerinden metinler taranÄ±r ve kullanÄ±cÄ± ilgi alanlarÄ±na gÃ¶re sÄ±ralama yapÄ±lÄ±r.",
                  code: `recommendations = AIEngine.recommend_events(db, user_id)`
              }
          };

          const data = analysis[id] || {
              desc: "Bu bileÅŸenin detaylÄ± analizi backend snapshot Ã¼zerinden taranÄ±yor...",
              checks: [{m: "Sistem TaramasÄ±", s: "ok"}],
              details: "ModÃ¼l aktif durumda. Teknik dÃ¶kÃ¼mantasyon hazÄ±rlanÄ±yor.",
              code: "# ModÃ¼l kod Ã¶rneÄŸi analiz ediliyor..."
          };

          return `
              <p style="color:var(--text-dim); margin-bottom:1.5rem; font-size:0.9rem;">${data.desc}</p>
              <div class="grid-detail">
                  <div class="info-block">
                      <div class="info-label">Sistem Kontrolleri</div>
                      ${data.checks.map(c => `
                          <div class="check-item ${c.s}">
                              <span>${c.s === 'ok' ? 'â—' : 'â—‹'}</span>
                              ${c.m}
                          </div>
                      `).join('')}
                  </div>
                  <div class="info-block">
                      <div class="info-label">Mimar DetayÄ±</div>
                      <p style="font-size:0.85rem; color:#cbd5e1">${data.details}</p>
                      ${id === 'users' ? `
                          <div style="margin-top:1rem; padding:10px; background:rgba(239, 68, 68, 0.1); border-radius:8px; border:1px solid var(--error);">
                              <strong style="color:var(--error); font-size:0.75rem;">KRÄ°TÄ°K UYARI:</strong>
                              <p style="font-size:0.75rem; color:#fff;">Daha Ã¶nce tespit edilen .com e-posta hatasÄ± Pydantic validator ile engellenmiÅŸtir. ArtÄ±k sadece .edu.tr kabul edilir.</p>
                          </div>
                      ` : ''}
                  </div>
              </div>
              <div class="info-label">Kritik Kod MantÄ±ÄŸÄ± (Logic Preview)</div>
              <div class="code-box">${highlight(data.code)}</div>
          `;
      }

      function highlight(c) {
          return c.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                  .replace(/\b(def|return|class|if|else|import|from|async|await)\b/g, '<span style="color:#c678dd">$1</span>')
                  .replace(/(\w+)(?=\()/g, '<span style="color:#61afef">$1</span>')
                  .replace(/("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')/g, '<span style="color:#98c379">$1</span>');
      }

      init();
    </script>
  </body>
</html>
