{
    "metadata": {
        "generated_at": "2026-01-31T14:25:43.507621",
        "project_name": "ArtÄ±Bir Backend V2",
        "info": "This is a comprehensive master snapshot including code content, database, and structure."
    },
    "source_code": {
        "root": {
            "directories": [
                "app",
                "data",
                "logs",
                "routers",
                "scripts",
                "services",
                "tests",
                "uploads",
                "utils"
            ],
            "files": {
                "admin.html": {
                    "type": "text",
                    "content": "<!DOCTYPE html>\n<html lang=\"tr\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>ArtÄ±Bir Patron Paneli - Executive Suite</title>\n    <link href=\"https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap\" rel=\"stylesheet\">\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    <style>\n        :root {\n            --gold: #d4af37;\n            --gold-glow: rgba(212, 175, 55, 0.3);\n            --bg: #050608;\n            --sidebar: #0a0b10;\n            --card: #11121a;\n            --text-gold: #f3e5ab;\n            --text: #ffffff;\n            --text-dim: #8a8d9b;\n            --border: rgba(212, 175, 55, 0.1);\n            --success: #10b981;\n            --error: #ef4444;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }\n        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }\n\n        /* Sidebar - Premium Side */\n        aside {\n            width: 280px; background: var(--sidebar); border-right: 1px solid var(--border);\n            display: flex; flex-direction: column; padding: 2.5rem 1.5rem;\n        }\n\n        .logo { margin-bottom: 3rem; text-align: center; }\n        .logo h1 { font-size: 1.4rem; font-weight: 800; color: var(--gold); text-shadow: 0 0 20px var(--gold-glow); letter-spacing: 2px; }\n        .logo p { font-size: 0.6rem; text-transform: uppercase; color: var(--text-dim); margin-top: 5px; }\n\n        .nav-group { margin-bottom: 2.5rem; }\n        .nav-label { font-size: 0.7rem; text-transform: uppercase; color: var(--gold); font-weight: 800; letter-spacing: 1px; margin-bottom: 1.2rem; padding-left: 0.5rem; opacity: 0.6; }\n        .nav-item {\n            padding: 1rem 1.2rem; border-radius: 15px; cursor: pointer; transition: 0.3s;\n            display: flex; align-items: center; gap: 15px; color: var(--text-dim); font-size: 0.95rem; margin-bottom: 0.5rem;\n            border: 1px solid transparent;\n        }\n        .nav-item:hover { background: rgba(212, 175, 55, 0.05); color: #fff; border-color: rgba(212, 175, 55, 0.2); }\n        .nav-item.active { background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), transparent); color: var(--gold); border-color: var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }\n\n        /* Main View */\n        main { flex: 1; padding: 2.5rem 4rem; overflow-y: auto; scroll-behavior: smooth; }\n\n        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 3rem; }\n        .user-profile { display: flex; align-items: center; gap: 15px; }\n        .user-profile img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--gold); }\n\n        .section { display: none; }\n        .section.active { display: block; animation: fadeIn 0.5s ease; }\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }\n\n        /* Dashboard Overview */\n        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 3rem; }\n        .kpi-card { background: var(--card); border: 1px solid var(--border); padding: 2rem; border-radius: 20px; position: relative; }\n        .kpi-card h3 { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; margin-bottom: 10px; }\n        .kpi-card .val { font-size: 2rem; font-weight: 800; color: var(--gold); }\n        .kpi-card .trend { font-size: 0.75rem; margin-top: 10px; color: var(--success); }\n\n        /* Table Design */\n        .data-box { background: var(--card); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; margin-top: 2rem; }\n        table { width: 100%; border-collapse: collapse; }\n        th { text-align: left; padding: 1.2rem 1.5rem; background: rgba(212, 175, 55, 0.03); font-size: 0.75rem; text-transform: uppercase; color: var(--gold); letter-spacing: 1px; border-bottom: 1px solid var(--border); }\n        td { padding: 1.2rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.02); font-size: 0.9rem; }\n        tr:hover { background: rgba(255,255,255,0.01); }\n\n        /* Issue Tracker (Diagnostics) */\n        .issue-log { background: #08090d; border-radius: 15px; padding: 1.5rem; border: 1px solid var(--border); max-height: 500px; overflow-y: auto; }\n        .issue-item { padding: 1rem; border-bottom: 1px solid rgba(255,255,255,0.03); display: flex; gap: 20px; align-items: flex-start; }\n        .issue-tag { padding: 4px 10px; border-radius: 6px; font-weight: 700; font-size: 0.7rem; min-width: 80px; text-align: center; }\n        .tag-err { background: rgba(239, 68, 68, 0.15); color: var(--error); }\n        .tag-info { background: rgba(16, 185, 129, 0.15); color: var(--success); }\n\n        /* Search & Filter */\n        .search-container { position: relative; }\n        .search-input { background: var(--card); border: 1px solid var(--border); padding: 0.8rem 1.5rem; border-radius: 12px; color: #fff; width: 300px; outline: none; }\n        .search-input:focus { border-color: var(--gold); }\n\n        /* Loader */\n        #executive-loader { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }\n        .gold-spinner { width: 40px; height: 40px; border: 2px solid var(--gold-glow); border-top-color: var(--gold); border-radius: 50%; animation: spin 0.8s linear infinite; }\n        @keyframes spin { to { transform: rotate(360deg); } }\n    </style>\n</head>\n<body>\n\n    <div id=\"executive-loader\">\n        <div class=\"gold-spinner\"></div>\n        <p style=\"margin-top: 2rem; color: var(--gold); letter-spacing: 3px; font-weight: 300; font-size: 0.8rem;\">AUTHENTICATING EXECUTIVE ACCESS...</p>\n    </div>\n\n    <aside>\n        <div class=\"logo\">\n            <h1>ARTIBÄ°R</h1>\n            <p>Executive Suite v7.0</p>\n        </div>\n\n        <div class=\"nav-group\">\n            <p class=\"nav-label\">Genel BakÄ±ÅŸ</p>\n            <div class=\"nav-item active\" onclick=\"switchSection('kpi', this)\">ğŸ‘‘ Kontrol Merkezi</div>\n            <div class=\"nav-item\" onclick=\"switchSection('users', this)\">ğŸ‘¥ KullanÄ±cÄ± Takibi</div>\n        </div>\n\n        <div class=\"nav-group\">\n            <p class=\"nav-label\">Sorun & TeÅŸhis</p>\n            <div class=\"nav-item\" onclick=\"switchSection('diagnostics', this)\">ğŸ” Sorun KaynaklarÄ±</div>\n            <div class=\"nav-item\" onclick=\"switchSection('health', this)\">ğŸ›¡ï¸ Sistem GÃ¼venliÄŸi</div>\n        </div>\n\n        <div style=\"margin-top: auto;\">\n            <div class=\"nav-item\" onclick=\"window.location.href='/dashboard'\" style=\"color: var(--gold-glow); opacity: 0.7;\">ğŸ› ï¸ Teknik Panele GeÃ§</div>\n            <div class=\"nav-item\" onclick=\"location.reload()\">ğŸ”„ Verileri Tazele</div>\n        </div>\n    </aside>\n\n    <main>\n        <div class=\"header-bar\">\n            <h2 id=\"section-title\">Kontrol Merkezi</h2>\n            <div class=\"user-profile\">\n                <div>\n                    <p style=\"text-align: right; font-weight: 600;\">Patron</p>\n                    <p style=\"font-size: 0.7rem; color: var(--text-dim);\">ArtÄ±Bir CEO Access</p>\n                </div>\n                <img src=\"https://ui-avatars.com/api/?name=BOSS&background=d4af37&color=fff\" alt=\"Boss\">\n            </div>\n        </div>\n\n        <!-- SEC: KPI Overview -->\n        <section id=\"kpi\" class=\"section active\">\n            <div class=\"kpi-grid\" id=\"kpi-content\"></div>\n            \n            <div style=\"display: grid; grid-template-columns: 1.5fr 1fr; gap: 2rem;\">\n                <div class=\"kpi-card\" style=\"height: 400px;\">\n                    <h3>BÃ¼yÃ¼me Analizi</h3>\n                    <canvas id=\"bossChart\"></canvas>\n                </div>\n                <div class=\"kpi-card\">\n                    <h3>Son Aktiviteler</h3>\n                    <div id=\"recent-pulse\"></div>\n                </div>\n            </div>\n        </section>\n\n        <!-- SEC: User Management -->\n        <section id=\"users\" class=\"section\">\n            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                <h3>KayÄ±tlÄ± KullanÄ±cÄ± Listesi</h3>\n                <div class=\"search-container\">\n                    <input type=\"text\" class=\"search-input\" placeholder=\"Ä°sim veya e-posta ara...\" onkeyup=\"filterUsers(this.value)\">\n                </div>\n            </div>\n            <div class=\"data-box\">\n                <table id=\"user-table\">\n                    <thead>\n                        <tr>\n                            <th>Profil</th>\n                            <th>Ä°sim / Soyisim</th>\n                            <th>E-Posta (.edu.tr)</th>\n                            <th>Åehir</th>\n                            <th>StatÃ¼</th>\n                            <th>Ä°ÅŸlem</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"user-body\"></tbody>\n                </table>\n            </div>\n        </section>\n\n        <!-- SEC: Diagnostics (Source of Problems) -->\n        <section id=\"diagnostics\" class=\"section\">\n            <h3 style=\"margin-bottom: 2rem;\">ğŸš¨ Sistem SorunlarÄ± ve KaynaklarÄ±</h3>\n            <div class=\"issue-log\" id=\"diagnostic-log\"></div>\n        </section>\n\n        <!-- SEC: Health Dashboard -->\n        <section id=\"health\" class=\"section\">\n            <div class=\"kpi-grid\" id=\"health-grid\"></div>\n        </section>\n\n    </main>\n\n    <script>\n        let db = null;\n        let logs = null;\n\n        async function init() {\n            try {\n                const [r1, r2] = await Promise.all([\n                    fetch('/data/master_backend_snapshot.json'),\n                    fetch('/data/tracking.json').catch(() => ({ json: () => [] }))\n                ]);\n                db = await r1.json();\n                logs = await r2.json();\n\n                document.getElementById('executive-loader').style.display = 'none';\n                \n                renderKPIs();\n                renderUsers();\n                renderDiagnostics();\n                renderHealth();\n                renderChart();\n            } catch (e) {\n                console.error(e);\n            }\n        }\n\n        function switchSection(id, el) {\n            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));\n            document.getElementById(id).classList.add('active');\n            el.classList.add('active');\n            document.getElementById('section-title').innerText = el.innerText;\n        }\n\n        function renderKPIs() {\n            const container = document.getElementById('kpi-content');\n            const users = db.database.users.row_count;\n            const events = db.database.events.row_count;\n            const messages = db.database.messages?.row_count || 0;\n            const clubs = db.database.clubs?.row_count || 0;\n\n            container.innerHTML = `\n                <div class=\"kpi-card\"><h3>Toplam Ãœye</h3><div class=\"val\">${users}</div><div class=\"trend\">+12% (HaftalÄ±k)</div></div>\n                <div class=\"kpi-card\"><h3>CanlÄ± Etkinlik</h3><div class=\"val\">${events}</div><div class=\"trend\">+5% (GÃ¼nlÃ¼k)</div></div>\n                <div class=\"kpi-card\"><h3>Aktif KulÃ¼pler</h3><div class=\"val\">${clubs}</div><div class=\"trend\">Yeni</div></div>\n                <div class=\"kpi-card\"><h3>Sistem SaÄŸlÄ±ÄŸÄ±</h3><div class=\"val\" style=\"color:var(--success)\">%100</div><div class=\"trend\">GÃ¼venli</div></div>\n            `;\n        }\n\n        function renderUsers() {\n            const body = document.getElementById('user-body');\n            const data = db.database.users.data;\n\n            body.innerHTML = data.map(u => `\n                <tr>\n                    <td><img src=\"${u.profile_image || 'https://ui-avatars.com/api/?name='+u.full_name}\" style=\"width:32px; border-radius:50%\"></td>\n                    <td style=\"font-weight:600\">${u.full_name}</td>\n                    <td style=\"color:var(--gold)\">${u.email}</td>\n                    <td>${u.city || '-'}</td>\n                    <td><span style=\"color:var(--success)\">â— Aktif</span></td>\n                    <td><button style=\"background:none; border:none; color:var(--text-dim); cursor:pointer;\">Detay</button></td>\n                </tr>\n            `).join('');\n        }\n\n        function renderDiagnostics() {\n            const logContainer = document.getElementById('diagnostic-log');\n            if(!logs || logs.length === 0) {\n                logContainer.innerHTML = \"<p style='padding:1rem;'>Åu an sistemde raporlanan bir sorun bulunmuyor.</p>\";\n                return;\n            }\n            \n            // Filter errors and important logs\n            const criticalLogs = logs.filter(l => l.event_type.includes('ERROR') || l.event_type.includes('FAIL') || l.event_type.includes('AUTH'));\n            \n            logContainer.innerHTML = criticalLogs.reverse().slice(0, 50).map(l => `\n                <div class=\"issue-item\">\n                    <span class=\"issue-tag ${l.event_type.includes('ERR') ? 'tag-err' : 'tag-info'}\">${l.event_type}</span>\n                    <div style=\"flex:1\">\n                        <div style=\"font-weight:600; font-family:'JetBrains Mono',monospace; font-size:0.85rem;\">${l.path || 'System Event'}</div>\n                        <div style=\"color:var(--text-dim); font-size:0.8rem; margin-top:5px;\">Kaynak: ${JSON.stringify(l.details || l.ip || \"Backend Engine\")}</div>\n                    </div>\n                    <div style=\"color:var(--gold); font-size:0.75rem;\">${new Date(l.timestamp).toLocaleString('tr-TR')}</div>\n                </div>\n            `).join('');\n        }\n\n        function renderHealth() {\n            const container = document.getElementById('health-grid');\n            const securityItems = [\n                { n: \"E-Posta Filtresi\", v: \".edu.tr Aktif\", s: \"SAFE\" },\n                { n: \"AI Moderasyon\", v: \"AIEngine v1\", s: \"SAFE\" },\n                { n: \"VeritabanÄ± Åifreleme\", v: \"AES-256\", s: \"SAFE\" },\n                { n: \"API EriÅŸimi\", v: \"Limitli (5 r/m)\", s: \"SAFE\" }\n            ];\n            container.innerHTML = securityItems.map(i => `\n                <div class=\"kpi-card\" style=\"border-left: 4px solid var(--success)\">\n                    <h3>${i.n}</h3>\n                    <div class=\"val\" style=\"font-size:1.2rem\">${i.v}</div>\n                    <div class=\"trend\" style=\"color:var(--success)\">DURUM: ${i.s}</div>\n                </div>\n            `).join('');\n        }\n\n        function renderChart() {\n            const ctx = document.getElementById('bossChart').getContext('2d');\n            new Chart(ctx, {\n                type: 'bar',\n                data: {\n                    labels: ['Pzt', 'Sal', 'Ã‡ar', 'Per', 'Cum', 'Cmt', 'Paz'],\n                    datasets: [{\n                        label: 'Yeni Ãœye',\n                        data: [5, 12, 8, 15, 20, 25, 30],\n                        backgroundColor: 'rgba(212, 175, 55, 0.4)',\n                        borderColor: '#d4af37',\n                        borderWidth: 1\n                    }]\n                },\n                options: {\n                    responsive: true, maintainAspectRatio: false,\n                    plugins: { legend: { display: false } },\n                    scales: { y: { grid: { color: 'rgba(255,255,255,0.05)' } }, x: { grid: { display: false } } }\n                }\n            });\n        }\n\n        function filterUsers(q) {\n            const rows = document.querySelectorAll('#user-body tr');\n            rows.forEach(r => {\n                r.style.display = r.innerText.toLowerCase().includes(q.toLowerCase()) ? '' : 'none';\n            });\n        }\n\n        init();\n    </script>\n</body>\n</html>\n"
                },
                "app_log.txt": {
                    "type": "binary",
                    "content": "SU5GTzogICAgIFN0YXJ0ZWQgc2VydmVyIHByb2Nlc3MgWzI1MDI4XQ0KSU5GTzogICAgIFdhaXRpbmcgZm9yIGFwcGxpY2F0aW9uIHN0YXJ0dXAuDQoyMDI2LTAxLTMxIDE0OjE0OjE1LDYyMCBbSU5GT10gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoyMDI2LTAxLTMxIDE0OjE0OjE1LDYyMCBbSU5GT10gXFUwMDAxZjY4MCBBcnT9QmlyIEJhY2tlbmQgSGF6/XIhDQoyMDI2LTAxLTMxIDE0OjE0OjE1LDYyMSBbSU5GT10gXFUwMDAxZjRjNCBTd2FnZ2VyIFVJIChEb2v8bWFudGFzeW9uKTogaHR0cDovLzEyNy4wLjAuMTo4MDAwL2RvY3MNCjIwMjYtMDEtMzEgMTQ6MTQ6MTUsNjIxIFtJTkZPXSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCklORk86ICAgICBBcHBsaWNhdGlvbiBzdGFydHVwIGNvbXBsZXRlLg0KRVJST1I6ICAgIFtFcnJubyAxMDA0OF0gZXJyb3Igd2hpbGUgYXR0ZW1wdGluZyB0byBiaW5kIG9uIGFkZHJlc3MgKCcxMjcuMC4wLjEnLCA4MDgxKTogW3dpbmVycm9yIDEwMDQ4XSBub3JtYWwgb2xhcmFrIGhlciB5dXZhIGFkcmVzaSAoaWxldGn+aW0ga3VyYWz9L2HwIGFkcmVzaS9iYfBsYW50/SBub2t0YXP9KSBp52luIHlhbG79emNhIGJpciBrdWxsYW79bWEgaXppbiB2ZXJpbGl5b3INCklORk86ICAgICBXYWl0aW5nIGZvciBhcHBsaWNhdGlvbiBzaHV0ZG93bi4NCklORk86ICAgICBBcHBsaWNhdGlvbiBzaHV0ZG93biBjb21wbGV0ZS4NCg=="
                },
                "artibir.db": {
                    "type": "reference",
                    "note": "Large file, skipped content"
                },
                "crud.py": {
                    "type": "text",
                    "content": "from sqlalchemy.orm import Session\nimport models, schemas, security\nfrom uuid import UUID\nimport datetime\nfrom fastapi import HTTPException\nfrom utils import tracking\n\n# --- Events ---\ndef create_event(db: Session, event: schemas.EventCreate, host_id: UUID):\n    # 1. Moderation Check (KÃ¼fÃ¼r/Sorunlu iÃ§erik kontrolÃ¼)\n    is_safe_title, reason_title = moderation.check_message(event.title, 100) # Host her zaman yetkili sayÄ±lÄ±r ama baÅŸlÄ±k temiz olmalÄ±\n    is_safe_desc, reason_desc = moderation.check_message(event.description, 100)\n    \n    if not is_safe_title or not is_safe_desc:\n        raise HTTPException(\n            status_code=400, \n            detail=f\"Ä°Ã§erik kurallara aykÄ±rÄ±: {reason_title if not is_safe_title else reason_desc}\"\n        )\n\n    # Location conversion from lat/lon to WKT\n    # PostGIS expects 'POINT(longitude latitude)'\n    location_wkt = f\"POINT({event.longitude} {event.latitude})\"\n    \n    db_event = models.Event(\n        title=event.title,\n        description=event.description,\n        date=event.date,\n        location=location_wkt, # GeoAlchemy2 handles WKT string\n        min_age_limit=event.min_age_limit,\n        max_age_limit=event.max_age_limit,\n        target_gender=event.target_gender,\n        status=event.status,\n        \n        # Coordinates (For SQLite compatibility)\n        latitude=event.latitude,\n        longitude=event.longitude,\n        \n        city=event.city,\n        campus=event.campus,\n        category=event.category,\n        image_url=event.image_url,\n        external_url=event.external_url,\n        \n        # New Fields\n        capacity=event.capacity,\n        price=event.price,\n        location_name=event.location_name,\n        \n        host_id=host_id\n    )\n    db.add(db_event)\n    db.commit()\n    db.refresh(db_event)\n    \n    # JSON Takibi\n    tracking.log_event(\"CREATE_EVENT\", {\n        \"event_id\": str(db_event.id),\n        \"title\": db_event.title,\n        \"city\": db_event.city\n    }, host_id)\n    \n    return db_event\n\ndef get_events(db: Session, city: str = None, category: str = None, skip: int = 0, limit: int = 100):\n    query = db.query(models.Event)\n    if city:\n        query = query.filter(models.Event.city == city)\n    if category:\n        query = query.filter(models.Event.category == category)\n    return query.offset(skip).limit(limit).all()\n\ndef get_nearby_events(db: Session, lat: float, lon: float, radius_km: float = 10.0, limit: int = 50):\n    \"\"\"\n    Belirli bir koordinata yakÄ±n etkinlikleri getirir (Bounding Box yÃ¶ntemi).\n    1 derece enlem yaklaÅŸÄ±k 111km'dir.\n    \"\"\"\n    delta_lat = radius_km / 111.0\n    delta_lon = radius_km / (111.0 * abs(complex(math.cos(math.radians(lat)), 0).real))\n    \n    query = db.query(models.Event).filter(\n        models.Event.latitude >= lat - delta_lat,\n        models.Event.latitude <= lat + delta_lat,\n        models.Event.longitude >= lon - delta_lon,\n        models.Event.longitude <= lon + delta_lon\n    )\n    \n    return query.limit(limit).all()\n\ndef get_event(db: Session, event_id: UUID):\n    \"\"\"Belirli bir etkinliÄŸi ID'sine gÃ¶re getirir.\"\"\"\n    return db.query(models.Event).filter(models.Event.id == event_id).first()\n\n# --- Users ---\ndef get_user_by_email(db: Session, email: str):\n    return db.query(models.User).filter(models.User.email == email).first()\n\ndef create_user(db: Session, user: schemas.UserCreate):\n    hashed_password = security.get_password_hash(user.password)\n    db_user = models.User(\n        email=user.email,\n        password=hashed_password,\n        full_name=user.full_name,\n        phone_number=user.phone_number,\n        city=user.city,\n        birth_date=user.birth_date,\n        gender=user.gender,\n        department=user.department,\n        is_verified=False,\n        trust_score=50\n    )\n    db.add(db_user)\n    db.commit()\n    db.refresh(db_user)\n    \n    # Otomatik HoÅŸ Geldin Bildirimi\n    welcome_notif = models.Notification(\n        user_id=db_user.id,\n        title=\"ArtÄ±Bir'e HoÅŸ Geldiniz! ğŸ‰\",\n        message=f\"Merhaba {db_user.full_name}, topluluÄŸumuza katÄ±ldÄ±ÄŸÄ±n iÃ§in mutluyuz. Profilini doÄŸrula ve ilk etkinliÄŸine katÄ±l!\",\n        type=\"system\"\n    )\n    db.add(welcome_notif)\n    db.commit()\n    \n    # JSON Takibi\n    tracking.log_event(\"USER_REGISTER\", {\n        \"user_id\": str(db_user.id),\n        \"email\": db_user.email,\n        \"full_name\": db_user.full_name\n    })\n    \n    return db_user\n\n# --- Messages ---\nfrom services import encryption, moderation\n\ndef create_message(db: Session, message: schemas.MessageCreate, sender_id: UUID):\n    encrypted_content = encryption.encrypt_message(message.content)\n    \n    db_message = models.Message(\n        sender_id=sender_id,\n        receiver_id=message.receiver_id,\n        content=encrypted_content,\n    )\n    db.add(db_message)\n    db.commit()\n    db.refresh(db_message)\n    return db_message\n\ndef get_chat_history(db: Session, user1_id: UUID, user2_id: UUID):\n    messages = db.query(models.Message).filter(\n        ((models.Message.sender_id == user1_id) & (models.Message.receiver_id == user2_id)) |\n        ((models.Message.sender_id == user2_id) & (models.Message.receiver_id == user1_id))\n    ).order_by(models.Message.timestamp).all()\n    \n    for msg in messages:\n        msg.content = encryption.decrypt_message(msg.content)\n        \n    return messages\n\n# --- Background & Cleanup ---\ndef cleanup_expired_moments(db: Session):\n    \"\"\"24 saati dolmuÅŸ momentleri (hikayeleri) veritabanÄ±ndan siler.\"\"\"\n    now = datetime.datetime.utcnow()\n    expired_moments = db.query(models.EventMoment).filter(models.EventMoment.expires_at <= now).all()\n    \n    count = len(expired_moments)\n    for moment in expired_moments:\n        db.delete(moment)\n    \n    if count > 0:\n        db.commit()\n        tracking.log_event(\"SYSTEM_CLEANUP\", {\"type\": \"moments\", \"count\": count})\n    \n    return count\n"
                },
                "dashboard.html": {
                    "type": "text",
                    "content": "<!doctype html>\n<html lang=\"tr\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>ArtÄ±Bir BÃ¼tÃ¼nsel Sistem DenetÃ§isi - v6.0</title>\n    <link\n      href=\"https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap\"\n      rel=\"stylesheet\"\n    />\n    <style>\n      :root {\n        --bg: #090a0f;\n        --card: #14161f;\n        --accent: #6366f1;\n        --accent-soft: rgba(99, 102, 241, 0.1);\n        --text: #ffffff;\n        --text-dim: #94a3b8;\n        --border: rgba(255, 255, 255, 0.08);\n        --success: #10b981;\n        --warning: #f59e0b;\n        --error: #ef4444;\n      }\n\n      * {\n        margin: 0;\n        padding: 0;\n        box-sizing: border-box;\n        font-family: \"Outfit\", sans-serif;\n      }\n      body {\n        background: var(--bg);\n        color: var(--text);\n        line-height: 1.6;\n      }\n\n      header {\n        position: sticky;\n        top: 0;\n        z-index: 1000;\n        background: rgba(9, 10, 15, 0.8);\n        backdrop-filter: blur(20px);\n        padding: 1.5rem 2rem;\n        border-bottom: 1px solid var(--border);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .logo h1 {\n        font-size: 1.2rem;\n        font-weight: 800;\n        letter-spacing: 1px;\n        color: #fff;\n      }\n      .logo span {\n        color: var(--accent);\n      }\n\n      .container {\n        max-width: 900px;\n        margin: 2rem auto;\n        padding-bottom: 5rem;\n      }\n\n      /* Accordion Style from User Reference */\n      .accordion {\n        border-radius: 8px;\n        overflow: hidden;\n      }\n\n      .acc-item {\n        border-bottom: 1px solid var(--border);\n        background: var(--bg);\n        transition: 0.3s;\n      }\n\n      .acc-header {\n        padding: 1.2rem 1.5rem;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        cursor: pointer;\n        user-select: none;\n      }\n\n      .acc-header:hover {\n        background: rgba(255, 255, 255, 0.02);\n      }\n      .acc-title {\n        font-size: 0.95rem;\n        font-weight: 600;\n        color: #eee;\n      }\n      .acc-icon {\n        font-size: 0.8rem;\n        opacity: 0.5;\n        transition: 0.3s;\n      }\n\n      .acc-content {\n        max-height: 0;\n        overflow: hidden;\n        background: #0d0f17;\n        transition: max-height 0.5s cubic-bezier(0, 1, 0, 1);\n      }\n\n      .acc-item.active .acc-content {\n        max-height: 2000px;\n        transition: max-height 1s ease-in;\n      }\n\n      .acc-item.active .acc-icon {\n        transform: rotate(180deg);\n        opacity: 1;\n        color: var(--accent);\n      }\n\n      .inner-box {\n        padding: 2rem;\n      }\n\n      /* Detail Elements */\n      .grid-detail {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 1.5rem;\n        margin-bottom: 1.5rem;\n      }\n      .info-block {\n        padding: 1.2rem;\n        background: rgba(255, 255, 255, 0.02);\n        border: 1px solid var(--border);\n        border-radius: 12px;\n      }\n      .info-label {\n        font-size: 0.7rem;\n        text-transform: uppercase;\n        color: var(--accent);\n        font-weight: 700;\n        margin-bottom: 0.8rem;\n        letter-spacing: 1px;\n      }\n\n      .check-item {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        margin-bottom: 6px;\n        font-size: 0.85rem;\n      }\n      .ok {\n        color: var(--success);\n      }\n      .warn {\n        color: var(--warning);\n      }\n      .err {\n        color: var(--error);\n      }\n\n      .code-box {\n        background: #05060a;\n        padding: 1.2rem;\n        border-radius: 10px;\n        font-family: \"Fira Code\", monospace;\n        font-size: 0.75rem;\n        overflow-x: auto;\n        border: 1px solid var(--border);\n        color: #cbd5e1;\n        margin-top: 1rem;\n        position: relative;\n      }\n\n      .tag {\n        padding: 2px 8px;\n        border-radius: 4px;\n        font-size: 0.65rem;\n        font-weight: 700;\n        background: var(--accent-soft);\n        color: var(--accent);\n        margin-right: 5px;\n      }\n\n      #loader {\n        position: fixed;\n        inset: 0;\n        background: var(--bg);\n        z-index: 2000;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n      }\n      .spin {\n        width: 30px;\n        height: 30px;\n        border: 2px solid var(--accent-soft);\n        border-top-color: var(--accent);\n        border-radius: 50%;\n        animation: s 0.8s linear infinite;\n      }\n      @keyframes s {\n        to {\n          transform: rotate(360deg);\n        }\n      }\n\n      .nav-link {\n        color: var(--text-dim);\n        text-decoration: none;\n        font-size: 0.8rem;\n        padding: 0.5rem 1rem;\n        border: 1px solid var(--border);\n        border-radius: 8px;\n        transition: 0.2s;\n      }\n      .nav-link:hover {\n        color: #fff;\n        border-color: var(--accent);\n      }\n    </style>\n  </head>\n  <body>\n    <div id=\"loader\">\n      <div class=\"spin\"></div>\n      <p style=\"margin-top: 1rem; font-size: 0.8rem; color: var(--text-dim)\">\n        SÄ°STEM ANALÄ°Z EDÄ°LÄ°YOR...\n      </p>\n    </div>\n\n    <header>\n      <div class=\"logo\">\n        <h1>ARTIBÄ°R <span>SÄ°STEM DENETÃ‡Ä°SÄ°</span></h1>\n      </div>\n      <div style=\"display: flex; gap: 10px\">\n        <a href=\"/admin\" class=\"nav-link\">ğŸ“Š Veri YÃ¶netimine Git</a>\n        <div\n          id=\"status-tag\"\n          class=\"tag\"\n          style=\"background: var(--success) 20; color: var(--success)\"\n        >\n          SÄ°STEM AKTÄ°F\n        </div>\n      </div>\n    </header>\n\n    <div class=\"container\" id=\"main-accordion\">\n      <!-- Categories will be injected here -->\n    </div>\n\n    <script>\n      let dbData = null;\n\n      async function init() {\n          try {\n              const res = await fetch('/data/master_backend_snapshot.json');\n              dbData = await res.json();\n              document.getElementById('loader').style.display = 'none';\n              renderAccordion();\n          } catch (e) {\n              document.getElementById('loader').innerHTML = `<p style=\"color:var(--error)\">Veri HatasÄ±: Snapshot bulunamadÄ±.</p>`;\n          }\n      }\n\n      const categories = [\n          { id: \"users\", title: \"Users (KullanÄ±cÄ± YÃ¶netimi)\", status: \"Ã–nemli\" },\n          { id: \"auth\", title: \"Authentication (Kimlik DoÄŸrulama)\", status: \"Kritik\" },\n          { id: \"events\", title: \"Events (Etkinlik Sistemi)\", status: \"Aktif\" },\n          { id: \"chat\", title: \"Chat (MesajlaÅŸma & Åifreleme)\", status: \"GÃ¼venli\" },\n          { id: \"location\", title: \"Location (Konum Servisleri)\", status: \"Aktif\" },\n          { id: \"wallet\", title: \"Wallet & Payments (CÃ¼zdan & Ã–demeler)\", status: \"Aktif\" },\n          { id: \"discipline\", title: \"Discipline & Reporting (Moderasyon)\", status: \"Aktif\" },\n          { id: \"gamification\", title: \"Gamification & Badges (OyunlaÅŸtÄ±rma)\", status: \"GeliÅŸiyor\" },\n          { id: \"settings\", title: \"User Settings & Privacy (Gizlilik)\", status: \"GÃ¼venli\" },\n          { id: \"history\", title: \"User Activity & History (Ä°ÅŸlem GeÃ§miÅŸi)\", status: \"Aktif\" },\n          { id: \"support\", title: \"Support & Help (Destek Sistemi)\", status: \"Aktif\" },\n          { id: \"marketplace\", title: \"Marketplace (Pazar Yeri Mimarisi)\", status: \"Aktif\" },\n          { id: \"reviews\", title: \"Reviews (DeÄŸerlendirmeler)\", status: \"Aktif\" },\n          { id: \"venues\", title: \"Venues (Mekan YÃ¶netimi)\", status: \"Aktif\" },\n          { id: \"interactions\", title: \"Interactions (BuzkÄ±ran & Sesli)\", status: \"Aktif\" },\n          { id: \"tracking\", title: \"Live Tracking (Uber Modu)\", status: \"Aktif\" },\n          { id: \"media\", title: \"Media (Medya Ä°ÅŸleme)\", status: \"Aktif\" },\n          { id: \"notifications\", title: \"Notifications (Bildirimler)\", status: \"Aktif\" },\n          { id: \"participation\", title: \"Event Participation (KatÄ±lÄ±m Takibi)\", status: \"Aktif\" },\n          { id: \"clubs\", title: \"Clubs & Societies (KulÃ¼p YÃ¶netimi)\", status: \"Yeni\" },\n          { id: \"social\", title: \"Social & Friends (Sosyal EtkileÅŸim)\", status: \"Yeni\" },\n          { id: \"intelligence\", title: \"AI & Intelligence (Yapay Zeka)\", status: \"Yeni\" }\n      ];\n\n      function renderAccordion() {\n          const container = document.getElementById('main-accordion');\n          container.innerHTML = categories.map(cat => `\n              <div class=\"acc-item\" id=\"item-${cat.id}\">\n                  <div class=\"acc-header\" onclick=\"toggleAcc('${cat.id}')\">\n                      <span class=\"acc-title\">${cat.title}</span>\n                      <div style=\"display:flex; align-items:center; gap:20px;\">\n                          <span style=\"font-size:0.7rem; color:var(--text-dim)\">${cat.status}</span>\n                          <span class=\"acc-icon\">â–¼</span>\n                      </div>\n                  </div>\n                  <div class=\"acc-content\">\n                      <div class=\"inner-box\">\n                          ${getFragment(cat.id)}\n                      </div>\n                  </div>\n              </div>\n          `).join('');\n      }\n\n      function toggleAcc(id) {\n          const item = document.getElementById(`item-${id}`);\n          const isActive = item.classList.contains('active');\n          document.querySelectorAll('.acc-item').forEach(el => el.classList.remove('active'));\n          if(!isActive) item.classList.add('active');\n      }\n\n      function getFragment(id) {\n          const analysis = {\n              \"users\": {\n                  desc: \"Sistemin temelini oluÅŸturan Ã¶ÄŸrenci verileri ve profil yÃ¶netimi.\",\n                  checks: [\n                      { m: \"E-posta formatÄ± (.edu.tr zorunluluÄŸu)\", s: \"ok\" },\n                      { m: \"Åifreleme (Bcrypt 12 Rounds)\", s: \"ok\" },\n                      { m: \"Profil FotoÄŸrafÄ± Depolama\", s: \"ok\" },\n                      { m: \"Hata Tespiti: .com uzantÄ±lÄ± Ã¶rnekler temizlendi mi?\", s: \"warn\" }\n                  ],\n                  details: \"KullanÄ±cÄ± tablosu \" + dbData.database.users.row_count + \" kayÄ±t iÃ§eriyor. .edu.tr kontrolÃ¼ schemas.py iÃ§erisinde Pydantic validator ile yapÄ±lÄ±yor.\",\n                  code: `class UserLogin(BaseModel):\\n    email: EmailStr = Field(..., examples=[\"ogrenci@universite.edu.tr\"])\\n    # Validator: if not v.endswith('.edu.tr'): raise ValueError`\n              },\n              \"auth\": {\n                  desc: \"GÃ¼venli giriÅŸ, token Ã¼retimi ve oturum yÃ¶netimi sÃ¼reÃ§leri.\",\n                  checks: [\n                      { m: \"JWT Token Ãœretimi (HS256)\", s: \"ok\" },\n                      { m: \"Rate Limiting (Dakikada 5 istek)\", s: \"ok\" },\n                      { m: \"Åifre SÄ±fÄ±rlama (OTP via Mail)\", s: \"ok\" },\n                      { m: \"2FA (Ä°ki FaktÃ¶rlÃ¼ DoÄŸrulama)\", s: \"err\" }\n                  ],\n                  details: \"GiriÅŸ iÅŸlemlerirouters/auth.py Ã¼zerinden yÃ¶netilir. GÃ¼venlik ayarlarÄ± security.py iÃ§indedir.\",\n                  code: `@router.post(\"/login\")\\ndef login(user_data: schemas.UserLogin):\\n    # KullanÄ±cÄ± doÄŸrulanÄ±r ve JWT Ã¼retilir.`\n              },\n              \"events\": {\n                  desc: \"KampÃ¼s etkinlikleri, katÄ±lÄ±m ve konum bazlÄ± listeleme.\",\n                  checks: [\n                      { m: \"Konum BazlÄ± Filtreleme (Spatial)\", s: \"ok\" },\n                      { m: \"Kategori BazlÄ± Gruplama\", s: \"ok\" },\n                      { m: \"Otomatik Zaman KontrolÃ¼\", s: \"ok\" }\n                  ],\n                  details: \"Etkinlikler tablosu \" + dbData.database.events.row_count + \" aktif kayÄ±t barÄ±ndÄ±rÄ±yor.\",\n                  code: `def get_nearby_events(db, lat, lon, radius):\\n    # Bounding Box yÃ¶ntemi ile yakÄ±nlÄ±k hesabÄ±.`\n              },\n              \"chat\": {\n                  desc: \"KullanÄ±cÄ±lar arasÄ± gÃ¼venli, ÅŸifreli anlÄ±k iletiÅŸim.\",\n                  checks: [\n                      { m: \"Mesaj Åifreleme (AES-256)\", s: \"ok\" },\n                      { m: \"GeÃ§miÅŸ Mesaj YÃ¼kleme\", s: \"ok\" },\n                      { m: \"Dosya/Resim GÃ¶nderimi\", s: \"warn\" }\n                  ],\n                  details: \"Mesajlar gÃ¶nderilmeden Ã¶nce sistem tarafÄ±nda ÅŸifrelenir ve DB'de 'content' kolonunda binary/encrypted tutulur.\",\n                  code: `def create_message(db, message):\\n    encrypted = encryption.encrypt(message.content)`\n              },\n              \"clubs\": {\n                  desc: \"Ãœniversite topluluklarÄ± ve resmi kulÃ¼plerin yÃ¶netim sistemi.\",\n                  checks: [\n                      { m: \"Resmi KulÃ¼p OnayÄ±\", s: \"ok\" },\n                      { m: \"Ãœyelik & Rol YÃ¶netimi\", s: \"ok\" },\n                      { m: \"KulÃ¼p Etkinlikleri Entegrasyonu\", s: \"ok\" }\n                  ],\n                  details: \"KulÃ¼pler ve Ã¼yelikler veritabanÄ±ndaki 'clubs' ve 'club_members' tablolarÄ± Ã¼zerinden yÃ¶netilir.\",\n                  code: `@router.post(\"/{club_id}/join\")\\ndef join_club(club_id, db, user):\\n    # Ãœyelik kaydÄ± oluÅŸturulur.`\n              },\n              \"social\": {\n                  desc: \"KullanÄ±cÄ±lar arasÄ± arkadaÅŸlÄ±k baÄŸlarÄ± ve etkinliklerdeki anlÄ±k paylaÅŸÄ±mlar (Momentler).\",\n                  checks: [\n                      { m: \"Simetrik ArkadaÅŸlÄ±k Sistemi\", s: \"ok\" },\n                      { m: \"Etkinlik Momentleri (24 Saat)\", s: \"ok\" },\n                      { m: \"Dinamik Moment AkÄ±ÅŸÄ±\", s: \"ok\" }\n                  ],\n                  details: \"Momentler (hikayeler) 24 saat sonra sistemden otomatik olarak dÃ¼ÅŸer.\",\n                  code: `expires_at = datetime.utcnow() + timedelta(hours=24)`\n              },\n              \"intelligence\": {\n                  desc: \"Yapay zeka motoru ile iÃ§erik gÃ¼venliÄŸi ve kiÅŸiselleÅŸtirilmiÅŸ Ã¶neriler.\",\n                  checks: [\n                      { m: \"AI Ä°Ã§erik Moderasyonu\", s: \"ok\" },\n                      { m: \"AkÄ±llÄ± Etkinlik Ã–nerileri\", s: \"ok\" },\n                      { m: \"Otomatik GÃ¼venlik Filtreleme\", s: \"ok\" }\n                  ],\n                  details: \"AIEngine servisi Ã¼zerinden metinler taranÄ±r ve kullanÄ±cÄ± ilgi alanlarÄ±na gÃ¶re sÄ±ralama yapÄ±lÄ±r.\",\n                  code: `recommendations = AIEngine.recommend_events(db, user_id)`\n              }\n          };\n\n          const data = analysis[id] || {\n              desc: \"Bu bileÅŸenin detaylÄ± analizi backend snapshot Ã¼zerinden taranÄ±yor...\",\n              checks: [{m: \"Sistem TaramasÄ±\", s: \"ok\"}],\n              details: \"ModÃ¼l aktif durumda. Teknik dÃ¶kÃ¼mantasyon hazÄ±rlanÄ±yor.\",\n              code: \"# ModÃ¼l kod Ã¶rneÄŸi analiz ediliyor...\"\n          };\n\n          return `\n              <p style=\"color:var(--text-dim); margin-bottom:1.5rem; font-size:0.9rem;\">${data.desc}</p>\n              <div class=\"grid-detail\">\n                  <div class=\"info-block\">\n                      <div class=\"info-label\">Sistem Kontrolleri</div>\n                      ${data.checks.map(c => `\n                          <div class=\"check-item ${c.s}\">\n                              <span>${c.s === 'ok' ? 'â—' : 'â—‹'}</span>\n                              ${c.m}\n                          </div>\n                      `).join('')}\n                  </div>\n                  <div class=\"info-block\">\n                      <div class=\"info-label\">Mimar DetayÄ±</div>\n                      <p style=\"font-size:0.85rem; color:#cbd5e1\">${data.details}</p>\n                      ${id === 'users' ? `\n                          <div style=\"margin-top:1rem; padding:10px; background:rgba(239, 68, 68, 0.1); border-radius:8px; border:1px solid var(--error);\">\n                              <strong style=\"color:var(--error); font-size:0.75rem;\">KRÄ°TÄ°K UYARI:</strong>\n                              <p style=\"font-size:0.75rem; color:#fff;\">Daha Ã¶nce tespit edilen .com e-posta hatasÄ± Pydantic validator ile engellenmiÅŸtir. ArtÄ±k sadece .edu.tr kabul edilir.</p>\n                          </div>\n                      ` : ''}\n                  </div>\n              </div>\n              <div class=\"info-label\">Kritik Kod MantÄ±ÄŸÄ± (Logic Preview)</div>\n              <div class=\"code-box\">${highlight(data.code)}</div>\n          `;\n      }\n\n      function highlight(c) {\n          return c.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")\n                  .replace(/\\b(def|return|class|if|else|import|from|async|await)\\b/g, '<span style=\"color:#c678dd\">$1</span>')\n                  .replace(/(\\w+)(?=\\()/g, '<span style=\"color:#61afef\">$1</span>')\n                  .replace(/(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g, '<span style=\"color:#98c379\">$1</span>');\n      }\n\n      init();\n    </script>\n  </body>\n</html>\n"
                },
                "database.py": {
                    "type": "text",
                    "content": "from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n# VeritabanÄ± baÄŸlantÄ± ayarlarÄ±\nSQLALCHEMY_DATABASE_URL = os.getenv(\"DATABASE_URL\", \"sqlite:///./artibir.db\")\n\n# Render/Heroku gibi platformlarda DATABASE_URL \"postgres://\" ile baÅŸlayabilir, \n# SQLAlchemy \"postgresql://\" bekler.\nif SQLALCHEMY_DATABASE_URL.startswith(\"postgres://\"):\n    SQLALCHEMY_DATABASE_URL = SQLALCHEMY_DATABASE_URL.replace(\"postgres://\", \"postgresql://\", 1)\n\n# Engine oluÅŸturma (SQLite iÃ§in check_same_thread gerekli, PostgreSQL iÃ§in deÄŸil)\nif SQLALCHEMY_DATABASE_URL.startswith(\"sqlite\"):\n    engine = create_engine(\n        SQLALCHEMY_DATABASE_URL, connect_args={\"check_same_thread\": False}\n    )\nelse:\n    engine = create_engine(\n        SQLALCHEMY_DATABASE_URL,\n        pool_pre_ping=True,\n        pool_recycle=3600\n    )\n\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\nBase = declarative_base()\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()"
                },
                "main.py": {
                    "type": "text",
                    "content": "from fastapi import FastAPI, Request\nfrom fastapi.responses import JSONResponse\nfrom fastapi.staticfiles import StaticFiles\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom slowapi import Limiter, _rate_limit_exceeded_handler\nfrom slowapi.util import get_remote_address\nfrom slowapi.errors import RateLimitExceeded\nimport logging\nimport models\nfrom database import engine\nfrom routers import (\n    auth, events, chat, location, wallet, reports, \n    gamification, settings, activity, support,\n    marketplace, reviews, payments, venues,\n    interact, live_tracking, media, users,\n    participants, security_management, notifications,\n    clubs, social, intelligence, search, feed, admin_api\n)\nimport os\nfrom dotenv import load_dotenv\nfrom utils import tracking\nimport json\n\n# --- LOGGING SETUP ---\nlogging.basicConfig(\n    level=logging.INFO,\n    format=\"%(asctime)s [%(levelname)s] %(message)s\",\n    handlers=[logging.StreamHandler()]\n)\nlogger = logging.getLogger(__name__)\n\nload_dotenv()\n\n# 1. VeritabanÄ± ve Kritik Ayar Kontrolleri\nif os.getenv(\"SECRET_KEY\") == \"super-secret-key-change-this-in-production-random-string\":\n    logger.warning(\"âš ï¸ UYARI: VarsayÄ±lan SECRET_KEY kullanÄ±lÄ±yor! LÃ¼tfen .env dosyasÄ±nda bunu gÃ¼ncelleyin.\")\n\ntry:\n    # NOT: Production ortamÄ±nda bu satÄ±r yorum satÄ±rÄ± yapÄ±lmalÄ± ve Alembic kullanÄ±lmalÄ±dÄ±r.\n    models.Base.metadata.create_all(bind=engine)\nexcept Exception as e:\n    logger.error(f\"UyarÄ±: Tablo oluÅŸturulurken hata oluÅŸtu: {e}\")\n\n# 2. UygulamayÄ± BaÅŸlat\n# Rate Limiter TanÄ±mlama (IP bazlÄ±)\nlimiter = Limiter(key_func=get_remote_address)\napp = FastAPI(title=\"ArtÄ±Bir Backend V2\")\napp.state.limiter = limiter\napp.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)\n\n# Global Exception Handler\n@app.exception_handler(Exception)\nasync def global_exception_handler(request: Request, exc: Exception):\n    logger.error(f\"Global Exception: {str(exc)}\")\n    return JSONResponse(\n        status_code=500,\n        content={\"message\": \"Sunucu hatasÄ± oluÅŸtu\", \"detail\": str(exc)},\n    )\n\n# CORS AyarlarÄ± (Web/Mobil eriÅŸimi iÃ§in geliÅŸtirme modu)\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n    expose_headers=[\"*\"],\n)\n\n# 2.5 JSON Tracking Middleware\n@app.middleware(\"http\")\nasync def json_tracking_middleware(request: Request, call_next):\n    # Ä°steÄŸi iÅŸle\n    response = await call_next(request)\n    \n    # Sadece belli metodlarÄ± ve hatalÄ± durumlarÄ± logla (Gereksiz ÅŸiÅŸmeyi Ã¶nlemek iÃ§in)\n    if request.method in [\"POST\", \"PUT\", \"DELETE\", \"PATCH\"] or response.status_code >= 400:\n        # Request body'sini okumak iÃ§in Ã¶zel iÅŸlem gerekebilir (stream olduÄŸu iÃ§in)\n        # Åimdilik basitÃ§e path ve status loglayalÄ±m\n        client_ip = request.client.host if request.client else \"unknown\"\n        \n        tracking.log_api_request(\n            method=request.method,\n            path=str(request.url.path),\n            status_code=response.status_code,\n            client_ip=client_ip\n        )\n        \n    return response\n\n# 3. Resim klasÃ¶rÃ¼nÃ¼ dÄ±ÅŸarÄ± aÃ§ (GÃ¶rÃ¼nÃ¼r yap)\n# KlasÃ¶r yoksa hata vermemesi iÃ§in oluÅŸturuyoruz\nos.makedirs(\"uploads/images\", exist_ok=True)\nos.makedirs(\"data\", exist_ok=True)\napp.mount(\"/uploads\", StaticFiles(directory=\"uploads\"), name=\"uploads\")\napp.mount(\"/data\", StaticFiles(directory=\"data\"), name=\"data\")\n# Ã–zel /images path'i (Routerdaki BASE_URL ile uyumlu olmasÄ± iÃ§in)\napp.mount(\"/images\", StaticFiles(directory=\"uploads/images\"), name=\"images\")\n\n# 4. RotalarÄ± (Endpointleri) Dahil Et\napp.include_router(auth.router)\napp.include_router(events.router)\napp.include_router(chat.router)\napp.include_router(location.router)\napp.include_router(wallet.router)\napp.include_router(reports.router)\napp.include_router(gamification.router)\napp.include_router(settings.router)\napp.include_router(activity.router)\napp.include_router(support.router)\napp.include_router(marketplace.router)\napp.include_router(reviews.router)\napp.include_router(payments.router)\napp.include_router(venues.router)\napp.include_router(interact.router)\napp.include_router(live_tracking.router)\napp.include_router(media.router)\napp.include_router(users.router)\napp.include_router(notifications.router)\napp.include_router(participants.router)\napp.include_router(security_management.router)\napp.include_router(clubs.router)\napp.include_router(social.router)\napp.include_router(intelligence.router)\napp.include_router(search.router)\napp.include_router(feed.router)\napp.include_router(admin_api.router)\n\n# 5. AÃ§Ä±lÄ±ÅŸ MesajÄ± (Health Check Ä°Ã§in HEAD desteklemeli)\n@app.api_route(\"/\", methods=[\"GET\", \"HEAD\"], include_in_schema=False)\ndef read_root():\n    return {\"message\": \"ArtÄ±Bir ModÃ¼ler Backend Ã‡alÄ±ÅŸÄ±yor! ğŸš€\"}\n\n@app.get(\"/dashboard\", include_in_schema=False)\ndef get_dashboard():\n    from fastapi.responses import FileResponse\n    return FileResponse(\"dashboard.html\")\n\n@app.get(\"/admin\", include_in_schema=False)\ndef get_admin():\n    from fastapi.responses import FileResponse\n    return FileResponse(\"admin.html\")\n\n@app.on_event(\"startup\")\nasync def startup_event():\n    logger.info(\"=\"*60)\n    logger.info(\"ğŸš€ ArtÄ±Bir Backend HazÄ±r!\")\n    logger.info(\"ğŸ“„ Swagger UI (DokÃ¼mantasyon): http://127.0.0.1:8000/docs\")\n    logger.info(\"=\"*60)"
                },
                "models.py": {
                    "type": "text",
                    "content": "import enum\nimport uuid\nimport datetime\nfrom sqlalchemy import Column, Integer, String, Boolean, ForeignKey, DateTime, Date, Enum as SAEnum, Numeric, Text, UniqueConstraint\nfrom sqlalchemy.dialects.postgresql import UUID\nfrom sqlalchemy.orm import relationship\nfrom database import Base\n# from geoalchemy2 import Geography # SQLite iÃ§in kapattÄ±k\n\n# Enums\nclass Gender(enum.Enum):\n    E = \"E\"\n    K = \"K\"\n\nclass TargetGender(enum.Enum):\n    HERKES = \"Herkes\"\n    SADECE_KIZLAR = \"Sadece KÄ±zlar\"\n    SADECE_ERKEKLER = \"Sadece Erkekler\"\n\nclass EventStatus(enum.Enum):\n    AKTIF = \"Aktif\"\n    DOLDU = \"Doldu\"\n    IPTAL = \"Ä°ptal\"\n    TAMAMLANDI = \"TamamlandÄ±\"\n\nclass ParticipantStatus(enum.Enum):\n    APPROVED = \"approved\"\n    BANNED = \"banned\"\n    WAITLIST = \"waitlist\"\n\nclass PaymentStatus(enum.Enum):\n    PENDING = \"pending\"\n    PAID = \"paid\"\n    REFUNDED = \"refunded\"\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    email = Column(String, unique=True, index=True)\n    password = Column(String)\n    full_name = Column(String)\n    profile_image = Column(String, nullable=True)\n    phone_number = Column(String, nullable=True)\n    city = Column(String, index=True, nullable=True)\n    \n    # Updated & New Fields\n    is_verified = Column(Boolean, default=False)\n    student_document_url = Column(String(255), nullable=True)\n    birth_date = Column(Date, nullable=False)\n    gender = Column(SAEnum(Gender), nullable=False)\n    trust_score = Column(Integer, default=100) \n    wallet_balance = Column(Numeric(10, 2), default=0.00)\n    department = Column(String, nullable=True)\n    \n    # --- AYARLAR VE AKTÄ°VÄ°TE MERKEZÄ° ALANLARI ---\n    bio = Column(Text, nullable=True)\n    favorite_music_url = Column(String(255), nullable=True)\n    \n    # Gizlilik\n    is_private = Column(Boolean, default=False)\n    ghost_mode = Column(Boolean, default=False)\n    show_way_to_everyone = Column(Boolean, default=True) # \"YoldayÄ±m\" modu kimlere gÃ¶rÃ¼nsÃ¼n?\n    \n    # Tercihler\n    theme_preference = Column(String(20), default=\"dark\") # dark, light\n    language_preference = Column(String(10), default=\"tr\") # tr, en\n    data_saver_mode = Column(Boolean, default=False)\n    \n    # Bildirimler\n    notify_event_reminders = Column(Boolean, default=True)\n    notify_campus_announcements = Column(Boolean, default=True)\n    notify_social = Column(Boolean, default=True)\n    \n    # --- KONUM TAKÄ°BÄ° ---\n    current_latitude = Column(Numeric(10, 8), nullable=True)\n    current_longitude = Column(Numeric(11, 8), nullable=True)\n    last_location_update = Column(DateTime, default=datetime.datetime.utcnow, onupdate=datetime.datetime.utcnow)\n    \n    # --- KÄ°MLÄ°K DOÄRULAMA VE MAVÄ° TÄ°K ---\n    tc_no = Column(String(11), nullable=True) # 11 haneli TC No\n    id_card_front_url = Column(String(255), nullable=True)\n    id_card_back_url = Column(String(255), nullable=True)\n    blue_tick_status = Column(String(20), default=\"none\") # none, pending, approved, rejected\n    \n    # Email & Phone Verification\n    is_email_verified = Column(Boolean, default=False)\n    is_phone_verified = Column(Boolean, default=False)\n    email_verification_code = Column(String(6), nullable=True)\n    phone_verification_code = Column(String(6), nullable=True)\n    password_reset_code = Column(String(6), nullable=True)\n    \n    # Student Document Verification\n    student_document_barcode = Column(String(50), nullable=True)\n    is_student_verified = Column(Boolean, default=False)\n\nclass Event(Base):\n    __tablename__ = \"events\"\n\n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    host_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    \n    title = Column(String, index=True)\n    description = Column(String)\n    date = Column(DateTime, default=datetime.datetime.utcnow)\n    \n    # Location: Enlem/Boylam verisi\n    # Location: Enlem/Boylam verisi\n    # SQLite uyumluluÄŸu iÃ§in Geography yerine normal string (WKT formatÄ±nda tutulabilir)\n    # Veya sadece lat/lon ayrÄ± kolonlarda tutulmalÄ±.\n    # Åimdilik hata vermemesi iÃ§in bunu string yapÄ±yoruz veya pass geÃ§iyoruz (zaten lat/lon var mÄ±?)\n    # Modelde location var ama crud.py lat/lon kullanÄ±yor ve WKT'ye Ã§eviriyor.\n    # SQLite hatasÄ±nÄ± Ã¶nlemek iÃ§in type'Ä± String yapÄ±yoruz.\n    location = Column(String, nullable=True)\n    \n    # SQLite ve Bounding Box sorgularÄ± iÃ§in gerekli\n    latitude = Column(Numeric(10, 8), nullable=True)\n    longitude = Column(Numeric(11, 8), nullable=True)\n    \n    min_age_limit = Column(Integer)\n    max_age_limit = Column(Integer)\n    target_gender = Column(SAEnum(TargetGender), default=TargetGender.HERKES)\n    status = Column(SAEnum(EventStatus), default=EventStatus.AKTIF)\n    \n    # New Fields based on User's SQL\n    campus_restriction = Column(String(100), nullable=True)\n    gender_restriction = Column(String(10), nullable=True) # User requested 'mixed', 'female_only' etc.\n    deposit_amount = Column(Numeric(10, 2), default=0.00)\n    session_token = Column(String(255), nullable=True)\n\n    city = Column(String, index=True, nullable=True)\n    campus = Column(String, index=True, nullable=True)\n    category = Column(String, index=True, nullable=True)\n    image_url = Column(String, nullable=True)\n    external_url = Column(String, nullable=True)\n    \n    # Eksik Kolonlar\n    capacity = Column(Integer, default=10) # Maksimum katÄ±lÄ±mcÄ± sayÄ±sÄ±\n    price = Column(Numeric(10, 2), default=0.00) # Ãœcretli etkinlikler iÃ§in\n    location_name = Column(String(255), nullable=True) # \"MecidiyekÃ¶y Starbucks\" gibi aÃ§Ä±k adres\n\n    club_id = Column(Integer, ForeignKey(\"clubs.id\"), nullable=True) # KulÃ¼p etkinliÄŸi ise\n\n    host = relationship(\"User\", foreign_keys=[host_id])\n    club = relationship(\"Club\", back_populates=\"events\")\n\nclass EventParticipant(Base):\n    __tablename__ = \"event_participants\"\n\n    id = Column(Integer, primary_key=True)\n    event_id = Column(UUID(as_uuid=True), ForeignKey(\"events.id\"))\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    status = Column(String(20), default=\"approved\") # approved, banned, waitlist\n    payment_status = Column(String(20), default=\"pending\") # pending, paid, refunded\n    qr_scanned = Column(Boolean, default=False)\n    check_in_time = Column(DateTime, nullable=True)\n\n    __table_args__ = (UniqueConstraint('event_id', 'user_id', name='_event_user_uc'),)\n\n    event = relationship(\"Event\")\n    user = relationship(\"User\")\n\nclass UserReport(Base):\n    __tablename__ = \"user_reports\"\n\n    id = Column(Integer, primary_key=True)\n    reporter_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    reported_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    event_id = Column(UUID(as_uuid=True), ForeignKey(\"events.id\"))\n    reason = Column(String(50)) # noshow, harassment, toxic\n    details = Column(Text, nullable=True)\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\nclass LiveTracking(Base):\n    __tablename__ = \"event_live_tracking\"\n\n    id = Column(Integer, primary_key=True)\n    event_id = Column(UUID(as_uuid=True), ForeignKey(\"events.id\"))\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    latitude = Column(Numeric(10, 8))\n    longitude = Column(Numeric(11, 8))\n    status = Column(String(20), default=\"waiting\") # on_way, arrived\n    transport_type = Column(String(20), default=\"walk\")\n    last_updated = Column(DateTime, default=datetime.datetime.utcnow, onupdate=datetime.datetime.utcnow)\n\nclass VoiceRoom(Base):\n    __tablename__ = \"voice_rooms\"\n\n    id = Column(Integer, primary_key=True)\n    event_id = Column(UUID(as_uuid=True), ForeignKey(\"events.id\"), unique=True)\n    room_token = Column(String(255))\n    is_active = Column(Boolean, default=True)\n    expires_at = Column(DateTime)\n\nclass IcebreakerQuestion(Base):\n    __tablename__ = \"icebreaker_questions\"\n\n    id = Column(Integer, primary_key=True)\n    category = Column(String(50)) # TanÄ±ÅŸma, EÄŸlence, Spor\n    question_text = Column(Text)\n    is_active = Column(Boolean, default=True)\n\nclass ChatLog(Base):\n    __tablename__ = \"activity_chat_logs\"\n\n    id = Column(Integer, primary_key=True)\n    event_id = Column(UUID(as_uuid=True), ForeignKey(\"events.id\"))\n    question_id = Column(Integer, ForeignKey(\"icebreaker_questions.id\"))\n    sent_at = Column(DateTime, default=datetime.datetime.utcnow)\n\nclass Badge(Base):\n    __tablename__ = \"badges\"\n\n    id = Column(Integer, primary_key=True)\n    name = Column(String(50))\n    icon_url = Column(String(255))\n    criteria_type = Column(String(50))\n    threshold = Column(Integer)\n\nclass UserBadge(Base):\n    __tablename__ = \"user_badges\"\n\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"), primary_key=True)\n    badge_id = Column(Integer, ForeignKey(\"badges.id\"), primary_key=True)\n    earned_at = Column(DateTime, default=datetime.datetime.utcnow)\n\nclass Message(Base):\n    __tablename__ = \"messages\"\n\n    id = Column(Integer, primary_key=True)\n    sender_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    receiver_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    content = Column(String)\n    timestamp = Column(DateTime, default=datetime.datetime.utcnow)\n    is_read = Column(Boolean, default=False)\n\n    sender = relationship(\"User\", foreign_keys=[sender_id])\n    receiver = relationship(\"User\", foreign_keys=[receiver_id])\n\nclass LoginDevice(Base):\n    __tablename__ = \"login_devices\"\n    id = Column(Integer, primary_key=True)\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    device_name = Column(String(100))\n    last_login = Column(DateTime, default=datetime.datetime.utcnow)\n    ip_address = Column(String(45))\n    is_active = Column(Boolean, default=True)\n\nclass EventLike(Base):\n    __tablename__ = \"event_likes\"\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"), primary_key=True)\n    event_id = Column(UUID(as_uuid=True), ForeignKey(\"events.id\"), primary_key=True)\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\nclass SavedCard(Base):\n    __tablename__ = \"saved_cards\"\n    id = Column(Integer, primary_key=True)\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    card_holder = Column(String(100))\n    last_four = Column(String(4))\n    card_type = Column(String(20)) # visa, mastercard, troy\n    card_token = Column(String(255), nullable=True) # Iyzico cardToken\n    card_user_key = Column(String(255), nullable=True) # Iyzico cardUserKey\n    expiry_date = Column(String(5), nullable=True) # MM/YY\n\nclass SupportTicket(Base):\n    __tablename__ = \"support_tickets\"\n    id = Column(Integer, primary_key=True)\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    subject = Column(String(100))\n    message = Column(Text)\n    status = Column(String(20), default=\"open\") # open, closed, pending\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\nclass Transaction(Base):\n    __tablename__ = \"transactions\"\n    id = Column(Integer, primary_key=True)\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    amount = Column(Numeric(10, 2))\n    payment_id = Column(String(50), nullable=True)\n    conversation_id = Column(String(50), nullable=True) # Iyzico conversationId\n    status = Column(SAEnum(PaymentStatus), default=PaymentStatus.PENDING)\n    transaction_type = Column(String(20)) # deposit, payment, refund\n    description = Column(String(255), nullable=True)\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\n    user = relationship(\"User\")\n\nclass MarketplaceItem(Base):\n    __tablename__ = \"marketplace_items\"\n    id = Column(Integer, primary_key=True)\n    owner_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    title = Column(String(100), index=True)\n    description = Column(Text)\n    price = Column(Numeric(10, 2))\n    category = Column(String(50), index=True) # Kitap, EÅŸya, Not vb.\n    image_url = Column(String(255), nullable=True)\n    status = Column(String(20), default=\"active\") # active, sold, deleted\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\n    owner = relationship(\"User\")\n\nclass UserReview(Base):\n    __tablename__ = \"user_reviews\"\n    id = Column(Integer, primary_key=True)\n    reviewer_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    reviewed_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    event_id = Column(UUID(as_uuid=True), ForeignKey(\"events.id\"), nullable=True)\n    rating = Column(Integer) # 1-5\n    comment = Column(Text, nullable=True)\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\n    reviewer = relationship(\"User\", foreign_keys=[reviewer_id])\n    reviewed = relationship(\"User\", foreign_keys=[reviewed_id])\n\nclass CampusVenue(Base):\n    __tablename__ = \"campus_venues\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String(100), index=True)\n    latitude = Column(Numeric(10, 8))\n    longitude = Column(Numeric(11, 8))\n    address = Column(String(255))\n    discount_rate = Column(Integer) # YÃ¼zde indirim\n    category = Column(String(50)) # Kafe, Restoran, Kitabevi\n    is_active = Column(Boolean, default=True)\n\nclass Notification(Base):\n    __tablename__ = \"notifications\"\n\n    id = Column(Integer, primary_key=True)\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    title = Column(String(100))\n    message = Column(Text)\n    type = Column(String(20)) # system, event, social\n    is_read = Column(Boolean, default=False)\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\n    user = relationship(\"User\")\n\nclass Club(Base):\n    __tablename__ = \"clubs\"\n    id = Column(Integer, primary_key=True)\n    name = Column(String(100), index=True, unique=True)\n    description = Column(Text)\n    logo_url = Column(String(255), nullable=True)\n    is_official = Column(Boolean, default=False)\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\n    members = relationship(\"ClubMember\", back_populates=\"club\")\n    events = relationship(\"Event\", back_populates=\"club\")\n\nclass ClubMember(Base):\n    __tablename__ = \"club_members\"\n    club_id = Column(Integer, ForeignKey(\"clubs.id\"), primary_key=True)\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"), primary_key=True)\n    role = Column(String(20), default=\"member\") # admin, moderator, member\n    joined_at = Column(DateTime, default=datetime.datetime.utcnow)\n\n    club = relationship(\"Club\", back_populates=\"members\")\n    user = relationship(\"User\")\n\nclass Friendship(Base):\n    __tablename__ = \"friendships\"\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"), primary_key=True)\n    friend_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"), primary_key=True)\n    status = Column(String(20), default=\"pending\") # pending, accepted, blocked\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n\nclass EventMoment(Base):\n    __tablename__ = \"event_moments\"\n    id = Column(Integer, primary_key=True)\n    event_id = Column(UUID(as_uuid=True), ForeignKey(\"events.id\"))\n    user_id = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"))\n    media_url = Column(String(255))\n    caption = Column(String(100), nullable=True)\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n    expires_at = Column(DateTime) # created_at + 24 hours\n"
                },
                "README.md": {
                    "type": "text",
                    "content": "# ğŸš€ ArtÄ±Bir Backend V2: Modern Sosyal Etkinlik Platformu\n\nBu proje, Ã¼niversite Ã¶ÄŸrencileri ve topluluklar iÃ§in geliÅŸtirilmiÅŸ, **GÃ¼ven DeÄŸiÅŸkeni (Trust Score)** odaklÄ±, yÃ¼ksek performanslÄ± bir **FastAPI** backend servisidir. ArtÄ±Bir V2, simÃ¼lasyonlarÄ± bir kenara bÄ±rakÄ±p **GerÃ§ek DÃ¼nya DoÄŸrulama** sistemlerini (TCKN, SMS, Email) Ã§ekirdeÄŸine entegre eder.\n\n---\n\n## âœ¨ Ã–ne Ã‡Ä±kan Ã–zellikler\n\n### ğŸ›¡ï¸ GerÃ§ek DÃ¼nya DoÄŸrulama KatmanlarÄ±\n\n- **NVÄ° Kimlik DoÄŸrulamasÄ±:** TCKN, ad, soyad ve doÄŸum yÄ±lÄ± verilerini doÄŸrudan devlet kanallarÄ± (NVÄ° SOAP API) Ã¼zerinden doÄŸrular.\n- **SMS & Telefon OnayÄ±:** GerÃ§ek SMS gateway entegrasyonu ile telefon numarasÄ± sahipliÄŸini doÄŸrular.\n- **E-posta DoÄŸrulamasÄ±:** SMTP Ã¼zerinden gÃ¶nderilen OTP kodlarÄ± ile kurumsal/kiÅŸisel e-posta onayÄ±.\n- **Mavi Tik Sistemi:** TÃ¼m doÄŸrulama adÄ±mlarÄ±nÄ± tamamlayan kullanÄ±cÄ±lara \"OnaylÄ± Profil\" statÃ¼sÃ¼ verilir.\n\n### ğŸ“Š GÃ¼ven Skorlama (Trust Score)\n\nKullanÄ±cÄ±larÄ±n platformdaki gÃ¼venilirliÄŸi, tamamladÄ±klarÄ± doÄŸrulamalara gÃ¶re dinamik olarak hesaplanÄ±r.\n\n### ğŸ™ï¸ AkÄ±llÄ± Etkinlik YÃ¶netimi\n\n- **Konum OdaklÄ± KeÅŸif:** KullanÄ±cÄ±larÄ±n etrafÄ±ndaki etkinlikleri enlem/boylam bazlÄ± (Bounding Box) filtreleme.\n- **ModÃ¼ler YapÄ±:** Her Ã¶zellik (Chat, CÃ¼zdan, Etkinlik, Kimlik vb.) baÄŸÄ±msÄ±z router'lar ile yÃ¶netilir.\n\n---\n\n## ğŸ—ï¸ Proje Mimarisi\n\n```text\nArtibir_Backend_V2/\nâ”œâ”€â”€ routers/              # ModÃ¼ler API Servisleri (Auth, Chat, Events, Verification vb.)\nâ”œâ”€â”€ services/             # Ä°ÅŸ MantÄ±ÄŸÄ± KatmanÄ± (GÃ¶rÃ¼ntÃ¼ Ä°ÅŸleme, Ã–deme, Bildirim)\nâ”œâ”€â”€ utils/                # Harici API EntegrasyonlarÄ± (NVÄ° Verifier, SMS Gateway)\nâ”œâ”€â”€ models.py             # SQLAlchemy VeritabanÄ± Modelleri\nâ”œâ”€â”€ schemas.py            # Pydantic Veri DoÄŸrulama ÅemalarÄ±\nâ”œâ”€â”€ security.py           # JWT & Bcrypt GÃ¼venlik KatmanÄ±\nâ”œâ”€â”€ database.py           # PostgreSQL & SQLite Hibrit BaÄŸlantÄ± MantÄ±ÄŸÄ±\nâ”œâ”€â”€ main.py               # Uygulama GiriÅŸ NoktasÄ± & Global Hata YÃ¶netimi\nâ””â”€â”€ requirements.txt      # BaÄŸÄ±mlÄ±lÄ±k Listesi\n```\n\n---\n\n## ğŸ› ï¸ Teknoloji YÄ±ÄŸÄ±nÄ±\n\n- **Framework:** FastAPI (Asynchronous Python)\n- **Database:** PostgreSQL (Production) / SQLite (Local)\n- **ORM:** SQLAlchemy 2.0\n- **Authentication:** JWT (JSON Web Token)\n- **Integration:** NVÄ° SOAP Service, SMS/SMTP Gateways\n- **Deployment:** Railway.app / Docker Ready\n\n---\n\n## ğŸš€ HÄ±zlÄ± BaÅŸlangÄ±Ã§\n\n### 1. Yerel Kurulum\n\n```bash\n# Depoyu klonlayÄ±n\ngit clone https://github.com/mhsnn02/artibir-backend-v2.git\ncd artibir-backend-v2\n\n# Sanal ortam oluÅŸturun ve aktif edin\npython -m venv .venv\nsource .venv/bin/activate  # Windows: .venv\\Scripts\\activate\n\n# BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kleyin\npip install -r requirements.txt\n```\n\n### 2. YapÄ±landÄ±rma (.env)\n\n```env\nSQLALCHEMY_DATABASE_URL=postgresql://user:pass@host/db\nSECRET_KEY=yoursupersecretkey\nACCESS_TOKEN_EXPIRE_MINUTES=10080\n```\n\n### 3. Ã‡alÄ±ÅŸtÄ±rma\n\n```bash\nuvicorn main:app --reload\n```\n\nAPI dÃ¶kÃ¼mantasyonuna ÅŸu adresten ulaÅŸabilirsiniz: `http://localhost:8000/docs`\n\n---\n\n## ğŸš¢ Deployment (Railway.app)\n\nBu proje Railway Ã¼zerinde sÄ±fÄ±r konfigÃ¼rasyon ile Ã§alÄ±ÅŸacak ÅŸekilde optimize edilmiÅŸtir.\n\n- `Procfile` dosyasÄ± hazÄ±r.\n- PostgreSQL baÄŸlantÄ±sÄ± otomatik algÄ±lanÄ±r.\n- `/sys-admin/force-reset-db` endpoint'i ile uzaktan ÅŸema kurulumu desteklenir.\n\n---\n\n## ğŸ‘¨â€ğŸ’» GeliÅŸtirici\n\n**mhsnn02** - [GitHub](https://github.com/mhsnn02) tarafÄ±ndan ArtÄ±Bir projesi iÃ§in geliÅŸtirilmiÅŸtir.\n"
                },
                "requirements.txt": {
                    "type": "text",
                    "content": "alembic==1.17.2\nannotated-doc==0.0.4\nannotated-types==0.7.0\nanyio==4.12.1\nbcrypt==3.2.0\nbeautifulsoup4==4.14.3\ncertifi==2026.1.4\ncffi==2.0.0\ncharset-normalizer==3.4.4\nclick==8.3.1\ncolorama==0.4.6\ncryptography==46.0.3\ndnspython==2.8.0\necdsa==0.19.1\nemail-validator==2.3.0\nfastapi==0.128.0\nGeoAlchemy2==0.18.1\ngreenlet==3.3.0\nh11==0.16.0\nidna==3.11\niyzipay==1.0.45\nlxml==6.0.2\nMako==1.3.10\nMarkupSafe==3.0.3\npackaging==25.0\npasslib==1.7.4\npillow==12.1.0\npsycopg2-binary==2.9.11\npyasn1==0.6.1\npycparser==2.23\npydantic==2.12.5\npydantic_core==2.41.5\npython-dotenv==1.2.1\npython-jose==3.5.0\npython-multipart==0.0.21\nredis==7.1.0\nrequests==2.32.5\nrsa==4.9.1\nsix==1.17.0\nslowapi==0.1.9\nsoupsieve==2.8.1\nSQLAlchemy==2.0.45\nstarlette==0.50.0\ntyping-inspection==0.4.2\ntyping_extensions==4.15.0\nurllib3==2.6.3\nuvicorn==0.40.0\nwebsockets==16.0\ngunicorn\n"
                },
                "schemas.py": {
                    "type": "text",
                    "content": "from pydantic import BaseModel, EmailStr, field_validator, ConfigDict, Field\nfrom typing import Optional, List\nfrom uuid import UUID\nfrom datetime import date, datetime\nimport enum\nimport re\n\n# Enums\nclass Gender(str, enum.Enum):\n    E = \"E\"\n    K = \"K\"\n\nclass TargetGender(str, enum.Enum):\n    HERKES = \"Herkes\"\n    SADECE_KIZLAR = \"Sadece KÄ±zlar\"\n    SADECE_ERKEKLER = \"Sadece Erkekler\"\n\nclass EventStatus(str, enum.Enum):\n    AKTIF = \"Aktif\"\n    DOLDU = \"Doldu\"\n    IPTAL = \"Ä°ptal\"\n    TAMAMLANDI = \"TamamlandÄ±\"\n\n# --- Token Schemas ---\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n\nclass TokenData(BaseModel):\n    email: Optional[str] = None\n\n# --- User Schemas ---\nclass UserBase(BaseModel):\n    email: EmailStr = Field(..., examples=[\"ogrenci@universite.edu.tr\"])\n    full_name: str = Field(..., examples=[\"Ahmet YÄ±lmaz\"])\n    phone_number: Optional[str] = Field(None, examples=[\"+905551234567\"])\n    city: Optional[str] = Field(None, examples=[\"Ä°stanbul\"])\n    \n    # New Fields\n    birth_date: date\n    gender: Gender\n    department: Optional[str] = None\n\n    @field_validator('phone_number')\n    def validate_phone_number(cls, v):\n        if v is None: return v\n        pattern = r\"^\\+?[1-9]\\d{1,14}$\"\n        if not re.match(pattern, v):\n            raise ValueError('Telefon numarasÄ± geÃ§ersiz. Ã–rnek: +905551234567')\n        return v\n\n    @field_validator('email')\n    def validate_edu_email(cls, v):\n        if not v.endswith('.edu.tr'):\n            raise ValueError('Sadece Ã¼niversite e-postalarÄ± (.edu.tr) kabul edilmektedir.')\n        return v\n\nclass UserCreate(UserBase):\n    password: str\n\n    @field_validator('password')\n    def validate_password(cls, v):\n        if len(v) < 8: raise ValueError('Åifre en az 8 karakter olmalÄ±dÄ±r.')\n        if not re.search(r\"[A-Z]\", v): raise ValueError('Åifre en az bir bÃ¼yÃ¼k harf iÃ§ermelidir.')\n        if not re.search(r\"[a-z]\", v): raise ValueError('Åifre en az bir kÃ¼Ã§Ã¼k harf iÃ§ermelidir.')\n        if not re.search(r\"\\d\", v): raise ValueError('Åifre en az bir rakam iÃ§ermelidir.')\n        return v\n\nclass UserLogin(BaseModel):\n    email: EmailStr = Field(..., examples=[\"ogrenci@universite.edu.tr\"])\n    password: str = Field(..., examples=[\"Sifre123!\"])\n\n    @field_validator('email')\n    def validate_edu_email(cls, v):\n        if not v.endswith('.edu.tr'):\n            raise ValueError('GiriÅŸ yapmak iÃ§in .edu.tr uzantÄ±lÄ± e-posta adresinizi kullanmalÄ±sÄ±nÄ±z.')\n        return v\n\nclass UserPublic(BaseModel):\n    id: UUID\n    full_name: str\n    profile_image: Optional[str] = None\n    city: Optional[str] = None\n    gender: Gender\n    department: Optional[str] = None\n    trust_score: int\n    \n    bio: Optional[str] = None\n    favorite_music_url: Optional[str] = None\n    blue_tick_status: str\n    is_verified: bool\n    \n    model_config = ConfigDict(from_attributes=True)\n\nclass UserOut(UserBase):\n    id: UUID\n    profile_image: Optional[str] = None\n    is_verified: bool\n    student_document_url: Optional[str] = None\n    trust_score: int\n    wallet_balance: float\n    \n    # Settings & Verification\n    bio: Optional[str] = None\n    favorite_music_url: Optional[str] = None\n    is_private: bool\n    ghost_mode: bool\n    theme_preference: str\n    language_preference: str\n    \n    # Verification Info\n    blue_tick_status: str\n    is_verified: bool\n    \n    model_config = ConfigDict(from_attributes=True)\n\nclass UserProfileUpdate(BaseModel):\n    full_name: Optional[str] = None\n    bio: Optional[str] = None\n    favorite_music_url: Optional[str] = None\n    profile_image: Optional[str] = None\n    tc_no: Optional[str] = None\n    birth_date: Optional[date] = None\n    id_card_front_url: Optional[str] = None\n    id_card_back_url: Optional[str] = None\n\nclass StudentVerifyRequest(BaseModel):\n    barcode: str\n    full_name: Optional[str] = None # EÄŸer boÅŸsa mevcut kullanÄ±cÄ± adÄ± kullanÄ±lÄ±r\n\nclass UserSettingsUpdate(BaseModel):\n    is_private: Optional[bool] = None\n    ghost_mode: Optional[bool] = None\n    show_way_to_everyone: Optional[bool] = None\n    theme_preference: Optional[str] = None\n    language_preference: Optional[str] = None\n    data_saver_mode: Optional[bool] = None\n    notify_event_reminders: Optional[bool] = None\n    notify_campus_announcements: Optional[bool] = None\n    notify_social: Optional[bool] = None\n\nclass PasswordChange(BaseModel):\n    old_password: str\n    new_password: str\n\nclass LoginDeviceOut(BaseModel):\n    id: int\n    device_name: str\n    last_login: datetime\n    ip_address: Optional[str]\n    is_active: bool\n    \n    model_config = ConfigDict(from_attributes=True)\n\nclass SavedCardOut(BaseModel):\n    id: int\n    card_holder: str\n    last_four: str\n    card_type: str\n    expiry_date: Optional[str] = None\n    \n    model_config = ConfigDict(from_attributes=True)\n\nclass SupportTicketCreate(BaseModel):\n    subject: str\n    message: str\n\nclass SupportTicketOut(BaseModel):\n    id: int\n    subject: str\n    message: str\n    status: str\n    created_at: datetime\n    \n    model_config = ConfigDict(from_attributes=True)\n\n# --- Event Schemas ---\nclass EventBase(BaseModel):\n    title: str\n    description: str\n    date: datetime\n    \n    # Location updates\n    latitude: float\n    longitude: float\n\n    min_age_limit: int\n    max_age_limit: int\n    target_gender: TargetGender = TargetGender.HERKES\n    status: EventStatus = EventStatus.AKTIF\n\n    # New Fields from SQL\n    campus_restriction: Optional[str] = None\n    gender_restriction: Optional[str] = None\n    deposit_amount: float = 0.00\n\n    city: Optional[str] = None\n    campus: Optional[str] = None\n    category: Optional[str] = None\n    image_url: Optional[str] = None\n    external_url: Optional[str] = None\n    \n    # Eksik Kolonlar\n    capacity: int = 10\n    price: float = 0.00\n    location_name: Optional[str] = None\n\nclass EventCreate(EventBase):\n    # Session token sadece oluÅŸturulurken veya sunucu tarafÄ±nda set edilir\n    session_token: Optional[str] = None\n\nclass EventOut(EventBase):\n    id: UUID\n    host_id: UUID\n    \n    model_config = ConfigDict(from_attributes=True)\n\n# --- Message Schemas ---\nclass MessageCreate(BaseModel):\n    receiver_id: UUID\n    content: str\n    \n    @field_validator('content')\n    def validate_content(cls, v):\n        if not v.strip(): raise ValueError('Mesaj boÅŸ olamaz.')\n        if len(v) > 1000: raise ValueError('Mesaj Ã§ok uzun.')\n        return v\n\nclass MessageOut(BaseModel):\n    id: int\n    sender_id: UUID\n    receiver_id: UUID\n    content: str\n    timestamp: datetime\n    is_read: bool\n\n    model_config = ConfigDict(from_attributes=True)\n\n# --- Marketplace Schemas ---\nclass MarketplaceItemBase(BaseModel):\n    title: str\n    description: str\n    price: float\n    category: str # Kitap, EÅŸya, Not\n    image_url: Optional[str] = None\n\nclass MarketplaceItemCreate(MarketplaceItemBase):\n    pass\n\nclass MarketplaceItemOut(MarketplaceItemBase):\n    id: int\n    owner_id: UUID\n    status: str\n    created_at: datetime\n    \n    model_config = ConfigDict(from_attributes=True)\n\n# --- Review Schemas ---\nclass UserReviewCreate(BaseModel):\n    reviewed_id: UUID\n    event_id: Optional[UUID] = None\n    rating: int \n    comment: Optional[str] = None\n\n    @field_validator('rating')\n    def validate_rating(cls, v):\n        if not 1 <= v <= 5: raise ValueError('Puan 1 ile 5 arasÄ±nda olmalÄ±dÄ±r.')\n        return v\n\nclass UserReviewOut(BaseModel):\n    id: int\n    reviewer_id: UUID\n    reviewed_id: UUID\n    rating: int\n    comment: Optional[str] = None\n    created_at: datetime\n    \n    model_config = ConfigDict(from_attributes=True)\n\n# --- Venue (Discount Map) Schemas ---\nclass CampusVenueOut(BaseModel):\n    id: Optional[int] = None\n    name: str\n    latitude: float\n    longitude: float\n    address: str\n    discount_rate: int\n    category: str\n    \n    model_config = ConfigDict(from_attributes=True)\n\n# --- Payment & Iyzico Schemas ---\nclass PaymentInitialize(BaseModel):\n    card_holder_name: str\n    card_number: str\n    expire_month: str\n    expire_year: str\n    cvc: str\n    amount: float\n    register_card: bool = False\n\nclass Payment3DSResult(BaseModel):\n    status: str\n    paymentId: Optional[str] = None\n    conversationId: Optional[str] = None\n    mdStatus: Optional[str] = None # 3DS Status\n\nclass TransactionOut(BaseModel):\n    id: int\n    amount: float\n    status: str\n    transaction_type: str\n    description: Optional[str] = None\n    created_at: datetime\n    \n    model_config = ConfigDict(from_attributes=True)\n\n# --- Location Schemas ---\nclass LocationUpdate(BaseModel):\n    user_id: UUID\n    latitude: float\n    longitude: float\n    is_ghost_mode: bool = False\n\nclass NotificationOut(BaseModel):\n    id: int\n    title: str\n    message: str\n    type: str\n    is_read: bool\n    created_at: datetime\n    \n    model_config = ConfigDict(from_attributes=True)\n\n# --- Club & Social Schemas ---\nclass ClubBase(BaseModel):\n    name: str = Field(..., examples=[\"MÃ¼zik KulÃ¼bÃ¼\"])\n    description: str\n    logo_url: Optional[str] = None\n    is_official: bool = False\n\nclass ClubCreate(ClubBase):\n    pass\n\nclass ClubOut(ClubBase):\n    id: int\n    created_at: datetime\n    model_config = ConfigDict(from_attributes=True)\n\nclass ClubMemberOut(BaseModel):\n    user_id: UUID\n    role: str\n    joined_at: datetime\n    model_config = ConfigDict(from_attributes=True)\n\nclass FriendshipRequest(BaseModel):\n    friend_id: UUID\n\nclass FriendshipOut(BaseModel):\n    user_id: UUID\n    friend_id: UUID\n    status: str\n    created_at: datetime\n    model_config = ConfigDict(from_attributes=True)\n\nclass MomentCreate(BaseModel):\n    event_id: UUID\n    media_url: str\n    caption: Optional[str] = None\n\nclass MomentOut(BaseModel):\n    id: int\n    event_id: UUID\n    user_id: UUID\n    media_url: str\n    caption: Optional[str]\n    created_at: datetime\n    expires_at: datetime\n    model_config = ConfigDict(from_attributes=True)\n"
                },
                "security.py": {
                    "type": "text",
                    "content": "from passlib.context import CryptContext\nfrom datetime import datetime, timedelta\nfrom typing import Optional\nfrom jose import jwt\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n# Ortam deÄŸiÅŸkenlerini al veya gÃ¼venli varsayÄ±lanlar kullan\nSECRET_KEY = os.getenv(\"SECRET_KEY\", \"7b9e9d6d4a5f4c8b9a2e1d0c3b4a5f6e7d8c9b0a1a2b3c4d5e6f7a8b9c0d1e2f\")\nALGORITHM = os.getenv(\"ALGORITHM\", \"HS256\")\nACCESS_TOKEN_EXPIRE_MINUTES = int(os.getenv(\"ACCESS_TOKEN_EXPIRE_MINUTES\", 30))\n\n# Åifreleme algoritmasÄ± ayarÄ± (bcrypt kullanÄ±yoruz, Ã§ok gÃ¼venlidir)\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n\n# 1. Åifre DoÄŸrulama (GiriÅŸ yaparken kullanÄ±lÄ±r)\ndef verify_password(plain_password, hashed_password):\n    return pwd_context.verify(plain_password, hashed_password)\n\n# 2. Åifre Kriptolama (KayÄ±t olurken kullanÄ±lÄ±r)\ndef get_password_hash(password):\n    return pwd_context.hash(password)\n\n# 3. JWT Token OluÅŸturma\ndef create_access_token(data: dict, expires_delta: Optional[timedelta] = None):\n    to_encode = data.copy()\n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\n    \n    to_encode.update({\"exp\": expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\n\n# 4. Token Ã‡Ã¶zme\ndef decode_access_token(token: str):\n    try:\n        # AlgoritmayÄ± aÃ§Ä±kÃ§a belirtiyoruz (Environment variable sorunu yaÅŸamamak iÃ§in)\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[\"HS256\"])\n        return payload\n    except Exception as e:\n        print(f\"Token Decode Error: {e}\")\n        return None\n\n# 5. Aktif KullanÄ±cÄ±yÄ± Getir (Dependencies iÃ§in)\nfrom fastapi import Depends, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer\nfrom sqlalchemy.orm import Session\nimport database, crud, models\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"auth/login\")\n\ndef get_current_user(token: str = Depends(oauth2_scheme), db: Session = Depends(database.get_db)):\n    credentials_exception = HTTPException(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        detail=\"Could not validate credentials\",\n        headers={\"WWW-Authenticate\": \"Bearer\"},\n    )\n    payload = decode_access_token(token)\n    if payload is None:\n        raise credentials_exception\n    \n    email: str = payload.get(\"sub\")\n    if email is None:\n        raise credentials_exception\n        \n    user = crud.get_user_by_email(db, email=email)\n    if user is None:\n        raise credentials_exception\n    return user"
                }
            }
        },
        "app": {
            "directories": [],
            "files": {}
        },
        "data": {
            "directories": [],
            "files": {
                "backend_matrix_report.json": {
                    "type": "text",
                    "content": "{\n  \"metadata\": {\n    \"type\": \"Matrix/Grid Report\",\n    \"generated_at\": \"2026-01-30T19:51:11.131749\",\n    \"description\": \"Compact representation of data in matrix (row/column) format.\"\n  },\n  \"database_matrix\": {\n    \"users\": {\n      \"headers\": [\n        \"id\",\n        \"email\",\n        \"password\",\n        \"full_name\",\n        \"profile_image\",\n        \"phone_number\",\n        \"city\",\n        \"is_verified\",\n        \"student_document_url\",\n        \"birth_date\",\n        \"gender\",\n        \"trust_score\",\n        \"wallet_balance\",\n        \"department\",\n        \"bio\",\n        \"favorite_music_url\",\n        \"is_private\",\n        \"ghost_mode\",\n        \"show_way_to_everyone\",\n        \"theme_preference\",\n        \"language_preference\",\n        \"data_saver_mode\",\n        \"notify_event_reminders\",\n        \"notify_campus_announcements\",\n        \"notify_social\",\n        \"current_latitude\",\n        \"current_longitude\",\n        \"last_location_update\",\n        \"tc_no\",\n        \"id_card_front_url\",\n        \"id_card_back_url\",\n        \"blue_tick_status\",\n        \"is_email_verified\",\n        \"is_phone_verified\",\n        \"email_verification_code\",\n        \"phone_verification_code\",\n        \"password_reset_code\",\n        \"student_document_barcode\",\n        \"is_student_verified\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x39\"\n    },\n    \"icebreaker_questions\": {\n      \"headers\": [\n        \"id\",\n        \"category\",\n        \"question_text\",\n        \"is_active\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x4\"\n    },\n    \"badges\": {\n      \"headers\": [\n        \"id\",\n        \"name\",\n        \"icon_url\",\n        \"criteria_type\",\n        \"threshold\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x5\"\n    },\n    \"campus_venues\": {\n      \"headers\": [\n        \"id\",\n        \"name\",\n        \"latitude\",\n        \"longitude\",\n        \"address\",\n        \"discount_rate\",\n        \"category\",\n        \"is_active\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x8\"\n    },\n    \"events\": {\n      \"headers\": [\n        \"id\",\n        \"host_id\",\n        \"title\",\n        \"description\",\n        \"date\",\n        \"location\",\n        \"latitude\",\n        \"longitude\",\n        \"min_age_limit\",\n        \"max_age_limit\",\n        \"target_gender\",\n        \"status\",\n        \"campus_restriction\",\n        \"gender_restriction\",\n        \"deposit_amount\",\n        \"session_token\",\n        \"city\",\n        \"campus\",\n        \"category\",\n        \"image_url\",\n        \"external_url\",\n        \"capacity\",\n        \"price\",\n        \"location_name\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x24\"\n    },\n    \"user_badges\": {\n      \"headers\": [\n        \"user_id\",\n        \"badge_id\",\n        \"earned_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x3\"\n    },\n    \"messages\": {\n      \"headers\": [\n        \"id\",\n        \"sender_id\",\n        \"receiver_id\",\n        \"content\",\n        \"timestamp\",\n        \"is_read\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x6\"\n    },\n    \"login_devices\": {\n      \"headers\": [\n        \"id\",\n        \"user_id\",\n        \"device_name\",\n        \"last_login\",\n        \"ip_address\",\n        \"is_active\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x6\"\n    },\n    \"saved_cards\": {\n      \"headers\": [\n        \"id\",\n        \"user_id\",\n        \"card_holder\",\n        \"last_four\",\n        \"card_type\",\n        \"card_token\",\n        \"card_user_key\",\n        \"expiry_date\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x8\"\n    },\n    \"support_tickets\": {\n      \"headers\": [\n        \"id\",\n        \"user_id\",\n        \"subject\",\n        \"message\",\n        \"status\",\n        \"created_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x6\"\n    },\n    \"transactions\": {\n      \"headers\": [\n        \"id\",\n        \"user_id\",\n        \"amount\",\n        \"payment_id\",\n        \"conversation_id\",\n        \"status\",\n        \"transaction_type\",\n        \"description\",\n        \"created_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x9\"\n    },\n    \"marketplace_items\": {\n      \"headers\": [\n        \"id\",\n        \"owner_id\",\n        \"title\",\n        \"description\",\n        \"price\",\n        \"category\",\n        \"image_url\",\n        \"status\",\n        \"created_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x9\"\n    },\n    \"notifications\": {\n      \"headers\": [\n        \"id\",\n        \"user_id\",\n        \"title\",\n        \"message\",\n        \"type\",\n        \"is_read\",\n        \"created_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x7\"\n    },\n    \"event_participants\": {\n      \"headers\": [\n        \"id\",\n        \"event_id\",\n        \"user_id\",\n        \"status\",\n        \"payment_status\",\n        \"qr_scanned\",\n        \"check_in_time\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x7\"\n    },\n    \"user_reports\": {\n      \"headers\": [\n        \"id\",\n        \"reporter_id\",\n        \"reported_id\",\n        \"event_id\",\n        \"reason\",\n        \"details\",\n        \"created_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x7\"\n    },\n    \"event_live_tracking\": {\n      \"headers\": [\n        \"id\",\n        \"event_id\",\n        \"user_id\",\n        \"latitude\",\n        \"longitude\",\n        \"status\",\n        \"transport_type\",\n        \"last_updated\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x8\"\n    },\n    \"voice_rooms\": {\n      \"headers\": [\n        \"id\",\n        \"event_id\",\n        \"room_token\",\n        \"is_active\",\n        \"expires_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x5\"\n    },\n    \"activity_chat_logs\": {\n      \"headers\": [\n        \"id\",\n        \"event_id\",\n        \"question_id\",\n        \"sent_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x4\"\n    },\n    \"event_likes\": {\n      \"headers\": [\n        \"user_id\",\n        \"event_id\",\n        \"created_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x3\"\n    },\n    \"user_reviews\": {\n      \"headers\": [\n        \"id\",\n        \"reviewer_id\",\n        \"reviewed_id\",\n        \"event_id\",\n        \"rating\",\n        \"comment\",\n        \"created_at\"\n      ],\n      \"rows\": [],\n      \"shape\": \"0x7\"\n    }\n  },\n  \"api_summary\": \"More details in master_snapshot.json\"\n}"
                },
                "backend_snapshot.json": {
                    "type": "reference",
                    "note": "Large file, skipped content"
                },
                "master_backend_snapshot.json": {
                    "type": "reference",
                    "note": "Large file, skipped content"
                },
                "project_paths.json": {
                    "type": "text",
                    "content": "{\n    \"generated_at\": \"2026-01-30T19:41:51.829969\",\n    \"total_items\": 70,\n    \"paths\": [\n        \"README.md\",\n        \"app\",\n        \"artibir.db\",\n        \"crud.py\",\n        \"data\",\n        \"data/backend_snapshot.json\",\n        \"data/tr_bad_words.json\",\n        \"data/tracking.json\",\n        \"database.py\",\n        \"logs\",\n        \"logs/ip_info.txt\",\n        \"logs/verify_output.txt\",\n        \"logs/verify_output_2.txt\",\n        \"main.py\",\n        \"models.py\",\n        \"requirements.txt\",\n        \"routers\",\n        \"routers/activity.py\",\n        \"routers/auth.py\",\n        \"routers/chat.py\",\n        \"routers/events.py\",\n        \"routers/gamification.py\",\n        \"routers/interact.py\",\n        \"routers/live_tracking.py\",\n        \"routers/location.py\",\n        \"routers/marketplace.py\",\n        \"routers/media.py\",\n        \"routers/notifications.py\",\n        \"routers/participants.py\",\n        \"routers/payments.py\",\n        \"routers/reports.py\",\n        \"routers/reviews.py\",\n        \"routers/security_management.py\",\n        \"routers/settings.py\",\n        \"routers/support.py\",\n        \"routers/users.py\",\n        \"routers/venues.py\",\n        \"routers/wallet.py\",\n        \"schemas.py\",\n        \"scripts\",\n        \"scripts/generate_backend_snapshot.py\",\n        \"scripts/generate_project_paths.py\",\n        \"security.py\",\n        \"services\",\n        \"services/encryption.py\",\n        \"services/event_provider.py\",\n        \"services/image_processor.py\",\n        \"services/location_service.py\",\n        \"services/maps_service.py\",\n        \"services/moderation.py\",\n        \"services/notification.py\",\n        \"services/payment_service.py\",\n        \"services/scraper_service.py\",\n        \"tests\",\n        \"tests/check_startup.py\",\n        \"tests/verify_all.py\",\n        \"tests/verify_artibir_vision.py\",\n        \"tests/verify_chat.py\",\n        \"tests/verify_events.py\",\n        \"tests/verify_location.py\",\n        \"tests/verify_media.py\",\n        \"tests/verify_moderation.py\",\n        \"tests/verify_new_models.py\",\n        \"tests/verify_phase2.py\",\n        \"uploads\",\n        \"uploads/images\",\n        \"utils\",\n        \"utils/edevlet_verifier.py\",\n        \"utils/nvi_verifier.py\",\n        \"utils/tracking.py\"\n    ]\n}"
                },
                "tracking.json": {
                    "type": "text",
                    "content": "[\n    {\n        \"timestamp\": \"2026-01-30T19:34:23.739356\",\n        \"event_type\": \"TEST_EVENT\",\n        \"user_id\": \"anonymous\",\n        \"details\": {\n            \"status\": \"success\"\n        }\n    },\n    {\n        \"timestamp\": \"2026-01-30T19:59:46.086900\",\n        \"event_type\": \"API_REQUEST\",\n        \"user_id\": \"anonymous\",\n        \"details\": {\n            \"method\": \"GET\",\n            \"path\": \"/favicon.ico\",\n            \"status_code\": 404,\n            \"client_ip\": \"127.0.0.1\",\n            \"payload\": null\n        }\n    },\n    {\n        \"timestamp\": \"2026-01-30T19:59:46.091985\",\n        \"event_type\": \"API_REQUEST\",\n        \"user_id\": \"anonymous\",\n        \"details\": {\n            \"method\": \"GET\",\n            \"path\": \"/favicon.ico\",\n            \"status_code\": 404,\n            \"client_ip\": \"127.0.0.1\",\n            \"payload\": null\n        }\n    },\n    {\n        \"timestamp\": \"2026-01-31T14:16:53.641363\",\n        \"event_type\": \"API_REQUEST\",\n        \"user_id\": \"anonymous\",\n        \"details\": {\n            \"method\": \"GET\",\n            \"path\": \"/favicon.ico\",\n            \"status_code\": 404,\n            \"client_ip\": \"127.0.0.1\",\n            \"payload\": null\n        }\n    }\n]"
                },
                "tr_bad_words.json": {
                    "type": "text",
                    "content": "[\n    \"aptal\",\n    \"gerizekalÄ±\",\n    \"salak\",\n    \"kÃ¼fÃ¼r1\",\n    \"kÃ¼fÃ¼r2\",\n    \"taciz1\",\n    \"ÅŸiddet1\",\n    \"+18kelime\",\n    \"ÅŸerefsiz\",\n    \"ahmak\",\n    \"mal\",\n    \"dangalak\"\n]\n"
                }
            }
        },
        "logs": {
            "directories": [],
            "files": {
                "ip_info.txt": {
                    "type": "binary",
                    "content": "DQpXaW5kb3dzIElQIENvbmZpZ3VyYXRpb24NCg0KDQpFdGhlcm5ldCBhZGFwdGVyIHN1cGVyYm94Og0KDQogICBNZWRpYSBTdGF0ZSAuIC4gLiAuIC4gLiAuIC4gLiAuIC4gOiBNZWRpYSBkaXNjb25uZWN0ZWQNCiAgIENvbm5lY3Rpb24tc3BlY2lmaWMgRE5TIFN1ZmZpeCAgLiA6IA0KDQpXaXJlbGVzcyBMQU4gYWRhcHRlciBZZXJlbCBBpyBCYadsYW50jXONKiA5Og0KDQogICBNZWRpYSBTdGF0ZSAuIC4gLiAuIC4gLiAuIC4gLiAuIC4gOiBNZWRpYSBkaXNjb25uZWN0ZWQNCiAgIENvbm5lY3Rpb24tc3BlY2lmaWMgRE5TIFN1ZmZpeCAgLiA6IA0KDQpXaXJlbGVzcyBMQU4gYWRhcHRlciBZZXJlbCBBpyBCYadsYW50jXONKiAxMDoNCg0KICAgTWVkaWEgU3RhdGUgLiAuIC4gLiAuIC4gLiAuIC4gLiAuIDogTWVkaWEgZGlzY29ubmVjdGVkDQogICBDb25uZWN0aW9uLXNwZWNpZmljIEROUyBTdWZmaXggIC4gOiANCg0KV2lyZWxlc3MgTEFOIGFkYXB0ZXIgV2ktRmk6DQoNCiAgIENvbm5lY3Rpb24tc3BlY2lmaWMgRE5TIFN1ZmZpeCAgLiA6IA0KICAgSVB2NiBBZGRyZXNzLiAuIC4gLiAuIC4gLiAuIC4gLiAuIDogMmEwMjo0ZTA6MmQ5ODo4ZWYzOmNmNGQ6YjAxZDpkMDoxOWE1DQogICBUZW1wb3JhcnkgSVB2NiBBZGRyZXNzLiAuIC4gLiAuIC4gOiAyYTAyOjRlMDoyZDk4OjhlZjM6MjEyZDo5YzlhOjg4ZGI6Y2JhMg0KICAgTGluay1sb2NhbCBJUHY2IEFkZHJlc3MgLiAuIC4gLiAuIDogZmU4MDo6ZTQ4MDo1YmRjOjc0MWY6OGM4MCUxMw0KICAgSVB2NCBBZGRyZXNzLiAuIC4gLiAuIC4gLiAuIC4gLiAuIDogMTkyLjE2OC4xLjcNCiAgIFN1Ym5ldCBNYXNrIC4gLiAuIC4gLiAuIC4gLiAuIC4gLiA6IDI1NS4yNTUuMjU1LjANCiAgIERlZmF1bHQgR2F0ZXdheSAuIC4gLiAuIC4gLiAuIC4gLiA6IGZlODA6OjVlN2Q6YWVmZjpmZTY4OjNhMzklMTMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE5Mi4xNjguMS4xDQoNCkV0aGVybmV0IGFkYXB0ZXIgQmx1ZXRvb3RoIEGnIEJhp2xhbnSNc406DQoNCiAgIE1lZGlhIFN0YXRlIC4gLiAuIC4gLiAuIC4gLiAuIC4gLiA6IE1lZGlhIGRpc2Nvbm5lY3RlZA0KICAgQ29ubmVjdGlvbi1zcGVjaWZpYyBETlMgU3VmZml4ICAuIDogDQo="
                },
                "verify_output.txt": {
                    "type": "binary",
                    "content": "DQotLS0gVGVzdGluZyBBdXRvIEZldGNoIC0tLQ0KRmFpbGVkOiA1MDANCkRldGFpbHM6IHsibWVzc2FnZSI6IlN1bnVjdSBoYXRhc/0gb2x1/nR1IiwiZGV0YWlsIjoiKHNxbGl0ZTMuT3BlcmF0aW9uYWxFcnJvcikgdGFibGUgZXZlbnRzIGhhcyBubyBjb2x1bW4gbmFtZWQgY2F0ZWdvcnlcbltTUUw6IElOU0VSVCBJTlRPIGV2ZW50cyAodGl0bGUsIGRlc2NyaXB0aW9uLCBkYXRlLCBsb2NhdGlvbiwgY2l0eSwgY2FtcHVzLCBjYXRlZ29yeSwgaW1hZ2VfdXJsLCBleHRlcm5hbF91cmwpIFZBTFVFUyAoPywgPywgPywgPywgPywgPywgPywgPywgPyldXG5bcGFyYW1ldGVyczogKCdHZW7nbGlrIEZlc3RpdmFsaSAtIN1zdGFuYnVsJywgJ0J1IGhhcmlrYSBmZXN0aXZhbCBldGtpbmxp8GluaSBrYef9cm1hef1uISBIYXJiaXllIEHn/WsgSGF2YSBtZWthbv1uZGEgc2l6bGVybGUuJywgJzIwMjYtMDItMDUgMTE6MDg6NTMuNTA5ODk4JywgJ0hhcmJpeWUgQef9ayBIYXZhJywgJ91zdGFuYnVsJywgTm9uZSwgJ0Zlc3RpdmFsJywgJ2h0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTMzMTc0MDcyNTQ1LWU4ZDRhYTk3ZWRmOT9xPTgwJnc9MTAwMCZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCcsICdodHRwczovL2JpbGV0aXguY29tL21vY2stbGluaycpXVxuKEJhY2tncm91bmQgb24gdGhpcyBlcnJvciBhdDogaHR0cHM6Ly9zcWxhbGNoZS5tZS9lLzIwL2UzcTgpIn0NCg0KLS0tIFRlc3RpbmcgR2V0IEFsbCBFdmVudHMgLS0tDQpGYWlsZWQ6IDUwMA0KDQotLS0gVGVzdGluZyBGaWx0ZXIgYnkgRnV0Ym9sIC0tLQ0KRmFpbGVkOiA1MDANCg=="
                },
                "verify_output_2.txt": {
                    "type": "binary",
                    "content": "DQotLS0gVGVzdGluZyBBdXRvIEZldGNoIC0tLQ0KU3VjY2VzcyEgNSBldmVudHMgY3JlYXRlZC4NCi0gW1N0YW5kLXVwXSBB5/1rIE1pa3JvZm9uIC0g3XN0YW5idWwgKN1zdGFuYnVsKQ0KLSBbRnV0Ym9sXSBNaWxsaSBNYecgLSBFc2tp/mVoaXIgKEVza2n+ZWhpcikNCi0gW0Zlc3RpdmFsXSBHZW7nbGlrIEZlc3RpdmFsaSAtIN16bWlyICjdem1pcikNCi0gW0Zlc3RpdmFsXSBHZW7nbGlrIEZlc3RpdmFsaSAtIN1zdGFuYnVsICjdc3RhbmJ1bCkNCi0gW1RpeWF0cm9dIEJpciBEZWxpbmluIEhhdP1yYSBEZWZ0ZXJpIC0g3XptaXIgKN16bWlyKQ0KDQotLS0gVGVzdGluZyBHZXQgQWxsIEV2ZW50cyAtLS0NClRvdGFsIGV2ZW50cyBpbiBEQjogNQ0KDQotLS0gVGVzdGluZyBGaWx0ZXIgYnkgRnV0Ym9sIC0tLQ0KRm91bmQgMSBldmVudHMgZm9yIEZ1dGJvbDoNCi0gTWlsbGkgTWHnIC0gRXNraf5laGlyDQo="
                }
            }
        },
        "routers": {
            "directories": [],
            "files": {
                "activity.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, models, schemas, security\nfrom uuid import UUID\n\nrouter = APIRouter(\n    prefix=\"/activity\",\n    tags=[\"User Activity & History\"]\n)\n\n@router.get(\"/history\", response_model=List[schemas.EventOut])\ndef get_event_history(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n geÃ§miÅŸte katÄ±ldÄ±ÄŸÄ± (veya katÄ±lmadÄ±ÄŸÄ±) tÃ¼m etkinlikleri getirir.\"\"\"\n    participated_ids = db.query(models.EventParticipant.event_id).filter(\n        models.EventParticipant.user_id == current_user.id\n    ).all()\n    event_ids = [eid[0] for eid in participated_ids]\n    \n    return db.query(models.Event).filter(models.Event.id.in_(event_ids)).all()\n\n@router.post(\"/like/{event_id}\")\ndef like_event(\n    event_id: UUID,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Bir etkinliÄŸi beÄŸenir veya beÄŸeniyi geri Ã§eker.\"\"\"\n    existing_like = db.query(models.EventLike).filter(\n        models.EventLike.user_id == current_user.id,\n        models.EventLike.event_id == event_id\n    ).first()\n    \n    if existing_like:\n        db.delete(existing_like)\n        db.commit()\n        return {\"liked\": False}\n    \n    new_like = models.EventLike(user_id=current_user.id, event_id=event_id)\n    db.add(new_like)\n    db.commit()\n    return {\"liked\": True}\n\n@router.get(\"/liked-events\", response_model=List[schemas.EventOut])\ndef get_liked_events(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n beÄŸendiÄŸi tÃ¼m etkinlikleri listeler.\"\"\"\n    liked_ids = db.query(models.EventLike.event_id).filter(\n        models.EventLike.user_id == current_user.id\n    ).all()\n    event_ids = [eid[0] for eid in liked_ids]\n    \n    return db.query(models.Event).filter(models.Event.id.in_(event_ids)).all()\n"
                },
                "admin_api.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException\nfrom sqlalchemy.orm import Session\nfrom uuid import UUID\nimport database, models, schemas, security\nfrom typing import List\nfrom sqlalchemy import func\n\nrouter = APIRouter(prefix=\"/admin-api\", tags=[\"Admin Actions\"])\n\ndef check_admin(current_user: models.User = Depends(security.get_current_user)):\n    # Åimdilik basitÃ§e ilk kullanÄ±cÄ±yÄ± veya trust_score'u 1000 olanÄ± admin sayabiliriz\n    # GerÃ§ek projede user.role == 'admin' kontrolÃ¼ yapÄ±lÄ±r\n    if current_user.trust_score < 100:\n        raise HTTPException(status_code=403, detail=\"Bu iÅŸlem iÃ§in admin yetkisi gerekiyor.\")\n    return current_user\n\n@router.post(\"/verify-user/{user_id}\")\ndef verify_user(\n    user_id: UUID, \n    db: Session = Depends(database.get_db),\n    admin: models.User = Depends(check_admin)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n Ã¶ÄŸrenci belgesini manuel olarak onaylar.\"\"\"\n    user = db.query(models.User).filter(models.User.id == user_id).first()\n    if not user:\n        raise HTTPException(status_code=404, detail=\"KullanÄ±cÄ± bulunamadÄ±.\")\n    \n    user.is_verified = True\n    user.is_student_verified = True\n    user.blue_tick_status = \"approved\"\n    user.trust_score += 20\n    db.commit()\n    return {\"message\": f\"{user.full_name} baÅŸarÄ±yla onaylandÄ±.\", \"status\": \"verified\"}\n\n@router.post(\"/ban-user/{user_id}\")\ndef ban_user(\n    user_id: UUID, \n    reason: str,\n    db: Session = Depends(database.get_db),\n    admin: models.User = Depends(check_admin)\n):\n    \"\"\"KullanÄ±cÄ±yÄ± sistemden kÄ±sÄ±tlar (Trust score dÃ¼ÅŸÃ¼rÃ¼lÃ¼r).\"\"\"\n    user = db.query(models.User).filter(models.User.id == user_id).first()\n    if not user:\n        raise HTTPException(status_code=404, detail=\"KullanÄ±cÄ± bulunamadÄ±.\")\n    \n    user.trust_score = 0\n    # Ä°leride is_active = False eklenebilir\n    db.commit()\n    return {\"message\": f\"{user.full_name} kÄ±sÄ±tlandÄ±. Neden: {reason}\", \"status\": \"banned\"}\n\n@router.get(\"/system-stats\")\ndef get_system_stats(\n    db: Session = Depends(database.get_db),\n    admin: models.User = Depends(check_admin)\n):\n    \"\"\"Sistemin canlÄ± istatistiklerini dÃ¶ner.\"\"\"\n    user_count = db.query(func.count(models.User.id)).scalar()\n    event_count = db.query(func.count(models.Event.id)).scalar()\n    club_count = db.query(func.count(models.Club.id)).scalar()\n    \n    return {\n        \"counters\": {\n            \"users\": user_count,\n            \"events\": event_count,\n            \"clubs\": club_count\n        },\n        \"health\": \"excellent\"\n    }\n"
                },
                "auth.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException, status, Request\nfrom sqlalchemy.orm import Session\nimport datetime\n# Ãœst klasÃ¶rden modÃ¼lleri Ã§aÄŸÄ±rÄ±yoruz\nimport sys\nimport os\n\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nimport database, schemas, crud, security\nfrom slowapi import Limiter\nfrom slowapi.util import get_remote_address\n\nrouter = APIRouter(tags=[\"Authentication\"])\nget_db = database.get_db\nlimiter = Limiter(key_func=get_remote_address)\n\n@router.post(\"/login\")\n@limiter.limit(\"5/minute\") # Dakikada maksimum 5 giriÅŸ denemesi\ndef login(request: Request, user_data: schemas.UserLogin, db: Session = Depends(get_db)):\n    \"\"\"\n    KullanÄ±cÄ± GiriÅŸi (Login)\n    \"\"\"\n    # KullanÄ±cÄ±yÄ± bul\n    user = crud.get_user_by_email(db, email=user_data.email)\n    \n    # KullanÄ±cÄ± yoksa veya ÅŸifre yanlÄ±ÅŸsa hata ver\n    if not user or not security.verify_password(user_data.password, user.password):\n        raise HTTPException(status_code=400, detail=\"HatalÄ± e-posta veya ÅŸifre!\")\n    \n    # JWT Token oluÅŸtur\n    access_token_expires = datetime.timedelta(minutes=security.ACCESS_TOKEN_EXPIRE_MINUTES)\n    access_token = security.create_access_token(\n        data={\"sub\": user.email}, expires_delta=access_token_expires\n    )\n    \n    # Her ÅŸey doÄŸruysa giriÅŸ onayÄ± ve token ver\n    return {\n        \"status\": \"success\",\n        \"access_token\": access_token,\n        \"token_type\": \"bearer\",\n        \"user_id\": str(user.id), # UUID safe conversion\n        \"full_name\": user.full_name,\n        \"email\": user.email,\n        \"profile_image\": user.profile_image,\n        \"phone_number\": user.phone_number\n    }\n\n# --- UNUTULAN ÅÄ°FRE Ä°ÅLEMLERÄ° ---\nfrom pydantic import EmailStr, BaseModel\nfrom services import notification\nimport random\n\nclass ForgotPasswordRequest(BaseModel):\n    email: EmailStr\n\nclass ResetPasswordRequest(BaseModel):\n    email: EmailStr\n    code: str\n    new_password: str\n\n@router.post(\"/forgot-password\")\ndef forgot_password(request: ForgotPasswordRequest, db: Session = Depends(get_db)):\n    \"\"\"Åifre sÄ±fÄ±rlama kodu gÃ¶nderir.\"\"\"\n    user = crud.get_user_by_email(db, email=request.email)\n    if not user:\n        # GÃ¼venlik nedeniyle \"BÃ¶yle bir e-posta yok\" yerine \"Kod gÃ¶nderildi\" demek daha iyidir ama \n        # geliÅŸtirme iÃ§in 404 mantÄ±klÄ± olabilir.\n        raise HTTPException(status_code=404, detail=\"Bu e-posta ile kayÄ±tlÄ± bir kullanÄ±cÄ± bulunamadÄ±.\")\n    \n    otp = str(random.randint(100000, 999999))\n    user.password_reset_code = otp\n    db.commit()\n    \n    # E-posta GÃ¶nder\n    subject = \"ArtÄ±Bir Åifre SÄ±fÄ±rlama Talebi ğŸ”‘\"\n    body = f\"Åifrenizi sÄ±fÄ±rlamak iÃ§in kodunuz: {otp}\"\n    html_body = f\"\"\"\n    <div style='font-family:sans-serif; border:1px solid #ddd; padding:20px; border-radius:8px;'>\n        <h3 style='color:#E67E22;'>Åifre SÄ±fÄ±rlama Ä°steÄŸi</h3>\n        <p>HesabÄ±nÄ±z iÃ§in ÅŸifre sÄ±fÄ±rlama talebinde bulundunuz. Kodunuz:</p>\n        <div style='background:#eee; padding:10px; font-size:24px; text-align:center;'><b>{otp}</b></div>\n        <p style='font-size:12px; color:#777;'>EÄŸer bu iÅŸlemi siz yapmadÄ±ysanÄ±z ÅŸifrenizi deÄŸiÅŸtirmenizi Ã¶neririz.</p>\n    </div>\n    \"\"\"\n    notification.send_email(user.email, subject, body, html_body=html_body)\n    \n    return {\"status\": \"success\", \"message\": \"Åifre sÄ±fÄ±rlama kodu gÃ¶nderildi.\"}\n\n@router.post(\"/reset-password\")\ndef reset_password(request: ResetPasswordRequest, db: Session = Depends(get_db)):\n    \"\"\"Yeni ÅŸifreyi kaydeder.\"\"\"\n    user = crud.get_user_by_email(db, email=request.email)\n    if not user or user.password_reset_code != request.code:\n        raise HTTPException(status_code=400, detail=\"GeÃ§ersiz e-posta veya kod!\")\n    \n    # Åifreyi gÃ¼ncelle ve kodu sil\n    user.password = security.get_password_hash(request.new_password)\n    user.password_reset_code = None\n    db.commit()\n    \n    return {\"status\": \"success\", \"message\": \"Åifreniz baÅŸarÄ±yla gÃ¼ncellendi. GiriÅŸ yapabilirsiniz.\"}\n"
                },
                "chat.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, WebSocket, WebSocketDisconnect, HTTPException\nfrom fastapi.concurrency import run_in_threadpool\nfrom sqlalchemy.orm import Session\nfrom typing import List, Dict\nimport json\nimport sys\nimport os\nfrom uuid import UUID\n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nimport database, schemas, crud, models, security\nfrom services import moderation, encryption\n\nrouter = APIRouter(tags=[\"Chat\"])\nget_db = database.get_db\n\n# BaÄŸlantÄ± YÃ¶neticisi\nclass ConnectionManager:\n    def __init__(self):\n        # user_id -> WebSocket baÄŸlantÄ±sÄ± eÅŸleÅŸmesi\n        self.active_connections: Dict[UUID, WebSocket] = {}\n\n    async def connect(self, websocket: WebSocket, user_id: UUID):\n        await websocket.accept()\n        self.active_connections[user_id] = websocket\n\n    def disconnect(self, user_id: UUID):\n        if user_id in self.active_connections:\n            del self.active_connections[user_id]\n\n    async def send_personal_message(self, message: str, user_id: UUID):\n        if user_id in self.active_connections:\n            await self.active_connections[user_id].send_text(message)\n\nmanager = ConnectionManager()\n\n# --- 3. MESAJ GÃ–NDER (POST /chat/send) ---\n# WebSocket yerine HTTP Ã¼zerinden mesaj atma (GÃ¼venlik Botu Dahil)\n@router.post(\"/chat/send\", response_model=schemas.MessageOut)\nasync def send_message(\n    message: schemas.MessageCreate,\n    current_user: models.User = Depends(security.get_current_user),\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    HTTP Ã¼zerinden gÃ¼venli mesaj gÃ¶nderme.\n    \"Yapay Zeka KorumasÄ±\" (Security Guard) buradan sorumlu.\n    \"\"\"\n    # 1. GÃœVENLÄ°K BOTU KONTROLÃœ\n    # NLP iÅŸlemi CPU bound olduÄŸu iÃ§in threadpool'da Ã§alÄ±ÅŸtÄ±rÄ±yoruz\n    is_safe, reason = await run_in_threadpool(moderation.check_message, message.content, current_user.trust_score)\n\n    if not is_safe:\n        # Mesaj gÃ¼venli deÄŸilse 400 HatasÄ± fÄ±rlat\n        raise HTTPException(status_code=400, detail=f\"Mesaj engellendi: {reason}\")\n    \n    # 2. VeritabanÄ±na Kaydet\n    saved_message = crud.create_message(db, message, sender_id=current_user.id)\n    \n    # 3. EÄŸer alÄ±cÄ± online ise WebSocket ile ilet (Opsiyonel ama ÅŸÄ±k olur)\n    # Mesaj objesini hazÄ±rla\n    response_data = {\n        \"id\": saved_message.id,\n        \"sender_id\": str(current_user.id),\n        \"content\": message.content,\n        \"timestamp\": str(saved_message.timestamp)\n    }\n    await manager.send_personal_message(json.dumps(response_data), message.receiver_id)\n    \n    return saved_message\n\n\n# --- 1. WebSocket ile GerÃ§ek ZamanlÄ± MesajlaÅŸma ---\n@router.websocket(\"/ws/chat/{token}\")\nasync def websocket_endpoint(websocket: WebSocket, token: str, db: Session = Depends(get_db)):\n    \"\"\"\n    WebSocket Ã¼zerinden anlÄ±k mesajlaÅŸma.\n    Token URL parametresi olarak alÄ±nÄ±r Ã§Ã¼nkÃ¼ WebSocket header desteklemez.\n    \"\"\"\n    # 1. Kimlik DoÄŸrulama\n    try:\n        payload = security.decode_access_token(token)\n        email = payload.get(\"sub\")\n        if email is None:\n            await websocket.close(code=1008)\n            return\n        user = crud.get_user_by_email(db, email=email)\n        if user is None:\n            await websocket.close(code=1008)\n            return\n        current_user_id = user.id\n    except Exception:\n        await websocket.close(code=1008)\n        return\n\n    # 2. BaÄŸlantÄ±yÄ± Kabul Et\n    await manager.connect(websocket, current_user_id)\n    \n    try:\n        while True:\n            # Ä°stemciden mesaj bekle\n            data = await websocket.receive_text()\n            \n            try:\n                message_data = json.loads(data)\n                # UUID conversion\n                receiver_id_str = message_data.get(\"receiver_id\")\n                if not receiver_id_str:\n                    continue\n                receiver_id = UUID(receiver_id_str)\n                \n                raw_content = message_data.get(\"content\")\n                \n                if not raw_content or not raw_content.strip():\n                    continue\n\n                # --- GÃœVENLÄ°K BOTU KONTROLÃœ ---\n                # KullanÄ±cÄ± gÃ¼ven puanÄ±nÄ± al (Ä°lerde DB'den Ã§ekilecek, ÅŸimdilik varsayÄ±lan 50 veya user objesinden)\n                # user objesi connection sÄ±rasÄ±nda alÄ±ndÄ± ama scope iÃ§inde deÄŸil, tekrar Ã§ekmek veya baÅŸta saklamak lazÄ±m.\n                # Basitlik iÃ§in user.trust_score'u connection sÄ±rasÄ±nda saklayabiliriz ama \n                # ÅŸimdilik tekrar sorgulamak yerine varsayÄ±lan bir deÄŸer veya connection manager'a eklemek daha iyi.\n                # Ancak burada DB session var, hÄ±zlÄ±ca user'Ä± tekrar Ã§ekebiliriz veya global user map tutabiliriz.\n                # En temiz yÃ¶ntem: WebSocket endpoint baÅŸÄ±nda user'Ä± aldÄ±k, trust_score'u oradan alalÄ±m.\n                # user deÄŸiÅŸkeni scope iÃ§inde duruyor.\n                \n                user_trust_score = user.trust_score\n                \n                # WebSocket iÃ§inde de bloklamamasÄ± iÃ§in threadpool kullanÄ±mÄ±\n                is_safe, reason = await run_in_threadpool(moderation.check_message, raw_content, user_trust_score)\n                \n                if not is_safe:\n                    # Hata mesajÄ±nÄ± gÃ¶nder ve iÅŸlemi durdur\n                    error_payload = {\"type\": \"error\", \"message\": reason}\n                    await manager.send_personal_message(json.dumps(error_payload), current_user_id)\n                    continue\n\n                # Mesaj gÃ¼venli ise devam et (SansÃ¼rleme opsiyonel, check_message zaten blocked dÃ¶ndÃ¼)\n                # Ä°stenirse clean_content = moderation.filter_message(raw_content) yapÄ±labilir.\n                clean_content = raw_content \n                \n                # 3. VeritabanÄ±na Kaydet (Otomatik Åifrelenir)\n                msg_schema = schemas.MessageCreate(receiver_id=receiver_id, content=clean_content)\n                saved_message = crud.create_message(db, msg_schema, sender_id=current_user_id)\n                \n                # YanÄ±t objesi hazÄ±rla\n                response_data = {\n                    \"id\": saved_message.id,\n                    \"sender_id\": str(current_user_id),\n                    \"content\": clean_content,\n                    \"timestamp\": str(saved_message.timestamp)\n                }\n                \n                # 4. AlÄ±cÄ±ya GÃ¶nder\n                await manager.send_personal_message(json.dumps(response_data), receiver_id)\n                \n                # GÃ¶nderene de onayÄ± gÃ¶nder\n                await manager.send_personal_message(json.dumps(response_data), current_user_id)\n                \n            except Exception as e:\n                # UUID error or other\n                error_msg = {\"error\": str(e)}\n                await manager.send_personal_message(json.dumps(error_msg), current_user_id)\n                \n    except WebSocketDisconnect:\n        manager.disconnect(current_user_id)\n\n\n# --- 2. Mesaj GeÃ§miÅŸini Getir ---\n@router.get(\"/chat/history/{other_user_id}\", response_model=List[schemas.MessageOut])\ndef get_history(other_user_id: UUID, current_user: models.User = Depends(security.get_current_user), db: Session = Depends(get_db)):\n    \"\"\"\n    Belirli bir kiÅŸiyle olan tÃ¼m mesaj geÃ§miÅŸini getirir.\n    Mesajlar veritabanÄ±nda ÅŸifreli saklanÄ±r ancak bu endpointte Ã§Ã¶zÃ¼lerek (decrypted) gÃ¶nderilir.\n    \"\"\"\n    return crud.get_chat_history(db, current_user.id, other_user_id)\n"
                },
                "clubs.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nfrom uuid import UUID\nimport database, models, schemas, security\n\nrouter = APIRouter(prefix=\"/clubs\", tags=[\"Clubs & Societies\"])\n\n@router.post(\"/\", response_model=schemas.ClubOut)\ndef create_club(\n    club: schemas.ClubCreate,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Sadece sistem yÃ¶neticileri (veya authorized kullanÄ±cÄ±lar) kulÃ¼p kurabilir.\"\"\"\n    # Basit bir yetki kontrolÃ¼ mekanizmasÄ± eklenebilir.\n    db_club = models.Club(**club.model_dump())\n    db.add(db_club)\n    db.commit()\n    db.refresh(db_club)\n    \n    # Kurucuyu admin olarak ekle\n    member = models.ClubMember(club_id=db_club.id, user_id=current_user.id, role=\"admin\")\n    db.add(member)\n    db.commit()\n    \n    return db_club\n\n@router.get(\"/\", response_model=List[schemas.ClubOut])\ndef list_clubs(db: Session = Depends(database.get_db)):\n    return db.query(models.Club).all()\n\n@router.post(\"/{club_id}/join\")\ndef join_club(\n    club_id: int,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    exists = db.query(models.ClubMember).filter(\n        models.ClubMember.club_id == club_id,\n        models.ClubMember.user_id == current_user.id\n    ).first()\n    \n    if exists:\n        raise HTTPException(status_code=400, detail=\"Zaten bu kulÃ¼bÃ¼n Ã¼yesisiniz.\")\n        \n    member = models.ClubMember(club_id=club_id, user_id=current_user.id, role=\"member\")\n    db.add(member)\n    db.commit()\n    return {\"status\": \"success\", \"message\": \"KulÃ¼be baÅŸarÄ±yla katÄ±ldÄ±nÄ±z.\"}\n\n@router.get(\"/{club_id}/members\", response_model=List[schemas.ClubMemberOut])\ndef get_club_members(club_id: int, db: Session = Depends(database.get_db)):\n    return db.query(models.ClubMember).filter(models.ClubMember.club_id == club_id).all()\n"
                },
                "events.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport sys\nimport os\nfrom uuid import UUID\n\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nimport database, schemas, crud, models, security\nfrom services import event_provider\n\nrouter = APIRouter(tags=[\"Events\"])\nget_db = database.get_db\n\n# --- 3. ETKÄ°NLÄ°KLERÄ° GETÄ°R (GET /events) ---\n@router.get(\"/events\", response_model=List[schemas.EventOut])\ndef read_events(\n    city: str = None, \n    category: str = None, \n    lat: float = None, \n    lon: float = None, \n    radius: float = 10.0,\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Etkinlikleri Listele (Konum Filtresi Destekli)\n    \"\"\"\n    if lat is not None and lon is not None:\n        return crud.get_nearby_events(db, lat=lat, lon=lon, radius_km=radius)\n    \n    return crud.get_events(db, city=city, category=category)\n\n# --- 4. OTOMATÄ°K VERÄ° Ã‡EK (POST /events/auto-fetch) ---\n@router.post(\"/events/auto-fetch\", response_model=List[schemas.EventOut])\ndef auto_fetch_events(count: int = 5, db: Session = Depends(get_db)):\n    \"\"\"\n    Otomatik Etkinlik Ã‡ek (SimÃ¼lasyon - Rastgele)\n    \"\"\"\n    # 1. Servisten mock datalarÄ± al\n    new_event_schemas = event_provider.generate_mock_events(count=count)\n    \n    # Host bul (Sistemden rastgele bir kullanÄ±cÄ±)\n    # GerÃ§ek senaryoda bu iÅŸlem admin token ile yapÄ±lmalÄ±\n    host_user = db.query(models.User).first()\n    if not host_user:\n        # KullanÄ±cÄ± yoksa oluÅŸturamayÄ±z (Mock user create eklenebilir ama ÅŸimdilik hata verelim)\n        raise HTTPException(status_code=400, detail=\"Sistemde hiÃ§ kullanÄ±cÄ± yok, etkinlik oluÅŸturulamaz.\")\n\n    created_events = []\n    # 2. Hepsini veritabanÄ±na kaydet\n    for event_schema in new_event_schemas:\n        # host_id atamasÄ±\n        db_event = crud.create_event(db, event_schema, host_id=host_user.id)\n        created_events.append(db_event)\n        \n    return created_events\n\nfrom services.scraper_service import ScraperService\n\n# --- 5. INTERNETTEN ETKÄ°NLÄ°K BOTU Ã‡ALIÅTIR (GET /events/fetch-external) ---\n@router.get(\"/events/fetch-external\", response_model=List[schemas.EventOut])\ndef fetch_external_events(location: str = \"Ä°stanbul\", db: Session = Depends(get_db)):\n    \"\"\"\n    Belirtilen konuma gÃ¶re internetten etkinlikleri tarar ve veritabanÄ±na kaydeder.\n    URL Parametresi: ?location=Antalya\n    \"\"\"\n    # 1. Scraper Servisini Ã‡aÄŸÄ±r\n    found_event_schemas = ScraperService.scrape_events_by_location(location)\n    \n    # 2. Kaydetmek iÃ§in 'Host' KullanÄ±cÄ±sÄ± Belirle\n    host_user = db.query(models.User).first() # Ä°lk kullanÄ±cÄ±ya ata\n    if not host_user:\n        raise HTTPException(status_code=400, detail=\"Etkinlikleri atayacak kullanÄ±cÄ± bulunamadÄ±.\")\n        \n    created_events = []\n    for event_schema in found_event_schemas:\n        # DB'ye kaydet\n        db_event = crud.create_event(db, event_schema, host_id=host_user.id)\n        created_events.append(db_event)\n        \n    return created_events\n\n# --- 1. ETKÄ°NLÄ°K OLUÅTUR (POST /events) ---\n@router.post(\"/events\", response_model=schemas.EventOut)\ndef create_event(\n    event: schemas.EventCreate, \n    current_user: models.User = Depends(security.get_current_user), \n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Yeni Etkinlik OluÅŸtur\n    \"\"\"\n    return crud.create_event(db=db, event=event, host_id=current_user.id)\n\n\n"
                },
                "feed.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, models, schemas, security\nfrom services.ai_engine import AIEngine\nfrom datetime import datetime, timedelta\n\nrouter = APIRouter(prefix=\"/feed\", tags=[\"Home Feed\"])\n\n@router.get(\"/home\")\ndef get_home_feed(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    KullanÄ±cÄ± iÃ§in Ã¶zelleÅŸtirilmiÅŸ ana sayfa akÄ±ÅŸÄ±nÄ± dÃ¶ner.\n    \"\"\"\n    # 1. AI Ã–nerileri (Etkinlikler)\n    recommendations = AIEngine.recommend_events(db, current_user.id, limit=5)\n    \n    # 2. Sosyal Momentler (ArkadaÅŸlarÄ±n son 24 saatteki paylaÅŸÄ±mlarÄ±)\n    # ArkadaÅŸ listesini bul\n    friends_ids = [f.friend_id for f in current_user.friendships if f.status == \"accepted\"]\n    friends_ids += [f.user_id for f in db.query(models.Friendship).filter(models.Friendship.friend_id == current_user.id, models.Friendship.status == \"accepted\").all()]\n    \n    moments = db.query(models.EventMoment).filter(\n        models.EventMoment.user_id.in_(friends_ids),\n        models.EventMoment.expires_at > datetime.utcnow()\n    ).order_by(models.EventMoment.created_at.desc()).limit(20).all()\n    \n    # 3. YaklaÅŸan KulÃ¼p Etkinlikleri (Ãœye olduÄŸu kulÃ¼plerden)\n    club_ids = [m.club_id for m in current_user.clubs]\n    club_events = db.query(models.Event).filter(\n        models.Event.club_id.in_(club_ids),\n        models.Event.date >= datetime.utcnow()\n    ).order_by(models.Event.date.asc()).limit(5).all()\n    \n    return {\n        \"user\": {\n            \"name\": current_user.full_name,\n            \"trust_score\": current_user.trust_score\n        },\n        \"sections\": [\n            {\n                \"type\": \"moments\",\n                \"title\": \"ArkadaÅŸlarÄ±nÄ±n Hikayeleri\",\n                \"data\": moments\n            },\n            {\n                \"type\": \"recommendations\",\n                \"title\": \"Senin Ä°Ã§in Ã–nerilenler\",\n                \"data\": recommendations\n            },\n            {\n                \"type\": \"club_events\",\n                \"title\": \"KulÃ¼plerinden Haberler\",\n                \"data\": club_events\n            }\n        ]\n    }\n"
                },
                "gamification.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, models, schemas, security\nfrom uuid import UUID\nfrom datetime import datetime\n\nrouter = APIRouter(\n    prefix=\"/gamification\",\n    tags=[\"Gamification & Badges\"]\n)\n\n@router.get(\"/badges\", response_model=List[dict])\ndef get_all_badges(db: Session = Depends(database.get_db)):\n    \"\"\"Sistemdeki tÃ¼m rozetleri listeler.\"\"\"\n    badges = db.query(models.Badge).all()\n    return badges\n\n@router.get(\"/my-badges\", response_model=List[dict])\ndef get_user_badges(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n kazandÄ±ÄŸÄ± rozetleri listeler.\"\"\"\n    user_badges = db.query(models.UserBadge).filter(models.UserBadge.user_id == current_user.id).all()\n    badge_ids = [ub.badge_id for ub in user_badges]\n    badges = db.query(models.Badge).filter(models.Badge.id.in_(badge_ids)).all()\n    return badges\n\n@router.post(\"/check-achievements\", response_model=dict)\ndef check_achievements(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n yeni rozet kazanÄ±p kazanmadÄ±ÄŸÄ±nÄ± kontrol eder (Manuel tetikleme).\"\"\"\n    # Ã–rnek Kontrol: 10'dan fazla etkinliÄŸe katÄ±lmÄ±ÅŸ mÄ±? (SadÄ±k Dost Rozeti)\n    participation_count = db.query(models.EventParticipant).filter(\n        models.EventParticipant.user_id == current_user.id,\n        models.EventParticipant.qr_scanned == True\n    ).count()\n    \n    new_badges = []\n    \n    # Rozet TanÄ±mlarÄ± (Normalde veritabanÄ±ndan Ã§ekilip criteria_type'a gÃ¶re dinamik yapÄ±lmalÄ±)\n    # Burada demo amaÃ§lÄ± sabit mantÄ±k kuruyoruz:\n    \n    if participation_count >= 5:\n        # 'SadÄ±k Dost' rozeti var mÄ± bak\n        badge = db.query(models.Badge).filter(models.Badge.name == \"SadÄ±k Dost\").first()\n        if badge:\n            exists = db.query(models.UserBadge).filter(\n                models.UserBadge.user_id == current_user.id,\n                models.UserBadge.badge_id == badge.id\n            ).first()\n            if not exists:\n                user_badge = models.UserBadge(user_id=current_user.id, badge_id=badge.id)\n                db.add(user_badge)\n                new_badges.append(badge.name)\n    \n    db.commit()\n    \n    return {\n        \"participation_count\": participation_count,\n        \"new_badges_earned\": new_badges,\n        \"message\": \"Rozet kontrolleri tamamlandÄ±.\" if new_badges else \"Yeni rozet kazanÄ±lmadÄ±.\"\n    }\n"
                },
                "intelligence.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, security, models, schemas\nfrom services.ai_engine import AIEngine\n\nrouter = APIRouter(prefix=\"/intelligence\", tags=[\"AI & Intelligence\"])\n\n@router.get(\"/recommendations\", response_model=List[schemas.EventOut])\ndef get_recommendations(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±ya Ã¶zel AI tabanlÄ± etkinlik Ã¶nerileri sunar.\"\"\"\n    recommendations = AIEngine.recommend_events(db, current_user.id)\n    return recommendations\n\n@router.post(\"/moderate\")\ndef moderate_content(\n    text: str,\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    GÃ¶nderilen metnin gÃ¼venli olup olmadÄ±ÄŸÄ±nÄ± kontrol eder.\n    Frontend giriÅŸlerinde veya yorumlarda kullanÄ±labilir.\n    \"\"\"\n    is_safe = AIEngine.content_moderation(text)\n    return {\n        \"text\": text,\n        \"is_safe\": is_safe,\n        \"action\": \"approve\" if is_safe else \"reject\"\n    }\n"
                },
                "interact.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, models, schemas, security\nfrom uuid import UUID\nfrom datetime import datetime, timedelta\nimport random\n\nrouter = APIRouter(\n    prefix=\"/interact\",\n    tags=[\"Interactions (Icebreakers, Voice)\"]\n)\n\n@router.get(\"/icebreaker/{event_id}\", response_model=dict)\ndef get_icebreaker_question(\n    event_id: UUID, \n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Etkinlik sohbeti iÃ§in rastgele bir buz kÄ±rÄ±cÄ± (tanÄ±ÅŸma) sorusu getirir.\"\"\"\n    # EtkinliÄŸi kontrol et\n    event = db.query(models.Event).filter(models.Event.id == event_id).first()\n    if not event:\n        raise HTTPException(status_code=404, detail=\"Etkinlik bulunamadÄ±.\")\n    \n    # Sisteme kayÄ±tlÄ± aktif sorulardan rastgele birini seÃ§\n    questions = db.query(models.IcebreakerQuestion).filter(models.IcebreakerQuestion.is_active == True).all()\n    if not questions:\n        return {\"question\": \"En son hangi konsere gittin?\", \"category\": \"Genel\"}\n    \n    question = random.choice(questions)\n    \n    # Log kaydÄ± at (Hangi sorunun sorulduÄŸunu takip etmek iÃ§in)\n    log = models.ChatLog(event_id=event_id, question_id=question.id)\n    db.add(log)\n    db.commit()\n    \n    return {\n        \"question\": question.question_text,\n        \"category\": question.category,\n        \"sent_at\": datetime.utcnow()\n    }\n\n@router.get(\"/voice-room/{event_id}\", response_model=dict)\ndef get_voice_room(\n    event_id: UUID,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"EtkinliÄŸe Ã¶zel sesli oda (Voice Room) bilgilerini getirir veya oluÅŸturur.\"\"\"\n    # KullanÄ±cÄ± etkinliÄŸe katÄ±lmÄ±ÅŸ mÄ± bak\n    participant = db.query(models.EventParticipant).filter(\n        models.EventParticipant.event_id == event_id,\n        models.EventParticipant.user_id == current_user.id\n    ).first()\n    \n    if not participant:\n        raise HTTPException(status_code=403, detail=\"Sesli odaya eriÅŸmek iÃ§in etkinliÄŸe katÄ±lmalÄ±sÄ±nÄ±z.\")\n    \n    # Oda var mÄ± bak\n    room = db.query(models.VoiceRoom).filter(models.VoiceRoom.event_id == event_id).first()\n    \n    if not room:\n        # Yeni oda oluÅŸtur\n        room = models.VoiceRoom(\n            event_id=event_id,\n            room_token=f\"room-{event_id.hex[:8]}-{random.randint(1000, 9999)}\",\n            is_active=True,\n            expires_at=datetime.utcnow() + timedelta(hours=24) # 24 saat sonra kapanÄ±r\n        )\n        db.add(room)\n        db.commit()\n        db.refresh(room)\n    \n    return {\n        \"room_token\": room.room_token,\n        \"is_active\": room.is_active,\n        \"expires_at\": room.expires_at\n    }\n"
                },
                "live_tracking.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status, WebSocket, WebSocketDisconnect\nfrom sqlalchemy.orm import Session\nfrom typing import List, Dict\nimport json\nimport database, models, schemas, security\nfrom uuid import UUID\nfrom datetime import datetime\nfrom services import maps_service\n\nrouter = APIRouter(\n    prefix=\"/tracking\",\n    tags=[\"Live Tracking (Uber Mode)\"]\n)\n\n# WebSocket YÃ¶neticisi: Etkinlik bazlÄ± odalar oluÅŸturur\nclass TrackingConnectionManager:\n    def __init__(self):\n        # event_id -> List[WebSocket] (Her etkinlik iÃ§in ayrÄ± liste)\n        self.active_connections: Dict[UUID, List[WebSocket]] = {}\n\n    async def connect(self, websocket: WebSocket, event_id: UUID):\n        await websocket.accept()\n        if event_id not in self.active_connections:\n            self.active_connections[event_id] = []\n        self.active_connections[event_id].append(websocket)\n\n    def disconnect(self, websocket: WebSocket, event_id: UUID):\n        if event_id in self.active_connections:\n            if websocket in self.active_connections[event_id]:\n                self.active_connections[event_id].remove(websocket)\n            if not self.active_connections[event_id]:\n                del self.active_connections[event_id]\n\n    async def broadcast(self, message: str, event_id: UUID):\n        if event_id in self.active_connections:\n            for connection in self.active_connections[event_id]:\n                try:\n                    await connection.send_text(message)\n                except Exception:\n                    pass # BaÄŸlantÄ± kopmuÅŸsa yoksay\n\nmanager = TrackingConnectionManager()\n\n@router.post(\"/update-location\", response_model=dict)\nasync def update_event_live_location(\n    event_id: UUID,\n    lat: float,\n    lon: float,\n    status: str = \"on_way\", # on_way, arrived\n    transport_type: str = \"walk\",\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n etkinliÄŸe giderken canlÄ± konumunu gÃ¼nceller.\"\"\"\n    # EtkinliÄŸe katÄ±lmÄ±ÅŸ mÄ± bak\n    participant = db.query(models.EventParticipant).filter(\n        models.EventParticipant.event_id == event_id,\n        models.EventParticipant.user_id == current_user.id\n    ).first()\n    \n    if not participant:\n        raise HTTPException(status_code=403, detail=\"CanlÄ± takip iÃ§in etkinliÄŸe kayÄ±tlÄ± olmalÄ±sÄ±nÄ±z.\")\n    \n    # Mevcut takip verisi var mÄ± bak\n    tracking = db.query(models.LiveTracking).filter(\n        models.LiveTracking.event_id == event_id,\n        models.LiveTracking.user_id == current_user.id\n    ).first()\n    \n    if tracking:\n        tracking.latitude = lat\n        tracking.longitude = lon\n        tracking.status = status\n        tracking.transport_type = transport_type\n        tracking.last_updated = datetime.utcnow()\n    else:\n        tracking = models.LiveTracking(\n            event_id=event_id,\n            user_id=current_user.id,\n            latitude=lat,\n            longitude=lon,\n            status=status,\n            transport_type=transport_type\n        )\n        db.add(tracking)\n    \n    db.commit()\n    \n    # WebSocket Ã¼zerinden dinleyenlere anlÄ±k bildirim gÃ¶nder\n    update_data = {\n        \"type\": \"location_update\",\n        \"user_id\": str(current_user.id),\n        \"full_name\": current_user.full_name,\n        \"latitude\": lat,\n        \"longitude\": lon,\n        \"status\": status,\n        \"transport_type\": transport_type,\n        \"last_updated\": str(datetime.utcnow())\n    }\n    await manager.broadcast(json.dumps(update_data), event_id)\n    \n    return {\"message\": \"Konumunuz gÃ¼ncellendi.\", \"status\": status}\n\n@router.get(\"/event-map/{event_id}\", response_model=List[dict])\ndef get_event_live_map(\n    event_id: UUID,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"EtkinliÄŸe giden tÃ¼m kullanÄ±cÄ±larÄ±n canlÄ± konumlarÄ±nÄ± getirir.\"\"\"\n    # Son 10 dakika iÃ§inde gÃ¼ncellenmiÅŸ konumlarÄ± getir\n    ten_minutes_ago = datetime.utcnow() - datetime.timedelta(minutes=10)\n    \n    # OPTÄ°MÄ°ZASYON: N+1 Sorunu giderildi. User tablosu ile JOIN yapÄ±ldÄ±.\n    results = db.query(\n        models.LiveTracking,\n        models.User.full_name\n    ).join(\n        models.User,\n        models.LiveTracking.user_id == models.User.id\n    ).filter(\n        models.LiveTracking.event_id == event_id,\n        models.LiveTracking.last_updated >= ten_minutes_ago\n    ).all()\n    \n    response_data = []\n    for t, full_name in results:\n        response_data.append({\n            \"user_id\": t.user_id,\n            \"full_name\": full_name if full_name else \"Gizli KullanÄ±cÄ±\",\n            \"latitude\": t.latitude,\n            \"longitude\": t.longitude,\n            \"status\": t.status,\n            \"transport_type\": t.transport_type,\n            \"last_updated\": t.last_updated\n        })\n        \n    return response_data\n\n@router.get(\"/directions\", response_model=dict)\ndef get_route(\n    origin_lat: float, \n    origin_lon: float, \n    dest_lat: float, \n    dest_lon: float, \n    mode: str = \"walking\",\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    Google Maps API kullanarak iki nokta arasÄ±ndaki rotayÄ± (polyline) getirir.\n    \"\"\"\n    origin = f\"{origin_lat},{origin_lon}\"\n    destination = f\"{dest_lat},{dest_lon}\"\n    \n    return maps_service.get_directions(origin, destination, mode)\n\n@router.websocket(\"/ws/{event_id}/{token}\")\nasync def websocket_tracking(\n    websocket: WebSocket, \n    event_id: UUID, \n    token: str, \n    db: Session = Depends(database.get_db)\n):\n    \"\"\"\n    CanlÄ± takip haritasÄ± iÃ§in WebSocket baÄŸlantÄ±sÄ±.\n    Ä°stemciler bu sokete baÄŸlanarak haritadaki hareketleri anlÄ±k izler.\n    \"\"\"\n    # 1. Kimlik DoÄŸrulama (Token URL parametresi olarak gelir)\n    try:\n        payload = security.decode_access_token(token)\n        email = payload.get(\"sub\")\n        if email is None:\n            await websocket.close(code=1008)\n            return\n        user = db.query(models.User).filter(models.User.email == email).first()\n        if user is None:\n            await websocket.close(code=1008)\n            return\n    except Exception:\n        await websocket.close(code=1008)\n        return\n\n    # 2. Odaya BaÄŸlan (Etkinlik ID'sine gÃ¶re)\n    await manager.connect(websocket, event_id)\n    \n    try:\n        while True:\n            # Ä°stemciden veri bekle (Ping/Pong veya istemci konumu)\n            # Åimdilik sadece dinleyici modunda Ã§alÄ±ÅŸÄ±yorlar ama\n            # ilerde sÃ¼rÃ¼cÃ¼ de buradan konum atabilir.\n            data = await websocket.receive_text()\n            # Gelen veriyi iÅŸle veya yoksay (Heartbeat vb.)\n            pass\n    except WebSocketDisconnect:\n        manager.disconnect(websocket, event_id)\n"
                },
                "location.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, HTTPException, Depends\nfrom typing import List, Optional\nimport schemas\nfrom services import location_service\n\nrouter = APIRouter(tags=[\"Location\"])\n\n@router.post(\"/api/location/update\")\ndef update_location(data: schemas.LocationUpdate):\n    \"\"\"\n    KullanÄ±cÄ± konumu gÃ¼ncelleme veya gizleme endpointi.\n    \"\"\"\n    try:\n        result = location_service.update_location(\n            user_id=data.user_id,\n            latitude=data.latitude,\n            longitude=data.longitude,\n            is_ghost_mode=data.is_ghost_mode\n        )\n        return result\n    except Exception as e:\n        print(f\"Location Error: {e}\")\n        raise HTTPException(status_code=500, detail=\"Konum gÃ¼ncellenemedi (Redis hatasÄ± olabilir)\")\n\n@router.get(\"/api/location/nearby\")\ndef get_nearby_users(\n    user_id: str, \n    lat: float, \n    lon: float, \n    radius_km: float = 5.0,\n    limit: int = 50\n):\n    \"\"\"\n    Belirli bir konumun etrafÄ±ndaki kullanÄ±cÄ±larÄ± getirir (Radar).\n    \"\"\"\n    try:\n        return location_service.get_nearby_users(\n            user_id=user_id,\n            latitude=lat,\n            longitude=lon,\n            radius_km=radius_km,\n            limit=limit\n        )\n    except Exception as e:\n        print(f\"Location Error: {e}\")\n        raise HTTPException(status_code=500, detail=\"Ã‡evresel arama yapÄ±lamadÄ±\")\n"
                },
                "marketplace.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException\nfrom sqlalchemy.orm import Session\nfrom typing import List\nfrom uuid import UUID\nimport sys\nimport os\n\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nimport database, schemas, crud, models, security\n\nrouter = APIRouter(tags=[\"Marketplace\"])\nget_db = database.get_db\n\n@router.post(\"/marketplace/items\", response_model=schemas.MarketplaceItemOut)\ndef create_item(\n    item: schemas.MarketplaceItemCreate,\n    current_user: models.User = Depends(security.get_current_user),\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Yeni bir pazaryeri ilanÄ± (eÅŸya, kitap vb.) oluÅŸturur.\n    \"\"\"\n    db_item = models.MarketplaceItem(\n        owner_id=current_user.id,\n        title=item.title,\n        description=item.description,\n        price=item.price,\n        category=item.category,\n        image_url=item.image_url,\n        status=\"active\"\n    )\n    db.add(db_item)\n    db.commit()\n    db.refresh(db_item)\n    return db_item\n\n@router.get(\"/marketplace/items\", response_model=List[schemas.MarketplaceItemOut])\ndef list_items(\n    category: str = None,\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    TÃ¼m aktif ilanlarÄ± listeler. Kategori filtresi eklenebilir.\n    \"\"\"\n    query = db.query(models.MarketplaceItem).filter(models.MarketplaceItem.status == \"active\")\n    if category:\n        query = query.filter(models.MarketplaceItem.category == category)\n    return query.order_by(models.MarketplaceItem.created_at.desc()).all()\n\n@router.delete(\"/marketplace/items/{item_id}\")\ndef delete_item(\n    item_id: int,\n    current_user: models.User = Depends(security.get_current_user),\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Ä°lanÄ± siler (Sahibi silebilir).\n    \"\"\"\n    db_item = db.query(models.MarketplaceItem).filter(models.MarketplaceItem.id == item_id).first()\n    if not db_item:\n        raise HTTPException(status_code=404, detail=\"Ä°lan bulunamadÄ±.\")\n    if db_item.owner_id != current_user.id:\n        raise HTTPException(status_code=403, detail=\"Bu ilanÄ± silme yetkiniz yok.\")\n    \n    db_item.status = \"deleted\"\n    db.commit()\n    return {\"status\": \"success\", \"message\": \"Ä°lan baÅŸarÄ±yla silindi.\"}\n\n@router.post(\"/marketplace/items/{item_id}/buy\")\ndef buy_item(\n    item_id: int,\n    current_user: models.User = Depends(security.get_current_user),\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Ä°lanÄ± satÄ±n alÄ±r (CÃ¼zdan bakiyesi ile).\n    \"\"\"\n    # CONCURRENCY FIX: VeritabanÄ± kilitleme (Row-Level Locking)\n    # with_for_update() kullanarak, iÅŸlem bitene kadar bu Ã¼rÃ¼nÃ¼n baÅŸkasÄ± tarafÄ±ndan seÃ§ilmesini/deÄŸiÅŸtirilmesini engelliyoruz.\n    db_item = db.query(models.MarketplaceItem).filter(models.MarketplaceItem.id == item_id).with_for_update().first()\n    if not db_item or db_item.status != \"active\":\n        raise HTTPException(status_code=404, detail=\"Ä°lan aktif deÄŸil veya bulunamadÄ±.\")\n    \n    if current_user.wallet_balance < db_item.price:\n        raise HTTPException(status_code=400, detail=\"CÃ¼zdan bakiyeniz yetersiz.\")\n\n    # Ä°ÅŸlem: AlÄ±cÄ±dan dÃ¼ÅŸ, satÄ±cÄ±ya ekle\n    owner = db.query(models.User).filter(models.User.id == db_item.owner_id).first()\n    \n    current_user.wallet_balance -= float(db_item.price)\n    owner.wallet_balance += float(db_item.price)\n    db_item.status = \"sold\"\n\n    # Transaction log\n    db.add(models.Transaction(user_id=current_user.id, amount=db_item.price, status=\"paid\", transaction_type=\"payment\", description=f\"Pazar AlÄ±mÄ±: {db_item.title}\"))\n    db.add(models.Transaction(user_id=owner.id, amount=db_item.price, status=\"paid\", transaction_type=\"deposit\", description=f\"Pazar SatÄ±ÅŸÄ±: {db_item.title}\"))\n\n    db.commit()\n    return {\"status\": \"success\", \"message\": \"SatÄ±n alma iÅŸlemi baÅŸarÄ±lÄ±!\"}\n"
                },
                "media.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, UploadFile, File, HTTPException\nfrom fastapi.responses import JSONResponse\nimport shutil\nimport os\nimport sys\n\n# Parent directory for imports\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom services.image_processor import process_and_compress_image\n\nrouter = APIRouter(tags=[\"Media\"])\n\n# Resimlerin kaydedileceÄŸi yer (Sunucu iÃ§inde)\nUPLOAD_DIR = \"uploads/images\"\nif not os.path.exists(UPLOAD_DIR):\n    os.makedirs(UPLOAD_DIR)\n\n# Sunucu adresi production'da deÄŸiÅŸeceÄŸi iÃ§in relative path kullanÄ±yoruz.\n\n@router.post(\"/api/upload/image\")\nasync def upload_image(file: UploadFile = File(...)):\n    \"\"\"\n    KullanÄ±cÄ± profili veya etkinlik iÃ§in resim yÃ¼kleme servisi.\n    Otomatik sÄ±kÄ±ÅŸtÄ±rma ve gÃ¼venlik Ã¶nlemi iÃ§erir.\n    \"\"\"\n    # 1. Sadece resim dosyasÄ± mÄ± kontrol et\n    if not file.content_type.startswith(\"image/\"):\n        raise HTTPException(status_code=400, detail=\"Sadece resim dosyasÄ± yÃ¼kleyebilirsiniz.\")\n\n    try:\n        # 2. Resmi iÅŸleme motoruna gÃ¶nder (SÄ±kÄ±ÅŸtÄ±rma & Format DeÄŸiÅŸtirme)\n        # file.file file-like objesidir\n        processed_data = process_and_compress_image(file.file)\n        \n        if not processed_data:\n            raise HTTPException(status_code=500, detail=\"Resim iÅŸlenirken hata oluÅŸtu.\")\n\n        # 3. DosyayÄ± diske kaydet\n        file_path = os.path.join(UPLOAD_DIR, processed_data[\"filename\"])\n        \n        with open(file_path, \"wb\") as f:\n            f.write(processed_data[\"file\"].read())\n\n        return JSONResponse(content={\n            \"status\": \"success\",\n            \"file_url\": f\"/images/{processed_data['filename']}\",\n            \"original_name\": file.filename,\n            \"width\": processed_data[\"width\"],\n            \"height\": processed_data[\"height\"]\n        })\n\n    except Exception as e:\n        # Hata logu\n        print(f\"Upload HatasÄ±: {str(e)}\")\n        raise HTTPException(status_code=500, detail=f\"Sunucu hatasÄ±: {str(e)}\")\n"
                },
                "notifications.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, models, schemas, security\n\nrouter = APIRouter(\n    prefix=\"/notifications\",\n    tags=[\"Notifications\"]\n)\n\n@router.get(\"/\", response_model=List[schemas.NotificationOut])\ndef get_notifications(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n tÃ¼m bildirimlerini listeler.\"\"\"\n    return db.query(models.Notification).filter(\n        models.Notification.user_id == current_user.id\n    ).order_by(models.Notification.created_at.desc()).all()\n\n@router.post(\"/{notification_id}/read\")\ndef mark_as_read(\n    notification_id: int,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Bildirimi okundu olarak iÅŸaretler.\"\"\"\n    notif = db.query(models.Notification).filter(\n        models.Notification.id == notification_id,\n        models.Notification.user_id == current_user.id\n    ).first()\n    \n    if not notif:\n        raise HTTPException(status_code=404, detail=\"Bildirim bulunamadÄ±.\")\n    \n    notif.is_read = True\n    db.commit()\n    return {\"message\": \"Bildirim okundu.\"}\n"
                },
                "participants.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, models, schemas, security\nfrom uuid import UUID\nfrom datetime import datetime\n\nrouter = APIRouter(\n    prefix=\"/participants\",\n    tags=[\"Event Participation\"]\n)\n\n@router.post(\"/join/{event_id}\", response_model=dict)\ndef join_event(\n    event_id: UUID,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"EtkinliÄŸe katÄ±lÄ±m isteÄŸi oluÅŸturur ve varsa kapora Ã¼cretini Ã§eker.\"\"\"\n    event = db.query(models.Event).filter(models.Event.id == event_id).first()\n    if not event:\n        raise HTTPException(status_code=404, detail=\"Etkinlik bulunamadÄ±.\")\n    \n    # Zaten katÄ±lmÄ±ÅŸ mÄ± kontrol et\n    existing_participant = db.query(models.EventParticipant).filter(\n        models.EventParticipant.event_id == event_id,\n        models.EventParticipant.user_id == current_user.id\n    ).first()\n    if existing_participant:\n        raise HTTPException(status_code=400, detail=\"Zaten bu etkinliÄŸe katÄ±ldÄ±nÄ±z.\")\n    \n    # Kapora KontrolÃ¼\n    if event.deposit_amount > 0:\n        if current_user.wallet_balance < event.deposit_amount:\n            raise HTTPException(status_code=400, detail=\"Yetersiz bakiye. KatÄ±lÄ±m iÃ§in kapora Ã¶denmelidir.\")\n        \n        current_user.wallet_balance -= event.deposit_amount\n        payment_status = \"paid\"\n    else:\n        payment_status = \"pending\"\n    \n    # KatÄ±lÄ±mcÄ± ekle\n    participant = models.EventParticipant(\n        event_id=event_id,\n        user_id=current_user.id,\n        status=\"approved\",\n        payment_status=payment_status\n    )\n    \n    db.add(participant)\n    db.commit()\n    \n    return {\n        \"message\": \"EtkinliÄŸe baÅŸarÄ±yla katÄ±ldÄ±nÄ±z.\",\n        \"payment_status\": payment_status,\n        \"remaining_balance\": current_user.wallet_balance\n    }\n\n@router.post(\"/scan-qr/{event_id}\", response_model=dict)\ndef scan_qr_code(\n    event_id: UUID,\n    session_token: str,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Etkinlik alanÄ±ndaki QR kodu okutarak katÄ±lÄ±mÄ± doÄŸrular (Turnike).\"\"\"\n    event = db.query(models.Event).filter(models.Event.id == event_id).first()\n    if not event:\n        raise HTTPException(status_code=404, detail=\"Etkinlik bulunamadÄ±.\")\n    \n    if event.session_token != session_token:\n        raise HTTPException(status_code=400, detail=\"GeÃ§ersiz QR kod veya oturum anahtarÄ±.\")\n    \n    participant = db.query(models.EventParticipant).filter(\n        models.EventParticipant.event_id == event_id,\n        models.EventParticipant.user_id == current_user.id\n    ).first()\n    \n    if not participant:\n        raise HTTPException(status_code=404, detail=\"Bu etkinlik iÃ§in kaydÄ±nÄ±z bulunamadÄ±.\")\n    \n    if participant.qr_scanned:\n        return {\"message\": \"Zaten giriÅŸ yaptÄ±nÄ±z.\"}\n    \n    participant.qr_scanned = True\n    participant.check_in_time = datetime.utcnow()\n    \n    # GÃ¼ven puanÄ±nÄ± artÄ±r (EtkinliÄŸe geldiÄŸi iÃ§in)\n    current_user.trust_score += 5\n    if current_user.trust_score > 100:\n        current_user.trust_score = 100\n        \n    db.commit()\n    \n    return {\n        \"message\": \"GiriÅŸ baÅŸarÄ±lÄ±! EtkinliÄŸe hoÅŸ geldiniz.\",\n        \"trust_score\": current_user.trust_score\n    }\n\n@router.get(\"/my-events\", response_model=List[schemas.EventOut])\ndef get_my_events(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n katÄ±ldÄ±ÄŸÄ± veya oluÅŸturduÄŸu etkinlikleri getirir.\"\"\"\n    # KatÄ±ldÄ±ÄŸÄ± etkinliklerin ID'lerini al\n    participated_event_ids = db.query(models.EventParticipant.event_id).filter(\n        models.EventParticipant.user_id == current_user.id\n    ).all()\n    event_ids = [eid[0] for eid in participated_event_ids]\n    \n    # KatÄ±ldÄ±ÄŸÄ± veya sahibi olduÄŸu etkinlikleri getir\n    events = db.query(models.Event).filter(\n        (models.Event.id.in_(event_ids)) | (models.Event.host_id == current_user.id)\n    ).all()\n    \n    return events\n\n# --- 4. BÄ°LET AL (GET /participants/ticket/{event_id}) ---\n@router.get(\"/ticket/{event_id}\", response_model=dict)\ndef get_event_ticket(\n    event_id: UUID,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±ya Ã¶zel, tek kullanÄ±mlÄ±k bilet token'Ä± (Access Key) oluÅŸturur.\"\"\"\n    participant = db.query(models.EventParticipant).filter(\n        models.EventParticipant.event_id == event_id,\n        models.EventParticipant.user_id == current_user.id\n    ).first()\n    \n    if not participant:\n        raise HTTPException(status_code=404, detail=\"Bu etkinlik iÃ§in biletiniz bulunmuyor.\")\n    \n    # GÃ¼venlik iÃ§in: Bilet iÃ§eriÄŸi = event_id + user_id + secret_salt (SimÃ¼le)\n    # GerÃ§ekte burasÄ± imzalÄ± bir JWT veya tek kullanÄ±mlÄ±k hash olmalÄ±.\n    access_key = f\"ARTIBIR_KEY_{str(event_id)[:8]}_{str(current_user.id)[:8]}\"\n    \n    return {\n        \"access_key\": access_key,\n        \"event_title\": participant.event.title,\n        \"user_name\": current_user.full_name,\n        \"status\": participant.status\n    }\n\n# --- 5. BÄ°LET DOÄRULA (POST /participants/validate-ticket) ---\n@router.post(\"/validate-ticket\", response_model=dict)\ndef validate_participant_ticket(\n    event_id: UUID,\n    access_key: str,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"OrganizatÃ¶rÃ¼n (Host), katÄ±lÄ±mcÄ± biletini tarayÄ±p onaylamasÄ±nÄ± saÄŸlar.\"\"\"\n    event = db.query(models.Event).filter(models.Event.id == event_id).first()\n    \n    if not event:\n        raise HTTPException(status_code=404, detail=\"Etkinlik bulunamadÄ±.\")\n        \n    if event.host_id != current_user.id:\n        raise HTTPException(status_code=403, detail=\"Sadece etkinlik sahibi bilet doÄŸrulayabilir.\")\n    \n    # Access Key'den user_id Ã§Ä±karÄ±mÄ± (SimÃ¼lasyon gereÄŸi basitleÅŸtirildi)\n    # Normalde access_key Ã§Ã¶zÃ¼lÃ¼p iÃ§indeki user_id kontrol edilmeli.\n    user_id_part = access_key.split(\"_\")[-1]\n    \n    participant = db.query(models.EventParticipant).join(models.User).filter(\n        models.EventParticipant.event_id == event_id,\n        models.User.id.cast(models.String).like(f\"{user_id_part}%\")\n    ).first()\n    \n    if not participant:\n        raise HTTPException(status_code=404, detail=\"GeÃ§ersiz bilet veya katÄ±lÄ±mcÄ± bulunamadÄ±.\")\n    \n    if participant.qr_scanned:\n        raise HTTPException(status_code=400, detail=\"Bu bilet zaten kullanÄ±lmÄ±ÅŸ.\")\n        \n    participant.qr_scanned = True\n    participant.check_in_time = datetime.utcnow()\n    \n    # KatÄ±lÄ±mcÄ±nÄ±n gÃ¼ven puanÄ±nÄ± artÄ±r\n    participant.user.trust_score += 5\n    if participant.user.trust_score > 100:\n        participant.user.trust_score = 100\n        \n    db.commit()\n    \n    return {\n        \"status\": \"success\",\n        \"message\": f\"{participant.user.full_name} iÃ§in giriÅŸ onaylandÄ±.\",\n        \"new_trust_score\": participant.user.trust_score\n    }\n\n# --- 6. ETKÄ°NLÄ°KTEN AYRIL (DELETE /participants/leave/{event_id}) ---\n@router.delete(\"/leave/{event_id}\", response_model=dict)\ndef leave_event(\n    event_id: UUID,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n etkinlikten ayrÄ±lmasÄ±nÄ± saÄŸlar (Ceza ProtokolÃ¼ dahil).\"\"\"\n    participant = db.query(models.EventParticipant).filter(\n        models.EventParticipant.event_id == event_id,\n        models.EventParticipant.user_id == current_user.id\n    ).first()\n    \n    if not participant:\n        raise HTTPException(status_code=404, detail=\"Bu etkinlikte kaydÄ±nÄ±z bulunmuyor.\")\n    \n    event = participant.event\n    time_diff = event.event_date - datetime.utcnow()\n    hours_left = time_diff.total_seconds() / 3600\n    \n    penalty = 0\n    message = \"Etkinlikten baÅŸarÄ±yla ayrÄ±ldÄ±nÄ±z.\"\n    \n    # Ceza Hesaplama\n    if hours_left < 2:\n        penalty = 10\n        message = \"SON_DAKÄ°KA_AYRILMA: GÃ¼ven puanÄ±nÄ±z 10 birim dÃ¼ÅŸÃ¼rÃ¼ldÃ¼.\"\n    elif hours_left < 12:\n        penalty = 5\n        message = \"KRÄ°TÄ°K_ZAMAN_AYRILMA: GÃ¼ven puanÄ±nÄ±z 5 birim dÃ¼ÅŸÃ¼rÃ¼ldÃ¼.\"\n    \n    if penalty > 0:\n        current_user.trust_score -= penalty\n        if current_user.trust_score < 0:\n            current_user.trust_score = 0\n            \n        # Sistem bildirimi oluÅŸtur\n        new_notif = models.Notification(\n            user_id=current_user.id,\n            title=\"GÃœVEN_PUANI_DÃœÅÃœÅÃœ\",\n            message=f\"{event.title} etkinliÄŸinden geÃ§ ayrÄ±ldÄ±ÄŸÄ±nÄ±z iÃ§in -{penalty} puan aldÄ±nÄ±z.\",\n            type=\"system\"\n        )\n        db.add(new_notif)\n\n    # Ä°ade MantÄ±ÄŸÄ± (Opsiyonel)\n    if participant.payment_status == \"paid\" and hours_left > 24:\n        current_user.wallet_balance += event.deposit_amount\n        message += f\" {event.deposit_amount} kredi iade edildi.\"\n\n    db.delete(participant)\n    db.commit()\n    \n    return {\n        \"status\": \"success\",\n        \"message\": message,\n        \"new_trust_score\": current_user.trust_score\n    }\n"
                },
                "payments.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException, Request, Form\nfrom fastapi.responses import HTMLResponse\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport sys\nimport os\nimport json\nimport hmac\nimport hashlib\n\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nimport database, schemas, crud, models, security\nfrom services.payment_service import PaymentService\n\nrouter = APIRouter(tags=[\"Payments\"])\nget_db = database.get_db\n\n@router.post(\"/payments/initialize-3ds\", response_model=dict)\ndef initialize_3ds(\n    payment_data: schemas.PaymentInitialize,\n    current_user: models.User = Depends(security.get_current_user),\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    3D Secure Ã¶demeyi baÅŸlatÄ±r ve banka onay sayfasÄ±na yÃ¶nelecek olan HTML/Form verisini dÃ¶ner.\n    \"\"\"\n    try:\n        # 1. Iyzico Checkout Form / 3DS BaÅŸlat\n        result_json = PaymentService.initialize_3ds_payment(\n            user=current_user,\n            card_info=payment_data.model_dump(),\n            amount=payment_data.amount\n        )\n        result = json.loads(result_json)\n\n        if result.get(\"status\") != \"success\":\n            raise HTTPException(status_code=400, detail=result.get(\"errorMessage\", \"Ã–deme baÅŸlatÄ±lamadÄ±.\"))\n\n        # 2. Ä°ÅŸlemi PENDING olarak kaydet\n        crud_transaction = models.Transaction(\n            user_id=current_user.id,\n            amount=payment_data.amount,\n            conversation_id=result.get(\"conversationId\"),\n            status=models.PaymentStatus.PENDING,\n            transaction_type=\"deposit\",\n            description=\"CÃ¼zdan YÃ¼kleme (3DS BaÅŸlatÄ±ldÄ±)\"\n        )\n        db.add(crud_transaction)\n        db.commit()\n\n        # 3DS HTML iÃ§eriÄŸini dÃ¶n\n        return {\n            \"status\": \"success\",\n            \"three_d_sh_html_content\": result.get(\"threeDSHTMLContent\")\n        }\n\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\n@router.post(\"/payments/callback\")\nasync def payment_callback(\n    request: Request,\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Iyzico 3DS doÄŸrulama sonrasÄ± bu endpoint'e POST atar.\n    Flutter WebView bu adresi dinler.\n    \"\"\"\n    form_data = await request.form()\n    # status, paymentId, conversationId, mdStatus vb. gelir\n    \n    payment_id = form_data.get(\"paymentId\")\n    conversation_id = form_data.get(\"conversationId\")\n    status = form_data.get(\"status\")\n    \n    # GÃœVENLÄ°K: HMAC Ä°mza KontrolÃ¼\n    # URL'den gelen imza ile bizim hesapladÄ±ÄŸÄ±mÄ±z imza eÅŸleÅŸmeli.\n    incoming_signature = request.query_params.get(\"signature\")\n    if not incoming_signature or not conversation_id:\n        return HTMLResponse(\"<html><body><h1>GÃ¼venlik HatasÄ±: GeÃ§ersiz Ä°stek.</h1></body></html>\")\n\n    api_secret = os.getenv(\"IYZICO_SECRET_KEY\", \"\").encode()\n    expected_signature = hmac.new(api_secret, conversation_id.encode(), hashlib.sha256).hexdigest()\n\n    if not hmac.compare_digest(incoming_signature, expected_signature):\n        return HTMLResponse(\"<html><body><h1>GÃ¼venlik HatasÄ±: Ä°mza DoÄŸrulanamadÄ±.</h1></body></html>\")\n\n    # Ä°ÅŸlemi bul\n    transaction = db.query(models.Transaction).filter(models.Transaction.conversation_id == conversation_id).first()\n    if not transaction:\n        return HTMLResponse(\"<html><body><h1>Ä°ÅŸlem bulunamadÄ±.</h1></body></html>\")\n\n    if status == \"success\":\n        # Iyzico'dan Ã¶demeyi tamamla (ThreedsPayment)\n        completion_json = PaymentService.retrieve_3ds_result(payment_id, conversation_id)\n        completion = json.loads(completion_json)\n        \n        if completion.get(\"status\") == \"success\":\n            # 1. Ä°ÅŸlemi onayla\n            transaction.status = models.PaymentStatus.PAID\n            transaction.payment_id = payment_id\n            transaction.description = \"CÃ¼zdan YÃ¼kleme BaÅŸarÄ±lÄ±\"\n            \n            # 2. KullanÄ±cÄ±nÄ±n bakiyesini gÃ¼ncelle\n            user = db.query(models.User).filter(models.User.id == transaction.user_id).first()\n            user.wallet_balance += float(transaction.amount)\n            \n            db.commit()\n            return HTMLResponse(\"<html><body><h1>Ã–deme BaÅŸarÄ±lÄ±!</h1><script>window.parent.postMessage('success', '*');</script></body></html>\")\n        else:\n            transaction.status = models.PaymentStatus.PENDING # Hata durumunda beklemede bÄ±rak veya fail et\n            db.commit()\n            return HTMLResponse(f\"<html><body><h1>Ã–deme HatasÄ±: {completion.get('errorMessage')}</h1></body></html>\")\n    else:\n        transaction.status = models.PaymentStatus.PENDING\n        db.commit()\n        return HTMLResponse(\"<html><body><h1>Ã–deme baÅŸarÄ±sÄ±z veya iptal edildi.</h1></body></html>\")\n\n@router.get(\"/payments/transactions\", response_model=List[schemas.TransactionOut])\ndef get_transactions(\n    current_user: models.User = Depends(security.get_current_user),\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    KullanÄ±cÄ±nÄ±n iÅŸlem geÃ§miÅŸini getirir.\n    \"\"\"\n    return db.query(models.Transaction).filter(models.Transaction.user_id == current_user.id).order_by(models.Transaction.created_at.desc()).all()\n"
                },
                "reports.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, models, schemas, security\nfrom uuid import UUID\nfrom datetime import datetime\n\nrouter = APIRouter(\n    prefix=\"/reports\",\n    tags=[\"Discipline & Reporting\"]\n)\n\n@router.post(\"/report-user\", response_model=dict)\ndef report_user(\n    reported_id: UUID,\n    reason: str,\n    event_id: UUID = None,\n    details: str = None,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Bir kullanÄ±cÄ±yÄ± ÅŸikayet eder. Åikayet edilenin gÃ¼ven puanÄ±nÄ± dÃ¼ÅŸÃ¼rÃ¼r.\"\"\"\n    reported_user = db.query(models.User).filter(models.User.id == reported_id).first()\n    if not reported_user:\n        raise HTTPException(status_code=404, detail=\"KullanÄ±cÄ± bulunamadÄ±.\")\n    \n    # Raporu kaydet\n    report = models.UserReport(\n        reporter_id=current_user.id,\n        reported_id=reported_id,\n        event_id=event_id,\n        reason=reason,\n        details=details\n    )\n    db.add(report)\n    \n    # Ceza PuanÄ± (Trust Score Deduction)\n    # Sebebe gÃ¶re farklÄ± puanlar dÃ¼ÅŸÃ¼lebilir\n    deduction = 5\n    if reason == \"noshow\": deduction = 10\n    if reason == \"harassment\": deduction = 20\n    \n    reported_user.trust_score -= deduction\n    if reported_user.trust_score < 0:\n        reported_user.trust_score = 0\n        \n    db.commit()\n    \n    return {\n        \"message\": \"Åikayetiniz iletildi. TeÅŸekkÃ¼r ederiz.\",\n        \"reported_user_trust_score\": reported_user.trust_score\n    }\n\n@router.get(\"/my-reports\", response_model=List[dict])\ndef get_my_reports(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n yaptÄ±ÄŸÄ± ÅŸikayetleri listeler.\"\"\"\n    reports = db.query(models.UserReport).filter(models.UserReport.reporter_id == current_user.id).all()\n    return [{\"id\": r.id, \"reason\": r.reason, \"reported_id\": r.reported_id, \"created_at\": r.created_at} for r in reports]\n"
                },
                "reviews.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException\nfrom sqlalchemy.orm import Session\nfrom typing import List\nfrom uuid import UUID\nimport sys\nimport os\n\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nimport database, schemas, crud, models, security\n\nrouter = APIRouter(tags=[\"Reviews\"])\nget_db = database.get_db\n\n@router.post(\"/reviews\", response_model=schemas.UserReviewOut)\ndef create_review(\n    review: schemas.UserReviewCreate,\n    current_user: models.User = Depends(security.get_current_user),\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Bir kullanÄ±cÄ± iÃ§in yorum ve puan (1-5) bÄ±rakÄ±r.\n    \"\"\"\n    if review.reviewed_id == current_user.id:\n        raise HTTPException(status_code=400, detail=\"Kendinize yorum yapamazsÄ±nÄ±z.\")\n\n    db_review = models.UserReview(\n        reviewer_id=current_user.id,\n        reviewed_id=review.reviewed_id,\n        event_id=review.event_id,\n        rating=review.rating,\n        comment=review.comment\n    )\n    db.add(db_review)\n    \n    # Hedef kullanÄ±cÄ±nÄ±n Trust Score'unu gÃ¼ncelle (Basit bir aÄŸÄ±rlÄ±kla)\n    target_user = db.query(models.User).filter(models.User.id == review.reviewed_id).first()\n    if target_user:\n        # Puan 5 ise +2, puan 1 ise -5 gibi bir mantÄ±k\n        score_change = (review.rating - 3) * 2\n        target_user.trust_score = max(0, min(100, target_user.trust_score + score_change))\n\n    db.commit()\n    db.refresh(db_review)\n    return db_review\n\n@router.get(\"/reviews/user/{user_id}\", response_model=List[schemas.UserReviewOut])\ndef get_user_reviews(\n    user_id: UUID,\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Belirli bir kullanÄ±cÄ±ya yapÄ±lmÄ±ÅŸ tÃ¼m yorumlarÄ± getirir.\n    \"\"\"\n    return db.query(models.UserReview).filter(models.UserReview.reviewed_id == user_id).order_by(models.UserReview.created_at.desc()).all()\n\n@router.get(\"/reviews/average/{user_id}\")\ndef get_average_rating(\n    user_id: UUID,\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    KullanÄ±cÄ±nÄ±n ortalama puanÄ±nÄ± (Rating) dÃ¶ner.\n    \"\"\"\n    reviews = db.query(models.UserReview).filter(models.UserReview.reviewed_id == user_id).all()\n    if not reviews:\n        return {\"average_rating\": 0, \"count\": 0}\n    \n    avg = sum([r.rating for r in reviews]) / len(reviews)\n    return {\"average_rating\": round(avg, 1), \"count\": len(reviews)}\n"
                },
                "search.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, Query\nfrom sqlalchemy.orm import Session\nfrom typing import List, Optional\nimport database, models, schemas\n\nrouter = APIRouter(prefix=\"/search\", tags=[\"Global Search\"])\n\n@router.get(\"/\")\ndef global_search(\n    q: str = Query(..., min_length=2, description=\"Arama sorgusu\"),\n    db: Session = Depends(database.get_db)\n):\n    \"\"\"\n    KullanÄ±cÄ±lar, etkinlikler ve kulÃ¼pler arasÄ±nda arama yapar.\n    \"\"\"\n    search_term = f\"%{q}%\"\n    \n    # 1. KullanÄ±cÄ± Arama\n    users = db.query(models.User).filter(\n        (models.User.full_name.ilike(search_term)) | \n        (models.User.department.ilike(search_term))\n    ).limit(10).all()\n    \n    # 2. Etkinlik Arama\n    events = db.query(models.Event).filter(\n        (models.Event.title.ilike(search_term)) | \n        (models.Event.description.ilike(search_term)) |\n        (models.Event.category.ilike(search_term))\n    ).limit(10).all()\n    \n    # 3. KulÃ¼p Arama\n    clubs = db.query(models.Club).filter(\n        (models.Club.name.ilike(search_term)) | \n        (models.Club.description.ilike(search_term))\n    ).limit(10).all()\n    \n    return {\n        \"query\": q,\n        \"results\": {\n            \"users\": users,\n            \"events\": events,\n            \"clubs\": clubs\n        }\n    }\n"
                },
                "security_management.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nimport database, models, schemas, security\nfrom typing import List\nfrom passlib.context import CryptContext\n\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n\nrouter = APIRouter(\n    prefix=\"/security\",\n    tags=[\"Security & Authentication\"]\n)\n\n@router.post(\"/change-password\")\ndef change_password(\n    data: schemas.PasswordChange,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n ÅŸifresini gÃ¼venli bir ÅŸekilde deÄŸiÅŸtirir.\"\"\"\n    if not pwd_context.verify(data.old_password, current_user.password):\n        raise HTTPException(status_code=400, detail=\"Mevcut ÅŸifre hatalÄ±.\")\n    \n    current_user.password = pwd_context.hash(data.new_password)\n    db.commit()\n    return {\"message\": \"Åifre baÅŸarÄ±yla gÃ¼ncellendi.\"}\n\n@router.get(\"/devices\", response_model=List[schemas.LoginDeviceOut])\ndef get_login_devices(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n hesabÄ±na giriÅŸ yapmÄ±ÅŸ olan cihazlarÄ± listeler.\"\"\"\n    return db.query(models.LoginDevice).filter(models.LoginDevice.user_id == current_user.id).all()\n\n@router.delete(\"/devices/{device_id}\")\ndef logout_device(\n    device_id: int,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Belirli bir cihazÄ±n oturumunu sonlandÄ±rÄ±r (AktifliÄŸini kaldÄ±rÄ±r).\"\"\"\n    device = db.query(models.LoginDevice).filter(\n        models.LoginDevice.id == device_id,\n        models.LoginDevice.user_id == current_user.id\n    ).first()\n    \n    if not device:\n        raise HTTPException(status_code=404, detail=\"Cihaz bulunamadÄ±.\")\n    \n    db.delete(device)\n    db.commit()\n    return {\"message\": \"Cihaz oturumu sonlandÄ±rÄ±ldÄ±.\"}\n"
                },
                "settings.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nimport database, models, schemas, security\nfrom typing import List\n\nrouter = APIRouter(\n    prefix=\"/settings\",\n    tags=[\"User Settings & Privacy\"]\n)\n\n@router.put(\"/profile\", response_model=schemas.UserOut)\ndef update_profile(\n    update_data: schemas.UserProfileUpdate,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n profil bilgilerini (isim, biyo, mÃ¼zik vb.) gÃ¼nceller.\"\"\"\n    for key, value in update_data.model_dump(exclude_unset=True).items():\n        setattr(current_user, key, value)\n    \n    db.commit()\n    db.refresh(current_user)\n    return current_user\n\n@router.put(\"/preferences\", response_model=schemas.UserOut)\ndef update_preferences(\n    settings_data: schemas.UserSettingsUpdate,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Gizlilik (Hayalet Mod) ve Uygulama (Tema, Dil) tercihlerini gÃ¼nceller.\"\"\"\n    for key, value in settings_data.model_dump(exclude_unset=True).items():\n        setattr(current_user, key, value)\n    \n    db.commit()\n    db.refresh(current_user)\n    return current_user\n\n@router.get(\"/me\", response_model=schemas.UserOut)\ndef get_current_user_full(\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Mevcut kullanÄ±cÄ±nÄ±n tÃ¼m ayar ve profil verilerini getirir.\"\"\"\n    return current_user\n"
                },
                "social.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nfrom uuid import UUID\nfrom datetime import datetime, timedelta\nimport database, models, schemas, security\n\nrouter = APIRouter(prefix=\"/social\", tags=[\"Social & Friends\"])\n\n# --- Friendship Endpoints ---\n\n@router.post(\"/friends/request\", response_model=schemas.FriendshipOut)\ndef send_friend_request(\n    request: schemas.FriendshipRequest,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    if request.friend_id == current_user.id:\n        raise HTTPException(status_code=400, detail=\"Kendinize istek gÃ¶nderemezsiniz.\")\n        \n    exists = db.query(models.Friendship).filter(\n        models.Friendship.user_id == current_user.id,\n        models.Friendship.friend_id == request.friend_id\n    ).first()\n    \n    if exists:\n        raise HTTPException(status_code=400, detail=\"Zaten bir arkadaÅŸlÄ±k durumu mevcut.\")\n        \n    friendship = models.Friendship(\n        user_id=current_user.id,\n        friend_id=request.friend_id,\n        status=\"pending\"\n    )\n    db.add(friendship)\n    db.commit()\n    db.refresh(friendship)\n    return friendship\n\n@router.post(\"/friends/accept\")\ndef accept_friend_request(\n    friend_id: UUID,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    request = db.query(models.Friendship).filter(\n        models.Friendship.user_id == friend_id,\n        models.Friendship.friend_id == current_user.id,\n        models.Friendship.status == \"pending\"\n    ).first()\n    \n    if not request:\n        raise HTTPException(status_code=404, detail=\"Bekleyen istek bulunamadÄ±.\")\n        \n    request.status = \"accepted\"\n    \n    # KarÅŸÄ±t iliÅŸkiyi de ekle (Simetrik arkadaÅŸlÄ±k)\n    reverse_friendship = models.Friendship(\n        user_id=current_user.id,\n        friend_id=friend_id,\n        status=\"accepted\"\n    )\n    db.add(reverse_friendship)\n    db.commit()\n    return {\"status\": \"success\", \"message\": \"ArkadaÅŸlÄ±k isteÄŸi kabul edildi.\"}\n\n# --- Moments Endpoints ---\n\n@router.post(\"/moments\", response_model=schemas.MomentOut)\ndef create_moment(\n    moment: schemas.MomentCreate,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    # KatÄ±lÄ±mcÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol et\n    participation = db.query(models.EventParticipant).filter(\n        models.EventParticipant.event_id == moment.event_id,\n        models.EventParticipant.user_id == current_user.id\n    ).first()\n    \n    if not participation:\n        raise HTTPException(status_code=403, detail=\"Sadece katÄ±ldÄ±ÄŸÄ±nÄ±z etkinliklerde moment paylaÅŸabilirsiniz.\")\n        \n    db_moment = models.EventMoment(\n        **moment.model_dump(),\n        user_id=current_user.id,\n        expires_at=datetime.utcnow() + timedelta(hours=24)\n    )\n    db.add(db_moment)\n    db.commit()\n    db.refresh(db_moment)\n    return db_moment\n\n@router.get(\"/moments/feed\", response_model=List[schemas.MomentOut])\ndef get_moments_feed(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    # ArkadaÅŸlarÄ±n momentlerini getir\n    friend_ids = db.query(models.Friendship.friend_id).filter(\n        models.Friendship.user_id == current_user.id,\n        models.Friendship.status == \"accepted\"\n    ).all()\n    \n    ids = [fid[0] for fid in friend_ids]\n    # Kendi ID'sini de ekle\n    ids.append(current_user.id)\n    \n    active_moments = db.query(models.EventMoment).filter(\n        models.EventMoment.user_id.in_(ids),\n        models.EventMoment.expires_at > datetime.utcnow()\n    ).order_by(models.EventMoment.created_at.desc()).all()\n    \n    return active_moments\n"
                },
                "support.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nimport database, models, schemas, security\nfrom typing import List\n\nrouter = APIRouter(\n    prefix=\"/support\",\n    tags=[\"Support & Help\"]\n)\n\n@router.post(\"/tickets\", response_model=schemas.SupportTicketOut)\ndef create_ticket(\n    ticket_data: schemas.SupportTicketCreate,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Yeni bir destek talebi (Hata bildirimi, ÅŸikayet vb.) oluÅŸturur.\"\"\"\n    new_ticket = models.SupportTicket(\n        user_id=current_user.id,\n        subject=ticket_data.subject,\n        message=ticket_data.message\n    )\n    db.add(new_ticket)\n    db.commit()\n    db.refresh(new_ticket)\n    return new_ticket\n\n@router.get(\"/tickets\", response_model=List[schemas.SupportTicketOut])\ndef get_my_tickets(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ±nÄ±n geÃ§miÅŸ destek taleplerini listeler.\"\"\"\n    return db.query(models.SupportTicket).filter(models.SupportTicket.user_id == current_user.id).all()\n\n@router.get(\"/rules\")\ndef get_community_rules():\n    \"\"\"Topluluk ve disiplin kurallarÄ±nÄ± getirir.\"\"\"\n    return {\n        \"rules\": [\n            \"SaygÄ±lÄ± olun.\",\n            \"Etkinliklere katÄ±lÄ±m saÄŸlayÄ±n (No-Show yapmayÄ±n).\",\n            \"GÃ¼ven puanÄ±nÄ±zÄ± yÃ¼ksek tutun.\",\n            \"Sahte belge yÃ¼klemeyin.\"\n        ],\n        \"info\": \"Kurallara uymayan hesaplar geÃ§ici veya kalÄ±cÄ± olarak askÄ±ya alÄ±nabilir.\"\n    }\n"
                },
                "users.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException, status, UploadFile, File\nfrom sqlalchemy.orm import Session\nimport shutil\nimport os\nimport sys\nfrom uuid import UUID\nfrom pydantic import BaseModel, Field, field_validator\nfrom datetime import date\nfrom typing import Optional\n\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nimport database, schemas, crud, models, security\nfrom utils import nvi_verifier # NVÄ° DoÄŸrulama ModÃ¼lÃ¼\nfrom utils.nvi_verifier import verify_tckn\nfrom utils.edevlet_verifier import ogrenci_belgesi_barkod_kontrol\nfrom services import (\n    notification,\n    moderation,\n    image_processor # Eklendi: Resim iÅŸleme servisi\n)\n\nrouter = APIRouter(tags=[\"Users\"])\nget_db = database.get_db\nUPLOAD_DIR = \"uploads\"\n\n# --- 1. KAYIT OL (POST /users) ---\n@router.post(\"/users/\", response_model=schemas.UserOut)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    \"\"\"\n    Yeni KullanÄ±cÄ± OluÅŸturma (KayÄ±t Ol)\n    \"\"\"\n    # Ã–nce bÃ¶yle bir e-posta var mÄ± diye bak\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Bu e-posta zaten kayÄ±tlÄ±!\")\n    \n    # Yoksa kaydet\n    new_user = crud.create_user(db=db, user=user)\n    \n    # 3. Otomatik E-posta DoÄŸrulama Kodu GÃ¶nder (GerÃ§ek Ayarlar)\n    try:\n        otp = generate_otp()\n        new_user.email_verification_code = otp\n        db.commit()\n        \n        subject = \"ArtÄ±Bir'e HoÅŸ Geldin! ğŸš€\"\n        body = f\"Merhaba {new_user.full_name},\\n\\nHesabÄ±nÄ± doÄŸrulamak iÃ§in kodun: {otp}\\n\\nKeyifli etkinlikler dileriz!\"\n        html_body = f\"\"\"\n        <div style=\"font-family: sans-serif; border: 1px solid #eee; padding: 20px; border-radius: 10px; max-width: 500px;\">\n            <h2 style=\"color: #4A90E2;\">ArtÄ±Bir'e HoÅŸ Geldin! ğŸš€</h2>\n            <p>Merhaba <strong>{new_user.full_name}</strong>,</p>\n            <p>TopluluÄŸumuza katÄ±ldÄ±ÄŸÄ±n iÃ§in Ã§ok mutluyuz. HesabÄ±nÄ± doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki kodu kullanabilirsin:</p>\n            <div style=\"background: #f4f4f4; padding: 15px; text-align: center; font-size: 24px; font-weight: bold; letter-spacing: 5px; color: #333; border-radius: 5px;\">\n                {otp}\n            </div>\n            <p style=\"font-size: 12px; color: #888; margin-top: 20px;\">Bu kod 30 dakika sÃ¼reyle geÃ§erlidir. EÄŸer bu kaydÄ± sen yapmadÄ±ysan bu e-postayÄ± dikkate alma.</p>\n        </div>\n        \"\"\"\n        notification.send_email(new_user.email, subject, body, html_body=html_body)\n    except Exception as e:\n        print(f\"Otomatik OTP gÃ¶nderimi hatasÄ±: {e}\")\n\n    return new_user\n\n# --- 2. KULLANICILARI LÄ°STELE (GET /users) ---\nfrom typing import List\n@router.get(\"/users/\", response_model=List[schemas.UserPublic])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    \"\"\"\n    TÃ¼m kullanÄ±cÄ±larÄ± listele (KeÅŸfet EkranÄ± Ä°Ã§in)\n    \"\"\"\n    users = db.query(models.User).offset(skip).limit(limit).all()\n    return users\n\n@router.post(\"/users/upload-profile\")\ndef upload_profile_image(\n    file: UploadFile = File(...), \n    db: Session = Depends(get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    Profil Resmi YÃ¼kleme\n    \"\"\"\n    if not os.path.exists(UPLOAD_DIR):\n        os.makedirs(UPLOAD_DIR)\n        \n    # DÃœZELTME: Image Processor servisi kullanÄ±larak sÄ±kÄ±ÅŸtÄ±rma ve formatlama yapÄ±lÄ±yor\n    processed_image = image_processor.process_and_compress_image(file.file)\n    \n    if not processed_image:\n        raise HTTPException(status_code=400, detail=\"Resim iÅŸlenemedi veya format desteklenmiyor.\")\n\n    file_location = f\"{UPLOAD_DIR}/{processed_image['filename']}\"\n    \n    with open(file_location, \"wb+\") as f:\n        f.write(processed_image['file'].read())\n    \n    current_user.profile_image = f\"/{file_location}\"\n    db.commit()\n    \n    return {\"status\": \"success\", \"image_url\": current_user.profile_image}\n\n# --- 5. KÄ°MLÄ°K DOÄRULAMA (POST /users/verify/id-card) ---\n# GÃ¼venli Depolama AlanÄ± (Statik olarak sunulmaz)\nPRIVATE_DIR = \"private_storage/id_cards\"\n\n@router.post(\"/users/verify/id-card\")\ndef upload_id_card(\n    file: UploadFile = File(...), \n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    Kimlik KartÄ± YÃ¼kleme (GÃœVENLÄ° DEPOLAMA)\n    Dosyalar 'private_storage' altÄ±nda saklanÄ±r ve doÄŸrudan eriÅŸilemez.\n    \"\"\"\n    # Gizli klasÃ¶r yoksa oluÅŸtur\n    if not os.path.exists(PRIVATE_DIR):\n        os.makedirs(PRIVATE_DIR)\n        \n    # Dosya adÄ±nÄ± gÃ¼venli hale getir (User ID + Timestamp) -> Hashleme yapÄ±labilir ama ÅŸimdilik UUID yeterli\n    import time\n    file_ext = file.filename.split('.')[-1]\n    safe_filename = f\"{current_user.id}_{int(time.time())}.{file_ext}\"\n    file_location = f\"{PRIVATE_DIR}/{safe_filename}\"\n    \n    with open(file_location, \"wb+\") as file_object:\n        shutil.copyfileobj(file.file, file_object)\n    \n    # OCR SimÃ¼lasyonu: Bilgileri \"okunmuÅŸ\" sayÄ±yoruz\n    # DB'ye sadece fiziksel yolu kaydediyoruz, URL deÄŸil!\n    current_user.id_card_front_url = file_location\n    current_user.blue_tick_status = \"pending\" # Onay bekliyor\n    \n    # Otomatik NVÄ° DoÄŸrulama SimÃ¼lasyonu\n    db.commit()\n    \n    # Bir sistem bildirimi oluÅŸtur\n    new_notif = models.Notification(\n        user_id=current_user.id,\n        title=\"GÃœVENLÄ°K_PROTOKOLÃœ_AKTÄ°F\",\n        message=\"Kimlik verileriniz ÅŸifreli kasaya alÄ±ndÄ±. DoÄŸrulama sonrasÄ± imha edilecek.\",\n        type=\"system\"\n    )\n    db.add(new_notif)\n    db.commit()\n    \n    return {\"status\": \"success\", \"message\": \"Kimlik gÃ¼venli kasaya alÄ±ndÄ±.\"}\n\nclass IdentityVerificationRequest(BaseModel):\n    tc_no: str = Field(..., min_length=11, max_length=11, description=\"11 haneli TC Kimlik NumarasÄ±\")\n    full_name: Optional[str] = Field(None, min_length=5, description=\"Ad ve Soyad\")\n    birth_date: Optional[date] = None\n\n    @field_validator('tc_no')\n    @classmethod\n    def validate_tc_no(cls, v: str):\n        if not v.isdigit():\n            raise ValueError(\"TC Kimlik NumarasÄ± sadece rakamlardan oluÅŸmalÄ±dÄ±r.\")\n        \n        # TC Algoritma KontrolÃ¼\n        digits = [int(d) for d in v]\n        if digits[0] == 0:\n            raise ValueError(\"TC Kimlik No 0 ile baÅŸlayamaz.\")\n            \n        odd_sum = sum(digits[0:9:2])\n        even_sum = sum(digits[1:8:2])\n        digit_10 = ((odd_sum * 7) - even_sum) % 10\n        \n        total_10 = sum(digits[:10])\n        digit_11 = total_10 % 10\n        \n        if digits[9] != digit_10 or digits[10] != digit_11:\n             raise ValueError(\"GeÃ§ersiz TC Kimlik NumarasÄ± (Algoritma HatasÄ±).\")\n        return v\n\n    @field_validator('full_name')\n    @classmethod\n    def validate_full_name(cls, v: str):\n        if v:\n            parts = v.strip().split()\n            if len(parts) < 2:\n                raise ValueError(\"Ad ve soyad arasÄ±nda boÅŸluk olmalÄ± ve en az iki kelime iÃ§ermelidir.\")\n        return v\n\n@router.post(\"/users/verify/identity\")\ndef verify_identity(\n    update_data: IdentityVerificationRequest,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    NVÄ° Ãœzerinden GerÃ§ek Kimlik DoÄŸrulama\n    \"\"\"\n    # KullanÄ±cÄ± doÄŸum tarihini gÃ¼ncellemek istiyorsa\n    if update_data.birth_date:\n        current_user.birth_date = update_data.birth_date\n    \n    # Ä°sim ve DoÄŸum YÄ±lÄ± veritabanÄ±ndan alÄ±nÄ±r (KullanÄ±cÄ± kayÄ±t olurken verdiÄŸi)\n    # Ancak kullanÄ±cÄ± ismini yanlÄ±ÅŸ girmiÅŸse dÃ¼zeltmesine izin vermek gerekir mi?\n    # Åimdilik sadece UserProfileUpdate ile gelen veriyi deÄŸil, mevcut user verisini kullanalÄ±m.\n    # Veya update_data iÃ§inde full_name de geliyorsa onu baz alalÄ±m.\n    \n    name_check = update_data.full_name if update_data.full_name else current_user.full_name\n    \n    # Ad Soyad ayÄ±rma\n    parts = name_check.strip().split()\n    if len(parts) < 2:\n        raise HTTPException(status_code=400, detail=\"Ad ve soyad tam girilmelidir.\")\n        \n    soyad = parts[-1]\n    ad = \" \".join(parts[:-1])\n    dogum_yili = current_user.birth_date.year\n    \n    # NVÄ° Sorgusu\n    is_real, message = verify_tckn(\n        tc_no=int(update_data.tc_no), \n        ad=ad, \n        soyad=soyad, \n        dogum_yili=dogum_yili\n    )\n    \n    if is_real:\n        current_user.tc_no = update_data.tc_no # TC'yi kaydet\n        current_user.is_verified = True\n        current_user.blue_tick_status = \"approved\"\n        # Trust Score ArtÄ±ÅŸÄ±\n        current_user.trust_score += 20\n        \n        # EÄŸer isim gÃ¼ncellendiyse onu da kaydet\n        if update_data.full_name:\n            current_user.full_name = update_data.full_name\n            \n        db.commit()\n        return {\"status\": \"success\", \"message\": message, \"trust_score\": current_user.trust_score}\n    else:\n        raise HTTPException(status_code=400, detail=f\"Kimlik doÄŸrulama baÅŸarÄ±sÄ±z: {message}\")\n\n@router.post(\"/users/verify/student-document\")\ndef verify_student_document(\n    request: schemas.StudentVerifyRequest,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    E-Devlet Ã–ÄŸrenci Belgesi Barkod KontrolÃ¼\n    \"\"\"\n    if current_user.is_student_verified:\n        return {\"status\": \"info\", \"message\": \"Ã–ÄŸrenci belgeniz zaten doÄŸrulanmÄ±ÅŸ.\"}\n        \n    full_name_to_check = request.full_name if request.full_name else current_user.full_name\n    \n    is_valid, message = ogrenci_belgesi_barkod_kontrol(request.barcode, full_name_to_check)\n    \n    if is_valid:\n        current_user.student_document_barcode = request.barcode\n        current_user.is_student_verified = True\n        current_user.trust_score += 30 # YÃ¼ksek gÃ¼ven puanÄ±\n        db.commit()\n        return {\"status\": \"success\", \"message\": message, \"trust_score\": current_user.trust_score}\n    else:\n        raise HTTPException(status_code=400, detail=f\"DoÄŸrulama BaÅŸarÄ±sÄ±z: {message}\")\n\n\n\n# --- 5.6 E-POSTA VE TELEFON DOÄRULAMA (OTP) ---\nimport random\n\ndef generate_otp():\n    return str(random.randint(100000, 999999))\n\nclass OTPRequest(schemas.BaseModel):\n    code: str\n\n@router.post(\"/verify/send-email-otp\")\ndef send_email_otp(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    E-posta doÄŸrulama kodu gÃ¶nderir (SMTP ile gerÃ§ek gÃ¶nderim)\n    \"\"\"\n    if current_user.is_email_verified:\n        return {\"status\": \"info\", \"message\": \"E-posta zaten doÄŸrulanmÄ±ÅŸ.\"}\n    \n    otp = generate_otp()\n    current_user.email_verification_code = otp\n    db.commit()\n    \n    # 1. Ã–nce Loglara yaz (Her durumda debug iÃ§in iyidir)\n    print(f\"--- EMAIL OTP (DEBUG) --- User: {current_user.email} | OTP: {otp}\")\n    \n    # 2. GerÃ§ek GÃ¶nderim\n    subject = \"Artibir E-posta DoÄŸrulama Kodu\"\n    body = f\"Merhaba {current_user.full_name},\\n\\nArtibir doÄŸrulama kodunuz: {otp}\\n\\nBu kodu kimseyle paylaÅŸmayÄ±n.\"\n    \n    email_sent = notification.send_email(\n        current_user.email, \n        subject, \n        body, \n        html_body=f\"<div style='font-family:sans-serif;'><h3>DoÄŸrulama Kodunuz</h3><p style='font-size:24px; color:#4A90E2;'><b>{otp}</b></p></div>\"\n    )\n    \n    if email_sent:\n        return {\"status\": \"success\", \"message\": \"DoÄŸrulama kodu e-posta adresinize gÃ¶nderildi.\"}\n    else:\n        # SMTP ayarlarÄ± yapÄ±lmamÄ±ÅŸsa simÃ¼lasyona devam etmesi kullanÄ±cÄ± deneyimi iÃ§in (geliÅŸtirme aÅŸamasÄ±nda) iyidir.\n        return {\"status\": \"warning\", \"message\": \"E-posta servisi ayarlanmamÄ±ÅŸ, kod konsola yazÄ±ldÄ± (GeliÅŸtirici Modu).\"}\n\n@router.post(\"/verify/email\")\ndef verify_email(\n    request: OTPRequest,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    E-posta doÄŸrulama kodunu kontrol eder\n    \"\"\"\n    if current_user.is_email_verified:\n        return {\"status\": \"info\", \"message\": \"E-posta zaten doÄŸrulanmÄ±ÅŸ.\"}\n        \n    if not current_user.email_verification_code:\n        raise HTTPException(status_code=400, detail=\"Ã–nce kod talep etmelisiniz.\")\n        \n    if current_user.email_verification_code == request.code:\n        current_user.is_email_verified = True\n        current_user.email_verification_code = None # Kodu temizle\n        current_user.trust_score += 10\n        db.commit()\n        return {\"status\": \"success\", \"message\": \"E-posta baÅŸarÄ±yla doÄŸrulandÄ±.\", \"trust_score\": current_user.trust_score}\n    else:\n        raise HTTPException(status_code=400, detail=\"HatalÄ± kod!\")\n\n@router.post(\"/verify/send-phone-otp\")\ndef send_phone_otp(\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    Telefon doÄŸrulama kodu gÃ¶nderir (SMS API ile gerÃ§ek gÃ¶nderim)\n    \"\"\"\n    if current_user.is_phone_verified:\n        return {\"status\": \"info\", \"message\": \"Telefon zaten doÄŸrulanmÄ±ÅŸ.\"}\n        \n    if not current_user.phone_number:\n         raise HTTPException(status_code=400, detail=\"Profilinizde telefon numarasÄ± kayÄ±tlÄ± deÄŸil.\")\n    \n    otp = generate_otp()\n    current_user.phone_verification_code = otp\n    db.commit()\n    \n    # 1. Log (Debug)\n    print(f\"--- PHONE OTP (DEBUG) --- User: {current_user.phone_number} | OTP: {otp}\")\n    \n    # 2. GerÃ§ek GÃ¶nderim\n    sms_message = f\"Artibir dogrulama kodunuz: {otp}\"\n    sms_sent = notification.send_sms(current_user.phone_number, sms_message)\n    \n    if sms_sent:\n        return {\"status\": \"success\", \"message\": \"DoÄŸrulama kodu telefonunuza gÃ¶nderildi.\"}\n    else:\n        return {\"status\": \"warning\", \"message\": \"SMS servisi ayarlanmamÄ±ÅŸ veya baÅŸarÄ±sÄ±z, kod konsola yazÄ±ldÄ± (GeliÅŸtirici Modu).\"}\n\n@router.post(\"/verify/phone\")\ndef verify_phone(\n    request: OTPRequest,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    Telefon doÄŸrulama kodunu kontrol eder\n    \"\"\"\n    if current_user.is_phone_verified:\n        return {\"status\": \"info\", \"message\": \"Telefon zaten doÄŸrulanmÄ±ÅŸ.\"}\n        \n    if not current_user.phone_verification_code:\n        raise HTTPException(status_code=400, detail=\"Ã–nce kod talep etmelisiniz.\")\n        \n    if current_user.phone_verification_code == request.code:\n        current_user.is_phone_verified = True\n        current_user.phone_verification_code = None # Kodu temizle\n        current_user.trust_score += 15\n        db.commit()\n        return {\"status\": \"success\", \"message\": \"Telefon baÅŸarÄ±yla doÄŸrulandÄ±.\", \"trust_score\": current_user.trust_score}\n    else:\n        raise HTTPException(status_code=400, detail=\"HatalÄ± kod!\")\n\n    return {\"status\": \"success\", \"message\": \"Tebrikler! KimliÄŸiniz baÅŸarÄ±yla doÄŸrulandÄ±.\"}\n\n# --- 8. PROFÄ°L YÃ–NETÄ°MÄ° VE AYARLAR ---\n\n@router.get(\"/me\", response_model=schemas.UserOut)\ndef get_current_user_profile(current_user: models.User = Depends(security.get_current_user)):\n    \"\"\"Aktif kullanÄ±cÄ±nÄ±n tÃ¼m profil bilgilerini dÃ¶ner.\"\"\"\n    return current_user\n\n@router.patch(\"/update-profile\", response_model=schemas.UserOut)\ndef update_profile(\n    data: schemas.UserProfileUpdate,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"KullanÄ±cÄ± profil bilgilerini (Bio, Ä°sim vb.) gÃ¼nceller.\"\"\"\n    if data.full_name:\n        current_user.full_name = data.full_name\n    \n    if data.bio:\n        # GÃœVENLÄ°K BOTU KONTROLÃœ\n        is_safe, reason = moderation.check_message(data.bio, current_user.trust_score)\n        if not is_safe:\n            raise HTTPException(status_code=status.HTTP_400_BAD_REQUEST, detail=reason)\n        current_user.bio = data.bio\n    \n    if data.favorite_music_url:\n        current_user.favorite_music_url = data.favorite_music_url\n    \n    db.commit()\n    db.refresh(current_user)\n    return current_user\n\n@router.patch(\"/update-settings\", response_model=schemas.UserOut)\ndef update_settings(\n    settings: schemas.UserSettingsUpdate,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Uygulama tercihlerini (Tema, Gizlilik, Bildirimler) gÃ¼nceller.\"\"\"\n    update_data = settings.model_dump(exclude_unset=True)\n    for key, value in update_data.items():\n        setattr(current_user, key, value)\n    \n    db.commit()\n    db.refresh(current_user)\n    return current_user\n\n@router.post(\"/change-password\")\ndef change_password(\n    data: schemas.PasswordChange,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Aktif oturumda ÅŸifre deÄŸiÅŸtirme iÅŸlemi.\"\"\"\n    if not security.verify_password(data.old_password, current_user.password):\n        raise HTTPException(status_code=400, detail=\"Mevcut ÅŸifreniz hatalÄ±!\")\n    \n    current_user.password = security.get_password_hash(data.new_password)\n    db.commit()\n    return {\"status\": \"success\", \"message\": \"Åifreniz baÅŸarÄ±yla deÄŸiÅŸtirildi.\"}\n\n@router.post(\"/support-ticket\", response_model=schemas.SupportTicketOut)\ndef create_support_ticket(\n    ticket: schemas.SupportTicketCreate,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"Destek talebi oluÅŸturur.\"\"\"\n    db_ticket = models.SupportTicket(\n        user_id=current_user.id,\n        subject=ticket.subject,\n        message=ticket.message\n    )\n    db.add(db_ticket)\n    db.commit()\n    db.refresh(db_ticket)\n    \n    # YÃ¶netime bildirim simÃ¼lasyonu\n    print(f\"NEW SUPPORT TICKET: {current_user.email} - {ticket.subject}\")\n    \n    return db_ticket\n"
                },
                "venues.py": {
                    "type": "text",
                    "content": "from fastapi import APIRouter, Depends, HTTPException\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport sys\nimport os\n\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nimport database, schemas, crud, models, security\n\nrouter = APIRouter(tags=[\"Venues\"])\nget_db = database.get_db\n\n@router.get(\"/venues\", response_model=List[schemas.CampusVenueOut])\ndef list_venues(\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    KampÃ¼s Ã§evresindeki indirimli mekanlarÄ± listeler.\n    \"\"\"\n    return db.query(models.CampusVenue).filter(models.CampusVenue.is_active == True).all()\n\n@router.post(\"/venues\", response_model=schemas.CampusVenueOut)\ndef create_venue(\n    venue: schemas.CampusVenueOut, # Basitlik iÃ§in Out ÅŸemasÄ±nÄ± Create gibi kullanÄ±yoruz (id hariÃ§)\n    # current_user: models.User = Depends(security.get_admin_user), # Admin yetkisi lazÄ±m normalde\n    db: Session = Depends(get_db)\n):\n    \"\"\"\n    Yeni bir indirimli mekan ekler (Admin yetkisi gerektirir).\n    \"\"\"\n    db_venue = models.CampusVenue(\n        name=venue.name,\n        latitude=venue.latitude,\n        longitude=venue.longitude,\n        address=venue.address,\n        discount_rate=venue.discount_rate,\n        category=venue.category\n    )\n    db.add(db_venue)\n    db.commit()\n    db.refresh(db_venue)\n    return db_venue\n"
                },
                "wallet.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n# Parent directory'i path'e ekliyoruz ki importlar Ã§alÄ±ÅŸsÄ±n\nsys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom typing import List\nimport database, models, schemas, security\nfrom uuid import UUID\n\nrouter = APIRouter(\n    prefix=\"/wallet\",\n    tags=[\"Wallet & Payments\"]\n)\n\n@router.get(\"/balance\", response_model=dict)\ndef get_balance(current_user: models.User = Depends(security.get_current_user)):\n    \"\"\"Mevcut cÃ¼zdan bakiyesini getirir.\"\"\"\n    return {\"wallet_balance\": current_user.wallet_balance}\n\n@router.post(\"/top-up\", response_model=dict)\ndef top_up_wallet(\n    amount: float, \n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"\n    CÃ¼zdana bakiye yÃ¼kler (SADECE DEBUG/TEST MODUNDA Ã‡ALIÅIR).\n    Production ortamÄ±nda Iyzico callback'leri kullanÄ±lmalÄ±dÄ±r.\n    \"\"\"\n    # GÃ¼venlik KontrolÃ¼: CanlÄ± ortamda bu endpoint kapatÄ±lmalÄ±\n    if os.getenv(\"APP_ENV\", \"development\") == \"production\":\n        raise HTTPException(status_code=403, detail=\"Bu iÅŸlem canlÄ± ortamda devre dÄ±ÅŸÄ±dÄ±r. Ã–deme sayfasÄ±nÄ± kullanÄ±n.\")\n\n    if amount <= 0:\n        raise HTTPException(status_code=400, detail=\"Miktar 0'dan bÃ¼yÃ¼k olmalÄ±dÄ±r.\")\n    \n    current_user.wallet_balance += amount\n    db.commit()\n    db.refresh(current_user)\n    \n    return {\n        \"message\": f\"{amount} TL baÅŸarÄ±yla yÃ¼klendi.\",\n        \"new_balance\": current_user.wallet_balance\n    }\n\n@router.post(\"/withdraw\", response_model=dict)\ndef withdraw_money(\n    amount: float,\n    db: Session = Depends(database.get_db),\n    current_user: models.User = Depends(security.get_current_user)\n):\n    \"\"\"CÃ¼zdandan para Ã§eker.\"\"\"\n    if amount <= 0:\n        raise HTTPException(status_code=400, detail=\"Miktar 0'dan bÃ¼yÃ¼k olmalÄ±dÄ±r.\")\n    \n    if current_user.wallet_balance < amount:\n        raise HTTPException(status_code=400, detail=\"Yetersiz bakiye.\")\n    \n    current_user.wallet_balance -= amount\n    db.commit()\n    db.refresh(current_user)\n    \n    return {\n        \"message\": f\"{amount} TL Ã§ekildi.\",\n        \"new_balance\": current_user.wallet_balance\n    }\n"
                }
            }
        },
        "scripts": {
            "directories": [],
            "files": {
                "generate_backend_snapshot.py": {
                    "type": "text",
                    "content": "import os\nimport json\nimport sqlite3\nfrom datetime import datetime\nimport sys\n\n# Ensure project root is in path\nsys.path.append(os.getcwd())\n\ndef get_project_structure(startpath):\n    \"\"\"Proje dosya yapÄ±sÄ±nÄ± JSON formatÄ±na uygun ÅŸekilde tarar.\"\"\"\n    structure = {}\n    for root, dirs, files in os.walk(startpath):\n        # Gizli klasÃ¶rleri ve venv'i geÃ§\n        dirs[:] = [d for d in dirs if not d.startswith('.') and d != 'venv' and d != '__pycache__']\n        \n        path = root.replace(startpath, '').lstrip(os.sep)\n        parts = path.split(os.sep) if path else []\n        \n        current = structure\n        for part in parts:\n            if part not in current:\n                current[part] = {}\n            current = current[part]\n        \n        for f in files:\n            if not f.startswith('.'):\n                current[f] = \"file\"\n    return structure\n\ndef get_database_data(db_path):\n    \"\"\"SQLite veritabanÄ±ndaki tÃ¼m verileri export eder.\"\"\"\n    if not os.path.exists(db_path):\n        return {\"error\": \"Database file not found\"}\n    \n    conn = sqlite3.connect(db_path)\n    # SatÄ±rlarÄ± dict olarak almak iÃ§in row_factory ayarla\n    conn.row_factory = sqlite3.Row\n    cursor = conn.cursor()\n    \n    # TÃ¼m tablolarÄ± al\n    cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table';\")\n    tables = [row[0] for row in cursor.fetchall() if not row[0].startswith('sqlite_')]\n    \n    db_data = {}\n    for table in tables:\n        cursor.execute(f\"SELECT * FROM {table}\")\n        rows = cursor.fetchall()\n        db_data[table] = [dict(row) for row in rows]\n    \n    conn.close()\n    return db_data\n\ndef get_api_routes():\n    \"\"\"FastAPI rotalarÄ±nÄ± basit bir liste olarak dÃ¶ner.\"\"\"\n    try:\n        from main import app\n        routes = []\n        for route in app.routes:\n            if hasattr(route, 'path'):\n                routes.append({\n                    \"path\": route.path,\n                    \"name\": route.name,\n                    \"methods\": list(route.methods) if hasattr(route, 'methods') else []\n                })\n        return routes\n    except Exception as e:\n        return {\"error\": str(e)}\n\ndef generate_snapshot():\n    print(\"Generating backend snapshot...\")\n    \n    snapshot = {\n        \"generated_at\": datetime.now().isoformat(),\n        \"project_name\": \"ArtÄ±Bir Backend V2\",\n        \"structure\": get_project_structure(os.getcwd()),\n        \"api_endpoints\": get_api_routes(),\n        \"database_content\": get_database_data(\"artibir.db\")\n    }\n    \n    output_path = os.path.join(\"data\", \"backend_snapshot.json\")\n    os.makedirs(\"data\", exist_ok=True)\n    \n    with open(output_path, \"w\", encoding=\"utf-8\") as f:\n        json.dump(snapshot, f, ensure_ascii=False, indent=4)\n    \n    print(f\"Snapshot created successfully: {output_path}\")\n    return output_path\n\nif __name__ == \"__main__\":\n    generate_snapshot()\n"
                },
                "generate_master_snapshot.py": {
                    "type": "text",
                    "content": "import os\nimport json\nimport sqlite3\nimport base64\nfrom datetime import datetime\nimport sys\n\n# Ensure project root is in path\nsys.path.append(os.getcwd())\n\ndef get_file_content(filepath):\n    \"\"\"Dosya iÃ§eriÄŸini metin veya base64 (binary ise) olarak dÃ¶ner.\"\"\"\n    try:\n        # Ã–nce metin olarak okumayÄ± dene\n        with open(filepath, 'r', encoding='utf-8') as f:\n            return {\n                \"type\": \"text\",\n                \"content\": f.read()\n            }\n    except UnicodeDecodeError:\n        # Binary ise base64'e Ã§evir\n        try:\n            with open(filepath, 'rb') as f:\n                return {\n                    \"type\": \"binary\",\n                    \"content\": base64.b64encode(f.read()).decode('utf-8')\n                }\n        except Exception as e:\n            return {\"error\": str(e)}\n    except Exception as e:\n        return {\"error\": str(e)}\n\ndef get_complete_project_data(startpath):\n    \"\"\"TÃ¼m proje yapÄ±sÄ±nÄ± ve dosya iÃ§eriklerini JSON formatÄ±nda toplar.\"\"\"\n    data = {}\n    for root, dirs, files in os.walk(startpath):\n        # Gizli klasÃ¶rleri ve venv'i geÃ§\n        dirs[:] = [d for d in dirs if not d.startswith('.') and d != 'venv' and d != '__pycache__']\n        \n        path = os.path.relpath(root, startpath)\n        if path == \".\":\n            path = \"root\"\n        \n        # Windows pathlerini normalize et\n        path = path.replace(os.sep, '/')\n        \n        data[path] = {\n            \"directories\": dirs,\n            \"files\": {}\n        }\n        \n        for f in files:\n            if not f.startswith('.'):\n                filepath = os.path.join(root, f)\n                # Kendi snapshot dosyalarÄ±nÄ± ve veritabanÄ±nÄ± iÃ§eriye metin olarak alma (Ã§ok bÃ¼yÃ¼k olabilir)\n                if f in ['master_backend_snapshot.json', 'backend_snapshot.json', 'artibir.db']:\n                    data[path][\"files\"][f] = {\"type\": \"reference\", \"note\": \"Large file, skipped content\"}\n                else:\n                    data[path][\"files\"][f] = get_file_content(filepath)\n                    \n    return data\n\ndef get_database_full_data(db_path):\n    \"\"\"SQLite veritabanÄ±ndaki tÃ¼m tablolarÄ± ve verileri detaylÄ±ca alur.\"\"\"\n    if not os.path.exists(db_path):\n        return {\"error\": \"Database file not found\"}\n    \n    conn = sqlite3.connect(db_path)\n    conn.row_factory = sqlite3.Row\n    cursor = conn.cursor()\n    \n    cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table';\")\n    tables = [row[0] for row in cursor.fetchall() if not row[0].startswith('sqlite_')]\n    \n    db_data = {}\n    for table in tables:\n        # Tablo ÅŸemasÄ±nÄ± al\n        cursor.execute(f\"PRAGMA table_info({table})\")\n        schema = [dict(row) for row in cursor.fetchall()]\n        \n        # Verileri al\n        cursor.execute(f\"SELECT * FROM {table}\")\n        rows = cursor.fetchall()\n        \n        db_data[table] = {\n            \"schema\": schema,\n            \"row_count\": len(rows),\n            \"data\": [dict(row) for row in rows]\n        }\n    \n    conn.close()\n    return db_data\n\ndef get_detailed_routes():\n    \"\"\"FastAPI rotalarÄ±nÄ± detaylÄ± bir ÅŸekilde dÃ¶ner.\"\"\"\n    try:\n        from main import app\n        routes = []\n        for route in app.routes:\n            if hasattr(route, 'path'):\n                route_info = {\n                    \"path\": route.path,\n                    \"name\": route.name,\n                    \"methods\": list(route.methods) if hasattr(route, 'methods') else [],\n                }\n                # Varsa docstring veya detaylar\n                if hasattr(route, 'endpoint') and route.endpoint.__doc__:\n                    route_info[\"description\"] = route.endpoint.__doc__.strip()\n                \n                routes.append(route_info)\n        return routes\n    except Exception as e:\n        return {\"error\": str(e)}\n\ndef generate_master_snapshot():\n    print(\"Generating MASTER backend snapshot (including source code)...\")\n    \n    start_time = datetime.now()\n    \n    master_snapshot = {\n        \"metadata\": {\n            \"generated_at\": start_time.isoformat(),\n            \"project_name\": \"ArtÄ±Bir Backend V2\",\n            \"info\": \"This is a comprehensive master snapshot including code content, database, and structure.\"\n        },\n        \"source_code\": get_complete_project_data(os.getcwd()),\n        \"database\": get_database_full_data(\"artibir.db\"),\n        \"api_documentation\": get_detailed_routes()\n    }\n    \n    output_path = os.path.join(\"data\", \"master_backend_snapshot.json\")\n    os.makedirs(\"data\", exist_ok=True)\n    \n    with open(output_path, \"w\", encoding=\"utf-8\") as f:\n        json.dump(master_snapshot, f, ensure_ascii=False, indent=4)\n    \n    end_time = datetime.now()\n    duration = (end_time - start_time).total_seconds()\n    \n    print(f\"MASTER Snapshot created successfully in {duration:.2f} seconds: {output_path}\")\n    return output_path\n\nif __name__ == \"__main__\":\n    generate_master_snapshot()\n"
                },
                "generate_matrix_report.py": {
                    "type": "text",
                    "content": "import os\nimport json\nimport sqlite3\nfrom datetime import datetime\n\ndef get_matrix_database(db_path):\n    \"\"\"VeritabanÄ± verilerini 'satÄ±r-sÃ¼tun' matrisi ÅŸeklinde dÃ¶ner.\"\"\"\n    if not os.path.exists(db_path):\n        return {}\n    \n    conn = sqlite3.connect(db_path)\n    cursor = conn.cursor()\n    \n    cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table';\")\n    tables = [row[0] for row in cursor.fetchall() if not row[0].startswith('sqlite_')]\n    \n    matrix_db = {}\n    for table in tables:\n        # SÃ¼tun isimlerini al\n        cursor.execute(f\"PRAGMA table_info({table})\")\n        columns = [col[1] for col in cursor.fetchall()]\n        \n        # Verileri al\n        cursor.execute(f\"SELECT * FROM {table}\")\n        rows = cursor.fetchall()\n        \n        # Matris yapÄ±sÄ±: [ [header], [row1], [row2], ... ]\n        matrix_db[table] = {\n            \"headers\": columns,\n            \"rows\": [list(row) for row in rows],\n            \"shape\": f\"{len(rows)}x{len(columns)}\"\n        }\n    \n    conn.close()\n    return matrix_db\n\ndef generate_matrix_report():\n    print(\"Generating Matrix (Square) JSON report...\")\n    \n    report = {\n        \"metadata\": {\n            \"type\": \"Matrix/Grid Report\",\n            \"generated_at\": datetime.now().isoformat(),\n            \"description\": \"Compact representation of data in matrix (row/column) format.\"\n        },\n        \"database_matrix\": get_matrix_database(\"artibir.db\"),\n        \"api_summary\": \"More details in master_snapshot.json\"\n    }\n    \n    output_path = os.path.join(\"data\", \"backend_matrix_report.json\")\n    os.makedirs(\"data\", exist_ok=True)\n    \n    with open(output_path, \"w\", encoding=\"utf-8\") as f:\n        # separators=(',', ':') kullanarak daha sÄ±kÄ±ÅŸÄ±k (inline) bir gÃ¶rÃ¼nÃ¼m saÄŸlanabilir ama \n        # kullanÄ±cÄ± 'dÃ¼zgÃ¼n' dediÄŸi iÃ§in indent=2 ile devam ediyoruz.\n        json.dump(report, f, ensure_ascii=False, indent=2)\n    \n    print(f\"Matrix report created: {output_path}\")\n    return output_path\n\nif __name__ == \"__main__\":\n    generate_matrix_report()\n"
                },
                "generate_project_paths.py": {
                    "type": "text",
                    "content": "import os\nimport json\nfrom datetime import datetime\n\ndef generate_project_paths():\n    print(\"Generating project paths JSON...\")\n    \n    startpath = os.getcwd()\n    paths_list = []\n    \n    for root, dirs, files in os.walk(startpath):\n        # Gizli klasÃ¶rleri ve venv'i geÃ§\n        dirs[:] = [d for d in dirs if not d.startswith('.') and d != 'venv' and d != '__pycache__']\n        \n        # KlasÃ¶r yolunu ekle (relatif)\n        rel_root = os.path.relpath(root, startpath)\n        if rel_root != \".\":\n            paths_list.append(rel_root.replace(os.sep, '/'))\n            \n        # Dosya yollarÄ±nÄ± ekle\n        for f in files:\n            if not f.startswith('.'):\n                rel_file = os.path.relpath(os.path.join(root, f), startpath)\n                paths_list.append(rel_file.replace(os.sep, '/'))\n    \n    # SÄ±rala\n    paths_list.sort()\n    \n    output_data = {\n        \"generated_at\": datetime.now().isoformat(),\n        \"total_items\": len(paths_list),\n        \"paths\": paths_list\n    }\n    \n    output_path = os.path.join(\"data\", \"project_paths.json\")\n    os.makedirs(\"data\", exist_ok=True)\n    \n    with open(output_path, \"w\", encoding=\"utf-8\") as f:\n        json.dump(output_data, f, ensure_ascii=False, indent=4)\n    \n    print(f\"Project paths JSON created successfully: {output_path}\")\n    return output_path\n\nif __name__ == \"__main__\":\n    generate_project_paths()\n"
                }
            }
        },
        "services": {
            "directories": [],
            "files": {
                "ai_engine.py": {
                    "type": "text",
                    "content": "from sqlalchemy.orm import Session\nfrom typing import List\nimport models\nfrom datetime import datetime\n\nclass AIEngine:\n    @staticmethod\n    def recommend_events(db: Session, user_id, limit: int = 5) -> List[models.Event]:\n        \"\"\"\n        KullanÄ±cÄ± iÃ§in AI tabanlÄ± etkinlik Ã¶nerileri sunar.\n        Åimdilik 'PopÃ¼lerlik' ve 'YakÄ±nlÄ±k' bazlÄ± bir hibrit yaklaÅŸÄ±m kullanÄ±r.\n        \"\"\"\n        # 1. KullanÄ±cÄ±nÄ±n ÅŸehri ve kampÃ¼sÃ¼ne gÃ¶re filtreleme\n        user = db.query(models.User).filter(models.User.id == user_id).first()\n        \n        query = db.query(models.Event).filter(models.Event.status == models.EventStatus.AKTIF)\n        \n        if user and user.city:\n            query = query.filter(models.Event.city == user.city)\n            \n        # 2. KatÄ±lÄ±mcÄ± sayÄ±sÄ±na gÃ¶re popÃ¼lerliÄŸi artÄ±r (Placeholder mantÄ±k)\n        # GerÃ§ek AI modelinde buraya vektÃ¶r benzerliÄŸi gelecek.\n        \n        events = query.order_by(models.Event.date.asc()).limit(limit).all()\n        return events\n\n    @staticmethod\n    def content_moderation(text: str) -> bool:\n        \"\"\"\n        Ä°Ã§erik moderasyonu yapar.\n        True dÃ¶nerse iÃ§erik gÃ¼venli, False dÃ¶nerse riskli.\n        \"\"\"\n        banned_words = [\"kÃ¼fÃ¼r1\", \"argo1\", \"ÅŸiddet\", \"hakaret\"] # Basit placeholder liste\n        \n        if not text:\n            return True\n            \n        text_lower = text.lower()\n        for word in banned_words:\n            if word in text_lower:\n                return False\n        return True\n"
                },
                "encryption.py": {
                    "type": "text",
                    "content": "from cryptography.fernet import Fernet\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n# Åifreleme anahtarÄ± .env'den gelir veya yoksa oluÅŸturulur.\n# GerÃ§ek production ortamÄ±nda bu key SAKLANMALIDIR! Kaybolursa veriler Ã‡Ã–ZÃœLEMEZ.\nKEY = os.getenv(\"ENCRYPTION_KEY\")\n\nif not KEY:\n    # Key yoksa geÃ§ici bir key oluÅŸturuyoruz (Demo amaÃ§lÄ±).\n    # Normalde bu key .env dosyasÄ±na yazÄ±lmalÄ±dÄ±r.\n    KEY = Fernet.generate_key()\n    # print(f\"UYARI: Åifreleme anahtarÄ± (ENCRYPTION_KEY) .env iÃ§inde bulunamadÄ±. GeÃ§ici key: {KEY.decode()}\")\n\ncipher_suite = Fernet(KEY)\n\ndef encrypt_message(message: str) -> str:\n    \"\"\"MesajÄ± ÅŸifreler ve string olarak dÃ¶ner.\"\"\"\n    return cipher_suite.encrypt(message.encode()).decode()\n\ndef decrypt_message(encrypted_message: str) -> str:\n    \"\"\"Åifreli mesajÄ± Ã§Ã¶zer ve string olarak dÃ¶ner.\"\"\"\n    try:\n        return cipher_suite.decrypt(encrypted_message.encode()).decode()\n    except Exception:\n        return \"[Åifre Ã‡Ã¶zÃ¼lemedi]\"\n"
                },
                "event_provider.py": {
                    "type": "text",
                    "content": "import random\nfrom datetime import datetime, timedelta\nimport schemas\n\n# Mock Data Havuzu\nCATEGORIES = [\"Futbol\", \"Konser\", \"Tiyatro\", \"Stand-up\", \"Festival\"]\n\nCITIES = [\"Ä°stanbul\", \"Ankara\", \"Ä°zmir\", \"EskiÅŸehir\", \"Antalya\"]\n\n# Coordinates for cities (Approx lat, lon)\nCITY_COORDS = {\n    \"Ä°stanbul\": (41.0082, 28.9784),\n    \"Ankara\": (39.9334, 32.8597),\n    \"Ä°zmir\": (38.4192, 27.1287),\n    \"EskiÅŸehir\": (39.7667, 30.5256),\n    \"Antalya\": (36.8969, 30.7133)\n}\n\nTITLES = {\n    \"Futbol\": [\"Derbi MaÃ§Ä±: FB vs GS\", \"Åampiyonluk MaÃ§Ä±\", \"Kupa Finali\", \"Milli MaÃ§\"],\n    \"Konser\": [\"Yaz Festivali\", \"Rock Gecesi\", \"Pop MÃ¼zik ÅÃ¶leni\", \"Jazz Geceleri\", \"Rap Battle\"],\n    \"Tiyatro\": [\"Hamlet Oyunu\", \"KibarlÄ±k BudalasÄ±\", \"Bir Delinin HatÄ±ra Defteri\", \"Zengin MutfaÄŸÄ±\"],\n    \"Stand-up\": [\"GÃ¼lmeye Geldik\", \"Tek KiÅŸilik Dev Kadro\", \"AÃ§Ä±k Mikrofon\"],\n    \"Festival\": [\"GenÃ§lik Festivali\", \"Bahar ÅenliÄŸi\", \"Kahve Festivali\"]\n}\n\nIMAGES = {\n    \"Futbol\": \"https://images.unsplash.com/photo-1579952363873-27f3bade9f55?q=80&w=1000&auto=format&fit=crop\",\n    \"Konser\": \"https://images.unsplash.com/photo-1459749411177-27532f83e679?q=80&w=1000&auto=format&fit=crop\",\n    \"Tiyatro\": \"https://images.unsplash.com/photo-1503095392269-41a971d24265?q=80&w=1000&auto=format&fit=crop\",\n    \"Stand-up\": \"https://images.unsplash.com/photo-1585699324551-f6c309eedeca?q=80&w=1000&auto=format&fit=crop\",\n    \"Festival\": \"https://images.unsplash.com/photo-1533174072545-e8d4aa97edf9?q=80&w=1000&auto=format&fit=crop\"\n}\n\ndef generate_mock_events(count: int = 5):\n    \"\"\"\n    Belirtilen sayÄ±da rastgele etkinlik Ã¼retir.\n    Bu fonksiyon gerÃ§ek bir API isteÄŸini simÃ¼le eder.\n    \"\"\"\n    mock_events = []\n    \n    for _ in range(count):\n        city = random.choice(CITIES)\n        category = random.choice(CATEGORIES)\n        title = random.choice(TITLES.get(category, [\"Etkinlik\"]))\n        \n        # Tarih: Gelecek 30 gÃ¼n iÃ§inde rastgele bir zaman\n        days_offset = random.randint(1, 30)\n        event_date = datetime.utcnow() + timedelta(days=days_offset)\n        \n        # Coordinates with slight jitter\n        base_lat, base_lon = CITY_COORDS.get(city, (41.0, 29.0))\n        lat = base_lat + random.uniform(-0.05, 0.05)\n        lon = base_lon + random.uniform(-0.05, 0.05)\n        \n        # Etkinlik oluÅŸtur\n        event = schemas.EventCreate(\n            title=f\"{title} - {city}\",\n            description=f\"Bu harika {category.lower()} etkinliÄŸini kaÃ§Ä±rmayÄ±n!\",\n            date=event_date,\n            latitude=lat,\n            longitude=lon,\n            min_age_limit=18,\n            max_age_limit=35,\n            target_gender=schemas.TargetGender.HERKES,\n            status=schemas.EventStatus.AKTIF,\n            \n            city=city,\n            campus=None, \n            category=category,\n            image_url=IMAGES.get(category),\n            external_url=\"https://biletix.com/mock-link\"\n        )\n        mock_events.append(event)\n        \n    return mock_events\n"
                },
                "image_processor.py": {
                    "type": "text",
                    "content": "from PIL import Image\nimport io\nimport os\nimport uuid\nfrom fastapi import UploadFile\n\n# Desteklenen formatlar ve maksimum boyutlar\nMAX_IMAGE_SIZE = (1920, 1080)\nQUALITY = 85\n\ndef process_and_compress_image(file_object):\n    \"\"\"\n    Bir resim dosyasÄ±nÄ± alÄ±r, boyutlandÄ±rÄ±r, sÄ±kÄ±ÅŸtÄ±rÄ±r ve \n    kaydedilmeye hazÄ±r (filename, file_content) formatÄ±nda dÃ¶ner.\n    \"\"\"\n    try:\n        # 1. Resmi Pillow ile aÃ§\n        image = Image.open(file_object)\n        \n        # 2. Oryantasyon bilgisini dÃ¼zelt (EXIF)\n        # BazÄ± telefon fotoÄŸraflarÄ± yan dÃ¶nÃ¼k Ã§Ä±kabilir, bunu dÃ¼zeltmek gerekir.\n        try:\n            from PIL import ImageOps\n            image = ImageOps.exif_transpose(image)\n        except Exception:\n            pass\n\n        # 3. Format KontrolÃ¼ (RGB'ye Ã§evir - Ã¶rn: PNG alpha kanalÄ± iÃ§in)\n        if image.mode in (\"RGBA\", \"P\"):\n            image = image.convert(\"RGB\")\n            \n        # 4. Yeniden BoyutlandÄ±rma (Gerekirse)\n        # En boy oranÄ±nÄ± koruyarak kÃ¼Ã§Ã¼ltÃ¼r\n        image.thumbnail(MAX_IMAGE_SIZE, Image.Resampling.LANCZOS)\n        \n        # 5. Ã‡Ä±ktÄ± iÃ§in bellek iÃ§i dosya (Buffer)\n        output_buffer = io.BytesIO()\n        \n        # 6. SÄ±kÄ±ÅŸtÄ±rma ve Kaydetme (WebP veya JPEG)\n        # WebP modern ve hafiftir, JPEG uyumluluk iÃ§in.\n        # Burada modern olmasÄ± iÃ§in WebP tercih ediyoruz ama istenirse JPEG de olur.\n        # KullanÄ±cÄ± \"Artibir\" diyor, modern bir ÅŸey olsun: WebP\n        extension = \".webp\"\n        image.save(output_buffer, format=\"WEBP\", quality=QUALITY, optimize=True)\n        \n        output_buffer.seek(0)\n        \n        # 7. Benzersiz Dosya Ä°smi\n        filename = f\"{uuid.uuid4()}{extension}\"\n        \n        return {\n            \"filename\": filename,\n            \"file\": output_buffer,\n            \"width\": image.width,\n            \"height\": image.height\n        }\n\n    except Exception as e:\n        print(f\"Resim iÅŸleme hatasÄ±: {e}\")\n        return None\n"
                },
                "location_service.py": {
                    "type": "text",
                    "content": "import redis\nimport time\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n# Sabitler\nGEO_KEY = \"artibir:locations\"    # TÃ¼m konumlarÄ±n tutulduÄŸu harita anahtarÄ±\nUSER_META_KEY = \"user:last_seen\" # KullanÄ±cÄ±nÄ±n son gÃ¶rÃ¼lme zamanÄ±\n\n# Redis BaÄŸlantÄ±sÄ± (Cloud Redis credentials)\n# Ã‡evresel deÄŸiÅŸkenlerden al, yoksa varsayÄ±lanlarÄ± kullan\nREDIS_HOST = os.getenv(\"REDIS_HOST\", 'redis-14185.c250.eu-central-1-1.ec2.cloud.redislabs.com')\nREDIS_PORT = int(os.getenv(\"REDIS_PORT\", 14185))\nREDIS_PASSWORD = os.getenv(\"REDIS_PASSWORD\")\n\ntry:\n    r = redis.Redis(\n        host=REDIS_HOST,\n        port=REDIS_PORT,\n        password=REDIS_PASSWORD,\n        decode_responses=True,\n        # db parametresi cloud instance'larda genelde 0'dÄ±r, ama gerekiyorsa eklenebilir.\n        db=0 \n    )\nexcept Exception as e:\n    print(f\"Redis BaÄŸlantÄ± HatasÄ±: {e}\")\n    r = None\n\ndef update_location(user_id: str, latitude: float, longitude: float, is_ghost_mode: bool = False):\n    \"\"\"\n    KullanÄ±cÄ±nÄ±n konumunu gÃ¼nceller veya gizler.\n    \"\"\"\n    if not r:\n        raise Exception(\"Redis baÄŸlantÄ±sÄ± yok\")\n\n    if is_ghost_mode:\n        # KullanÄ±cÄ± gÃ¶rÃ¼nmezse haritadan sil\n        r.zrem(GEO_KEY, user_id)\n        return {\"status\": \"hidden\", \"msg\": \"KullanÄ±cÄ± gizlendi\"}\n\n    # 1. Redis GEO ModÃ¼lÃ¼ne Konumu Ekle\n    r.geoadd(GEO_KEY, (longitude, latitude, user_id))\n    \n    # 2. TTL MekanizmasÄ± (Son gÃ¶rÃ¼lme)\n    r.set(f\"{USER_META_KEY}:{user_id}\", int(time.time()), ex=300)\n\n    return {\"status\": \"success\", \"msg\": \"Konum gÃ¼ncellendi\"}\n\ndef get_nearby_users(user_id: str, latitude: float, longitude: float, radius_km: float = 5.0, limit: int = 50):\n    \"\"\"\n    Ã‡evredeki kullanÄ±cÄ±larÄ± getirir.\n    \"\"\"\n    if not r:\n        raise Exception(\"Redis baÄŸlantÄ±sÄ± yok\")\n        \n    results = r.geosearch(\n        name=GEO_KEY,\n        longitude=longitude,\n        latitude=latitude,\n        radius=radius_km,\n        unit=\"km\",\n        withdist=True,\n        sort=\"ASC\",\n        count=limit\n    )\n\n    response_list = []\n    \n    for member, dist in results:\n        # Kendini hariÃ§ tut\n        if member == user_id:\n            continue\n            \n        response_list.append({\n            \"user_id\": member,\n            \"distance_meter\": int(dist * 1000),\n            \"distance_text\": f\"{dist:.2f} km\"\n        })\n\n    return {\n        \"center\": {\"lat\": latitude, \"lon\": longitude},\n        \"count\": len(response_list),\n        \"users\": response_list\n    }\n"
                },
                "maps_service.py": {
                    "type": "text",
                    "content": "import requests\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nGOOGLE_MAPS_API_KEY = os.getenv(\"GOOGLE_MAPS_API_KEY\")\nBASE_URL = \"https://maps.googleapis.com/maps/api/directions/json\"\n\ndef get_directions(origin: str, destination: str, mode: str = \"walking\"):\n    \"\"\"\n    Google Maps Directions API kullanarak iki nokta arasÄ± rota Ã§izer.\n    \n    Args:\n        origin (str): \"lat,lon\" formatÄ±nda baÅŸlangÄ±Ã§ noktasÄ±\n        destination (str): \"lat,lon\" formatÄ±nda varÄ±ÅŸ noktasÄ±\n        mode (str): \"walking\", \"driving\", \"bicycling\", \"transit\"\n    \n    Returns:\n        dict: Rota bilgileri, polyline ve sÃ¼re/mesafe\n    \"\"\"\n    if not GOOGLE_MAPS_API_KEY:\n        return {\n            \"status\": \"error\", \n            \"message\": \"Google Maps API Key tanÄ±mlanmamÄ±ÅŸ (GOOGLE_MAPS_API_KEY).\"\n        }\n\n    params = {\n        \"origin\": origin,\n        \"destination\": destination,\n        \"mode\": mode,\n        \"key\": GOOGLE_MAPS_API_KEY\n    }\n\n    try:\n        response = requests.get(BASE_URL, params=params, timeout=10)\n        data = response.json()\n        \n        if data[\"status\"] == \"OK\":\n            route = data[\"routes\"][0]\n            leg = route[\"legs\"][0]\n            \n            return {\n                \"status\": \"success\",\n                \"overview_polyline\": route[\"overview_polyline\"][\"points\"], # Haritada Ã§izmek iÃ§in encoded string\n                \"distance\": leg[\"distance\"][\"text\"],\n                \"duration\": leg[\"duration\"][\"text\"],\n                \"start_address\": leg[\"start_address\"],\n                \"end_address\": leg[\"end_address\"]\n            }\n        else:\n            return {\n                \"status\": \"error\", \n                \"message\": data.get(\"error_message\", f\"API HatasÄ±: {data['status']}\")\n            }\n            \n    except Exception as e:\n        return {\"status\": \"error\", \"message\": f\"BaÄŸlantÄ± hatasÄ±: {str(e)}\"}"
                },
                "moderation.py": {
                    "type": "text",
                    "content": "import re\nimport json\nimport os\nimport threading\n\n# NLP Entegrasyonu iÃ§in Transformers kÃ¼tÃ¼phanesi\ntry:\n    from transformers import pipeline\n    NLP_AVAILABLE = True\nexcept ImportError:\n    NLP_AVAILABLE = False\n\nBAD_WORDS_FILE = os.path.join(os.path.dirname(os.path.dirname(__file__)), \"data\", \"tr_bad_words.json\")\n\nclass SecurityGuard:\n    def __init__(self):\n        self.bad_words = self._load_bad_words()\n        self.classifier = None\n        \n        # GeliÅŸtirme ortamÄ±nda indirmeyi beklememek iÃ§in opsiyonel yapÄ±yoruz\n        # .env dosyasÄ±na ENABLE_NLP=True eklerseniz aktif olur.\n        enable_nlp = os.getenv(\"ENABLE_NLP\", \"False\").lower() == \"true\"\n        \n        if NLP_AVAILABLE and enable_nlp:\n            print(\"ğŸ›¡ï¸ GÃ¼venlik Botu: NLP Modeli arka planda yÃ¼kleniyor... (Sunucu aÃ§Ä±lÄ±ÅŸÄ± devam ediyor)\")\n            # Modeli ana akÄ±ÅŸÄ± bloklamadan arka planda yÃ¼kle\n            threading.Thread(target=self._load_model, daemon=True).start()\n        elif NLP_AVAILABLE:\n            print(\"â„¹ï¸ GÃ¼venlik Botu: NLP Modeli devre dÄ±ÅŸÄ± (Aktif etmek iÃ§in .env'de ENABLE_NLP=True yapÄ±n).\")\n\n    def _load_model(self):\n        \"\"\"Modeli arka planda yÃ¼kler.\"\"\"\n        try:\n            # TÃ¼rkÃ§e destekli Ã§ok dilli toksisite modeli\n            self.classifier = pipeline(\"text-classification\", model=\"unitary/multilingual-toxic-xlm-roberta\", top_k=None)\n            print(\"âœ… GÃ¼venlik Botu: NLP Modeli baÅŸarÄ±yla yÃ¼klendi ve aktif!\")\n        except Exception as e:\n            print(f\"âš ï¸ NLP Modeli yÃ¼klenemedi: {e}\")\n\n    def _load_bad_words(self):\n        \"\"\"\n        tr_bad_words.json dosyasÄ±ndan yasaklÄ± kelimeleri yÃ¼kler.\n        Dosya yoksa default listeyi kullanÄ±r.\n        \"\"\"\n        try:\n            if os.path.exists(BAD_WORDS_FILE):\n                with open(BAD_WORDS_FILE, \"r\", encoding=\"utf-8\") as f:\n                    return json.load(f)\n        except Exception as e:\n            print(f\"Bad words file load error: {e}\")\n        \n        # Fallback list\n        return [\n            \"aptal\", \"gerizekalÄ±\", \"salak\", \"kÃ¼fÃ¼r1\", \"kÃ¼fÃ¼r2\", \n            \"taciz1\", \"ÅŸiddet1\", \"+18kelime\", \"ÅŸerefsiz\"\n        ]\n\n    def check_message(self, message: str, user_trust_score: int):\n        \"\"\"\n        MesajÄ± analiz eder. \n        DÃ¶nÃ¼ÅŸ: (is_safe: bool, reason: str)\n        \"\"\"\n        \n        # A. Metni Temizle (BÃ¼yÃ¼k kÃ¼Ã§Ã¼k harf)\n        clean_text = message.lower()\n        \n        # -----------------------------------------------------------\n        # KURAL 1: KÃœFÃœR VE HAKARET KONTROLÃœ\n        # -----------------------------------------------------------\n        for word in self.bad_words:\n            # Kelimenin kendisi var mÄ±? \n            # (Basit kontrol, regex ile geliÅŸtirilebilir)\n            if word in clean_text:\n                return False, \"MesajÄ±nÄ±z topluluk kurallarÄ±na aykÄ±rÄ± kelimeler iÃ§eriyor.\"\n\n        # -----------------------------------------------------------\n        # KURAL 1.5: GELÄ°ÅMÄ°Å NLP ANALÄ°ZÄ° (Yapay Zeka)\n        # -----------------------------------------------------------\n        if self.classifier:\n            # Model Ã§Ä±ktÄ±sÄ±nÄ± analiz et (toxic, severe_toxic, obscene, identity_hate, insult, threat)\n            results = self.classifier(message)\n            # SonuÃ§larÄ± sÃ¶zlÃ¼ÄŸe Ã§evir: {'toxic': 0.95, 'insult': 0.80 ...}\n            scores = {item['label']: item['score'] for item in results[0]}\n            \n            # EÅŸik deÄŸerleri (Thresholds) - %80 Ã¼zeri toksikse engelle\n            if scores.get('toxic', 0) > 0.8 or scores.get('severe_toxic', 0) > 0.6 or scores.get('identity_hate', 0) > 0.6:\n                return False, \"MesajÄ±nÄ±z yapay zeka tarafÄ±ndan saldÄ±rgan veya zararlÄ± olarak tespit edildi.\"\n\n        # -----------------------------------------------------------\n        # KURAL 2: TELEFON NUMARASI PAYLAÅIMI (GÃœVENLÄ°K Ä°Ã‡Ä°N)\n        # -----------------------------------------------------------\n        # EÄŸer kullanÄ±cÄ±nÄ±n gÃ¼ven puanÄ± dÃ¼ÅŸÃ¼kse (yeni Ã¼yeyse) numara veremez.\n        # VarsayÄ±lan limit 70 puan.\n        if user_trust_score < 70:\n            # Regex: 05xxxxxxxxx veya 5xxxxxxxxx formatÄ±nÄ± yakalar\n            # \\s* boÅŸluk karakterlerini yakalar\n            phone_pattern = r\"(?:\\+90|0)?5\\d{2}[\\s\\.]?\\d{3}[\\s\\.]?\\d{2}[\\s\\.]?\\d{2}\"\n            if re.search(phone_pattern, message):\n                return False, \"GÃ¼venliÄŸiniz iÃ§in tanÄ±ÅŸmadan hemen telefon numarasÄ± paylaÅŸamazsÄ±nÄ±z.\"\n\n        # -----------------------------------------------------------\n        # KURAL 3: AGRESÄ°F TANIÅMA (Basit NLP)\n        # -----------------------------------------------------------\n        # Tek kelimelik veya Ã§ok kÄ±sa, spam vari mesajlar\n        # Ancak \"Selam\" gibi tek kelime olabilir, o yÃ¼zden < 2 Ã§ok kÄ±sa.\n        if len(message.strip()) < 2:\n            return False, \"LÃ¼tfen anlamlÄ± bir cÃ¼mle kurun.\"\n\n        # Her ÅŸey temizse onayÄ± ver\n        return True, \"OnaylandÄ±\"\n\n    def filter_message(self, content: str) -> str:\n        \"\"\"\n        (Opsiyonel) MesajÄ± sansÃ¼rleyerek dÃ¶ndÃ¼rÃ¼r.\n        Eski sistemde kullanÄ±ldÄ±ÄŸÄ± iÃ§in uyumluluk adÄ±na eklendi.\n        EÄŸer check_message False dÃ¶nerse mesaj hiÃ§ gÃ¶nderilmeyebilir,\n        ama gÃ¶nderilecekse sansÃ¼rlenebilir.\n        \"\"\"\n        filtered_content = content\n        for word in self.bad_words:\n            pattern = re.compile(re.escape(word), re.IGNORECASE)\n            filtered_content = pattern.sub(\"*\" * len(word), filtered_content)\n        return filtered_content\n\n# Singleton instance\nguard = SecurityGuard()\n\n# Eski fonksiyonlarÄ±n yeni sÄ±nÄ±fa yÃ¶nlendirilmesi (Geriye dÃ¶nÃ¼k uyumluluk)\ndef filter_message(content: str) -> str:\n    return guard.filter_message(content)\n\ndef check_message(message: str, user_trust_score: int = 50):\n    return guard.check_message(message, user_trust_score)\n"
                },
                "notification.py": {
                    "type": "text",
                    "content": "import smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nimport requests\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n# Email Config\nSMTP_HOST = os.getenv(\"SMTP_HOST\")\nSMTP_PORT = int(os.getenv(\"SMTP_PORT\", 587))\nSMTP_USER = os.getenv(\"SMTP_USER\")\nSMTP_PASSWORD = os.getenv(\"SMTP_PASSWORD\")\n\n# SMS Config\nSMS_API_URL = os.getenv(\"SMS_API_URL\")\nSMS_API_KEY = os.getenv(\"SMS_API_KEY\")\nSMS_SENDER_TITLE = os.getenv(\"SMS_SENDER_TITLE\", \"ARTIBIR\")\n\ndef send_email(to_email: str, subject: str, body: str, html_body: str = None) -> bool:\n    \"\"\"\n    SMTP protokolÃ¼ ile e-posta (HTML destekli) gÃ¶nderir.\n    \"\"\"\n    if not SMTP_USER or not SMTP_PASSWORD:\n        print(\"âš ï¸ SMTP credentials not found. Skipping email sending.\")\n        return False\n\n    try:\n        message = MIMEMultipart(\"alternative\")\n        message[\"From\"] = f\"ArtÄ±Bir Ekibi <{SMTP_USER}>\"\n        message[\"To\"] = to_email\n        message[\"Subject\"] = subject\n        \n        # Plain text versiyonu\n        part1 = MIMEText(body, \"plain\")\n        message.attach(part1)\n        \n        # HTML versiyonu (EÄŸer varsa)\n        if html_body:\n            part2 = MIMEText(html_body, \"html\")\n            message.attach(part2)\n\n        with smtplib.SMTP(SMTP_HOST, SMTP_PORT) as server:\n            server.starttls()\n            server.login(SMTP_USER, SMTP_PASSWORD)\n            server.sendmail(SMTP_USER, to_email, message.as_string())\n        \n        return True\n    except Exception as e:\n        print(f\"âŒ Email sending failed: {e}\")\n        return False\n\ndef send_sms(to_phone: str, message: str) -> bool:\n    \"\"\"\n    HTTP Post isteÄŸi ile SMS gÃ¶nderir (Genel yapÄ±).\n    API SaÄŸlayÄ±cÄ±nÄ±za gÃ¶re payload (data) kÄ±smÄ±nÄ± dÃ¼zenlemeniz gerekebilir.\n    \"\"\"\n    if not SMS_API_URL or not SMS_API_KEY:\n        print(\"âš ï¸ SMS settings not found. Skipping SMS sending.\")\n        return False\n\n    try:\n        # Ã–rnek Payload (Netgsm, IletiMerkezi vb. benzer yapÄ±lar kullanÄ±r)\n        # SaÄŸlayÄ±cÄ±nÄ±zÄ±n dokÃ¼mantasyonuna gÃ¶re burayÄ± dÃ¼zenleyin.\n        payload = {\n            \"apikey\": SMS_API_KEY,\n            \"header\": SMS_SENDER_TITLE,\n            \"message\": message,\n            \"phones\": [to_phone]\n        }\n        \n        # BazÄ± saÄŸlayÄ±cÄ±lar XML ister, bazÄ±larÄ± JSON. Bu Ã¶rnek JSON iÃ§indir.\n        response = requests.post(SMS_API_URL, json=payload, timeout=10)\n        \n        if response.status_code == 200:\n            print(f\"SMS Sent Response: {response.text}\")\n            return True\n        else:\n            print(f\"SMS Failed Status: {response.status_code} - {response.text}\")\n            return False\n            \n    except Exception as e:\n        print(f\"âŒ SMS sending failed: {e}\")\n        return False\n"
                },
                "payment_service.py": {
                    "type": "text",
                    "content": "import iyzipay\nimport os\nfrom dotenv import load_dotenv\nfrom uuid import uuid4\nimport hmac\nimport hashlib\n\nload_dotenv()\n\nclass PaymentService:\n    @staticmethod\n    def _get_options():\n        options = {\n            'api_key': os.getenv(\"IYZICO_API_KEY\"),\n            'secret_key': os.getenv(\"IYZICO_SECRET_KEY\"),\n            'base_url': os.getenv(\"IYZICO_BASE_URL\")\n        }\n        return options\n\n    @staticmethod\n    def initialize_3ds_payment(user, card_info, amount, conversation_id=None):\n        \"\"\"\n        Iyzico 3D Secure Ã¶deme baÅŸlatÄ±r.\n        \"\"\"\n        if conversation_id is None:\n            conversation_id = str(uuid4())\n\n        # GÃœVENLÄ°K: Callback URL iÃ§in HMAC Ä°mzasÄ± OluÅŸturma\n        # Bu imza, callback geldiÄŸinde isteÄŸin bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ doÄŸrulamak iÃ§in kullanÄ±lacak.\n        api_secret = os.getenv(\"IYZICO_SECRET_KEY\", \"\").encode()\n        signature = hmac.new(api_secret, conversation_id.encode(), hashlib.sha256).hexdigest()\n        callback_url = f\"{os.getenv('APP_URL', 'http://localhost:8000')}/payments/callback?signature={signature}\"\n\n        # Adres Bilgileri (Mock - GerÃ§ekte kullanÄ±cÄ±dan alÄ±nmalÄ±)\n        address = {\n            'contactName': user.full_name,\n            'city': user.city or 'Istanbul',\n            'country': 'Turkey',\n            'address': 'Kadikoy - Istanbul',\n            'zipCode': '34744'\n        }\n\n        request = {\n            'locale': 'tr',\n            'conversationId': conversation_id,\n            'price': str(amount),\n            'paidPrice': str(amount),\n            'currency': 'TRY',\n            'basketId': 'B' + str(uuid4())[:8],\n            'paymentGroup': 'PRODUCT',\n            'callbackUrl': callback_url, # Ä°mzalÄ± Callback URL\n            'paymentCard': {\n                'cardHolderName': card_info['card_holder_name'],\n                'cardNumber': card_info['card_number'],\n                'expireMonth': card_info['expire_month'],\n                'expireYear': card_info['expire_year'],\n                'cvc': card_info['cvc'],\n                'registerCard': '1' if card_info.get('register_card') else '0'\n            },\n            'buyer': {\n                'id': str(user.id),\n                'name': user.full_name.split()[0] if \" \" in user.full_name else user.full_name,\n                'surname': user.full_name.split()[-1] if \" \" in user.full_name else 'ArtibirUser',\n                'gsmNumber': user.phone_number or '+905555555555',\n                'email': user.email,\n                'identityNumber': user.tc_no or '11111111111',\n                'lastLoginDate': '2023-10-05 12:43:35',\n                'registrationDate': '2023-09-05 10:11:00',\n                'registrationAddress': address['address'],\n                'ip': '85.34.78.112',\n                'city': address['city'],\n                'country': address['country'],\n                'zipCode': address['zipCode']\n            },\n            'shippingAddress': address,\n            'billingAddress': address,\n            'basketItems': [\n                {\n                    'id': 'BI101',\n                    'name': 'Artibir Wallet Top-up',\n                    'category1': 'Wallet',\n                    'itemType': 'VIRTUAL',\n                    'price': str(amount)\n                }\n            ]\n        }\n\n        threeds_initialize = iyzipay.ThreedsInitialize().create(request, PaymentService._get_options())\n        return threeds_initialize.read().decode('utf-8')\n\n    @staticmethod\n    def retrieve_3ds_result(payment_id, conversation_id):\n        \"\"\"\n        3D Secure sonucunu Iyzico'dan Ã§eker.\n        \"\"\"\n        request = {\n            'locale': 'tr',\n            'conversationId': conversation_id,\n            'paymentId': payment_id\n        }\n\n        threeds_payment = iyzipay.ThreedsPayment().create(request, PaymentService._get_options())\n        return threeds_payment.read().decode('utf-8')\n\n    @staticmethod\n    def register_card(user, card_info):\n        \"\"\"\n        KartÄ± Iyzico tarafÄ±nda gÃ¼venli bir ÅŸekilde saklar.\n        \"\"\"\n        request = {\n            'locale': 'tr',\n            'conversationId': str(uuid4()),\n            'email': user.email,\n            'externalId': str(user.id),\n            'card': {\n                'cardHolderName': card_info['card_holder_name'],\n                'cardNumber': card_info['card_number'],\n                'expireMonth': card_info['expire_month'],\n                'expireYear': card_info['expire_year'],\n            }\n        }\n\n        card_storage = iyzipay.Card().create(request, PaymentService._get_options())\n        return card_storage.read().decode('utf-8')\n"
                },
                "scraper_service.py": {
                    "type": "text",
                    "content": "import requests\nfrom bs4 import BeautifulSoup\nimport random\nfrom datetime import datetime, timedelta\nimport schemas\n\nclass ScraperService:\n    @staticmethod\n    def scrape_events_by_location(location: str):\n        \"\"\"\n        Verilen konuma gÃ¶re internetten etkinlikleri tarar.\n        GerÃ§ek dÃ¼nya senaryosunda bu metod Biletix, Passo vb. sitelere istek atar.\n        Ã–rnek olarak burada bir requests + bs4 yapÄ±sÄ± kurulmuÅŸtur ancak \n        her sitenin yapÄ±sÄ± farklÄ± olduÄŸu iÃ§in demo amaÃ§lÄ± 'AkÄ±llÄ± SimÃ¼lasyon' modundadÄ±r.\n        \"\"\"\n        print(f\"[{location}] iÃ§in etkinlikler taranÄ±yor...\")\n        \n        # GerÃ§ek bir HTTP isteÄŸi Ã¶rneÄŸi (Bir siteye gidip title Ã§ekmek gibi)\n        # try:\n        #     url = f\"https://www.google.com/search?q={location}+etkinlikleri\"\n        #     headers = {'User-Agent': 'Mozilla/5.0 ...'}\n        #     response = requests.get(url, headers=headers)\n        #     soup = BeautifulSoup(response.content, 'lxml')\n        #     # print(soup.title.string) \n        # except Exception as e:\n        #     print(f\"Scraping hatasÄ±: {e}\")\n\n        # SimÃ¼le EdilmiÅŸ \"Scraped\" Veriler\n        # Bu kÄ±sÄ±m botun bulduÄŸu verileri temsil eder.\n        \n        found_events = []\n        \n        titles = [\n            f\"{location} Yaz Festivali\",\n            f\"{location} Teknoloji Zirvesi\",\n            f\"{location} Caz Gecesi\",\n            f\"{location} Tiyatro GÃ¼nleri\",\n            f\"{location} Kahve Festivali\"\n        ]\n        \n        categories = [\"Festival\", \"Konferans\", \"Konser\", \"Tiyatro\", \"Yeme-Ä°Ã§me\"]\n        \n        for i in range(random.randint(3, 6)):\n            title = titles[i] if i < len(titles) else f\"{location} EtkinliÄŸi #{i+1}\"\n            category = categories[i] if i < len(categories) else \"DiÄŸer\"\n            \n            # Rastgele koordinat sapmasÄ± (Åehir merkezinden biraz daÄŸÄ±tÄ±yoruz)\n            # VarsayÄ±lan (Ä°stanbul): 41.0, 29.0\n            lat_base = 41.0082\n            lon_base = 28.9784\n            \n            if \"ankara\" in location.lower():\n                lat_base, lon_base = 39.9334, 32.8597\n            elif \"izmir\" in location.lower():\n                 lat_base, lon_base = 38.4192, 27.1287\n            # ... diÄŸer ÅŸehirler eklenebilir\n            \n            event = schemas.EventCreate(\n                title=title,\n                description=f\"{location} ÅŸehrinde dÃ¼zenlenen harika bir {category.lower()} etkinliÄŸi. Ä°nternetten otomatik Ã§ekildi.\",\n                date=datetime.now() + timedelta(days=random.randint(1, 14)),\n                latitude=lat_base + random.uniform(-0.03, 0.03),\n                longitude=lon_base + random.uniform(-0.03, 0.03),\n                min_age_limit=18,\n                max_age_limit=40,\n                target_gender=schemas.TargetGender.HERKES,\n                category=category,\n                status=schemas.EventStatus.AKTIF,\n                city=location.capitalize(),\n                image_url=f\"https://source.unsplash.com/random/800x600?{category.lower()},event\",\n                external_url=\"https://google.com/search?q=\" + title.replace(\" \", \"+\")\n            )\n            found_events.append(event)\n            \n        return found_events\n"
                }
            }
        },
        "tests": {
            "directories": [],
            "files": {
                "check_startup.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n\n# Add current directory to path\nsys.path.append(os.getcwd())\n\nprint(f\"Checking startup from {os.getcwd()}\")\n\ntry:\n    from main import app\n    print(\"SUCCESS: main.py imported successfully.\")\nexcept Exception as e:\n    print(f\"FAILURE: Could not import main.py. Error: {e}\")\n    import traceback\n    traceback.print_exc()\n"
                },
                "verify_all.py": {
                    "type": "text",
                    "content": "import sys\nimport os\nfrom uuid import uuid4\nfrom datetime import date\n\nsys.path.append(os.getcwd())\n\ntry:\n    print(\"Checking imports...\")\n    import models\n    import schemas\n    import crud\n    import routers.events\n    import routers.users\n    import routers.chat\n    import routers.auth\n    from services import event_provider\n    print(\"All modules imported successfully.\")\nexcept ImportError as e:\n    print(f\"IMPORT ERROR: {e}\")\n    sys.exit(1)\n\nfrom database import engine, SessionLocal, Base\nimport sqlalchemy\n\nprint(\"Creating tables (if ignoring PostGIS warnings)...\")\ntry:\n    Base.metadata.create_all(bind=engine)\n    print(\"Tables created.\")\nexcept Exception as e:\n    print(f\"Table creation error (expected if SQLite+PostGIS types): {e}\")\n\nprint(\"Testing CRUD operations (Dry Run)...\")\ndb = SessionLocal()\ntry:\n    # Test User Schema creation\n    user_in = schemas.UserCreate(\n        email=f\"test{uuid4()}@univ.edu.tr\",\n        password=\"Password123\",\n        full_name=\"Test User\",\n        birth_date=date(2000, 1, 1),\n        gender=\"E\"\n    )\n    # Note: crud.create_user commits.\n    # We won't commit to avoid pollution if we can rollback, or just try-catch.\n    # But crud logic commits inside.\n    # Assuming this is dev env.\n    \n    # We can't easily test DB write if engine fails on PostGIS types with SQLite.\n    # But we can verify the python logic up to DB call.\n    \n    print(\"User payload verified.\")\n    pass\n\nexcept Exception as e:\n    print(f\"CRUD verification error: {e}\")\n\nprint(\"Review complete. Code structure is valid.\")\n"
                },
                "verify_artibir_vision.py": {
                    "type": "text",
                    "content": "from schemas import UserCreate\nfrom pydantic import ValidationError\n\ndef test_artibir_validation():\n    print(\"Testing ArtÄ±Bir Specific Validations...\")\n    \n    # 1. Valid University Email\n    try:\n        UserCreate(\n            email=\"ogrenci@bogazici.edu.tr\", \n            full_name=\"Valid Uni Student\", \n            password=\"StrongPassword1\", \n            phone_number=\"+905551234567\"\n        )\n        print(\"âœ… University email (.edu.tr) accepted.\")\n    except ValidationError as e:\n        print(f\"âŒ University email rejected: {e}\")\n\n    # 2. Invalid Email (Gmail)\n    try:\n        UserCreate(\n            email=\"hackerman@gmail.com\", \n            full_name=\"Random User\", \n            password=\"StrongPassword1\", \n            phone_number=\"+905551234567\"\n        )\n        print(\"âŒ Gmail accepted (FAILED) - Security breach!\")\n    except ValidationError as e:\n        print(\"âœ… Gmail rejected (PASSED).\")\n\n    # 3. Invalid Email (Random .com)\n    try:\n        UserCreate(\n            email=\"test@example.com\", \n            full_name=\"Test User\", \n            password=\"StrongPassword1\", \n            phone_number=\"+905551234567\"\n        )\n        print(\"âŒ .com email accepted (FAILED).\")\n    except ValidationError as e:\n        print(\"âœ… .com email rejected (PASSED).\")\n\nif __name__ == \"__main__\":\n    test_artibir_validation()\n"
                },
                "verify_chat.py": {
                    "type": "text",
                    "content": "import asyncio\nimport websockets\nimport requests\nimport json\nimport sys\n\n# Windows Proactor Event Loop sorunu iÃ§in\nif sys.platform == 'win32':\n    asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())\n\nBASE_URL = \"http://127.0.0.1:8000\"\nWS_URL = \"ws://127.0.0.1:8000\"\n\ndef register_and_login(email, password, name):\n    # Register\n    requests.post(f\"{BASE_URL}/auth/signup\", json={\n        \"email\": email,\n        \"password\": password,\n        \"full_name\": name,\n        \"phone_number\": \"+905551234567\"\n    })\n    \n    # Login\n    # Backend UserLogin ÅŸemasÄ± beklediÄŸi iÃ§in JSON gÃ¶ndermeliyiz\n    response = requests.post(f\"{BASE_URL}/auth/login\", json={\n        \"email\": email,\n        \"password\": password\n    })\n    \n    if response.status_code == 200:\n        return response.json()[\"access_token\"]\n    print(f\"Login Failed for {email}: {response.text}\")\n    return None\n\nasync def test_chat():\n    print(\"--- 1. KullanÄ±cÄ±lar OluÅŸturuluyor ---\")\n    token1 = register_and_login(\"user1@univ.edu.tr\", \"Password123\", \"User One\")\n    token2 = register_and_login(\"user2@univ.edu.tr\", \"Password123\", \"User Two\")\n    \n    if not token1 or not token2:\n        print(\"Token alÄ±namadÄ±, test iptal.\")\n        return\n\n    # ID'leri basitÃ§e 1 ve 2 varsayÄ±yoruz (DB sÄ±fÄ±rlandÄ±ÄŸÄ± iÃ§in)\n    user1_id = 1\n    user2_id = 2\n\n    print(\"\\n--- 2. WebSocket BaÄŸlantÄ±sÄ± Kuruluyor ---\")\n    async with websockets.connect(f\"{WS_URL}/ws/chat/{token1}\") as ws1:\n        print(\"User 1 BaÄŸlandÄ±\")\n        \n        # Test 1: Normal Mesaj\n        message = {\n            \"receiver_id\": user2_id,\n            \"content\": \"Merhaba User 2, nasÄ±lsÄ±n?\"\n        }\n        await ws1.send(json.dumps(message))\n        \n        response = await ws1.recv()\n        print(f\"\\nUser 1 Gelen YanÄ±t (Kendi MesajÄ±): {response}\")\n        \n        # Test 2: SansÃ¼rlÃ¼ Mesaj\n        bad_message = {\n            \"receiver_id\": user2_id,\n            \"content\": \"Sen bir aptal ve gerizekalÄ± mÄ±sÄ±n?\"\n        }\n        print(f\"\\nUser 1 YasaklÄ± Mesaj GÃ¶nderiyor: {bad_message['content']}\")\n        await ws1.send(json.dumps(bad_message))\n        \n        response = await ws1.recv()\n        print(f\"User 1 Gelen YanÄ±t (SansÃ¼rlenmiÅŸ OlmalÄ±): {response}\")\n        \n    print(\"\\n--- 3. GeÃ§miÅŸ KontrolÃ¼ (History) ---\")\n    # API Ã¼zerinden geÃ§miÅŸi Ã§ek (Åifresi Ã§Ã¶zÃ¼lmÃ¼ÅŸ gelmeli)\n    headers = {\"Authorization\": f\"Bearer {token1}\"}\n    resp = requests.get(f\"{BASE_URL}/chat/history/{user2_id}\", headers=headers)\n    if resp.status_code == 200:\n        history = resp.json()\n        print(f\"Mesaj GeÃ§miÅŸi ({len(history)} adet):\")\n        for msg in history:\n            print(f\"- {msg['content']}\")\n    else:\n        print(f\"GeÃ§miÅŸ Ã§ekilemedi: {resp.text}\")\n\nif __name__ == \"__main__\":\n    asyncio.run(test_chat())\n"
                },
                "verify_events.py": {
                    "type": "text",
                    "content": "import requests\nimport json\n\nBASE_URL = \"http://127.0.0.1:8000\"\n\ndef test_auto_fetch():\n    print(\"\\n--- Testing Auto Fetch ---\")\n    response = requests.post(f\"{BASE_URL}/events/auto-fetch?count=5\")\n    if response.status_code == 200:\n        events = response.json()\n        print(f\"Success! {len(events)} events created.\")\n        for event in events:\n            print(f\"- [{event['category']}] {event['title']} ({event['city']})\")\n    else:\n        print(f\"Failed: {response.status_code}\")\n        print(f\"Details: {response.text}\")\n\ndef test_get_events():\n    print(\"\\n--- Testing Get All Events ---\")\n    response = requests.get(f\"{BASE_URL}/events\")\n    if response.status_code == 200:\n        events = response.json()\n        print(f\"Total events in DB: {len(events)}\")\n    else:\n        print(f\"Failed: {response.status_code}\")\n\ndef test_filter_events():\n    category = \"Futbol\"\n    print(f\"\\n--- Testing Filter by {category} ---\")\n    response = requests.get(f\"{BASE_URL}/events?category={category}\")\n    if response.status_code == 200:\n        events = response.json()\n        print(f\"Found {len(events)} events for {category}:\")\n        for event in events:\n            print(f\"- {event['title']}\")\n    else:\n        print(f\"Failed: {response.status_code}\")\n\nif __name__ == \"__main__\":\n    try:\n        test_auto_fetch()\n        test_get_events()\n        test_filter_events()\n    except Exception as e:\n        print(f\"An error occurred: {e}\")\n"
                },
                "verify_location.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n\nsys.path.append(os.getcwd())\n\nprint(\"Testing Redis Import...\")\ntry:\n    import redis\n    print(\"Redis module imported.\")\nexcept ImportError:\n    print(\"FAIL: redis module not installed.\")\n    sys.exit(1)\n\nprint(\"Testing Location Service Logic...\")\ntry:\n    from services import location_service\n    print(\"Location service imported.\")\n    \n    # Mock Redis object to test logic if actual connection fails (no password)\n    if location_service.r is None:\n        print(\"WARNING: Redis connection failed (likely missing password). Logic testing unavailable.\")\n    else:\n        print(\"Redis connection object exists (connection status unknown until used).\")\n\nexcept Exception as e:\n    print(f\"Service error: {e}\")\n\nprint(\"Testing Router Integration...\")\ntry:\n    from main import app\n    routes = [route.path for route in app.routes]\n    if \"/api/location/update\" in routes:\n        print(\"Location update endpoint found.\")\n    else:\n        print(\"WARNING: /api/location/update endpoint NOT found.\")\nexcept Exception as e:\n    print(f\"Router check error: {e}\")\n"
                },
                "verify_media.py": {
                    "type": "text",
                    "content": "import sys\nimport os\nimport io\nfrom PIL import Image\n\nsys.path.append(os.getcwd())\n\nprint(\"Testing Image Processor Import...\")\ntry:\n    from services.image_processor import process_and_compress_image\n    print(\"Service imported.\")\nexcept ImportError as e:\n    print(f\"FAILED to import service: {e}\")\n    sys.exit(1)\n\nprint(\"Testing Pillow Integration...\")\ntry:\n    # Create dummy image\n    img = Image.new('RGB', (2000, 2000), color = 'red')\n    img_byte_arr = io.BytesIO()\n    img.save(img_byte_arr, format='PNG')\n    img_byte_arr.seek(0)\n    \n    # Test processing\n    result = process_and_compress_image(img_byte_arr)\n    if result and result[\"width\"] <= 1920:\n        print(f\"Image processed successfully. New filename: {result['filename']}\")\n    else:\n        print(\"Image processing failed or didn't resize.\")\nexcept Exception as e:\n    print(f\"Processing error: {e}\")\n\nprint(\"Testing Router Integration...\")\ntry:\n    from main import app\n    print(\"Main app imported successfully.\")\n    \n    # Check if router is included (simplistic check)\n    routes = [route.path for route in app.routes]\n    if \"/api/upload/image\" in routes:\n        print(\"Upload endpoint found in app routes.\")\n    else:\n        print(\"WARNING: /api/upload/image not found in routes.\")\n        print(f\"Available routes: {routes}\")\nexcept Exception as e:\n    print(f\"Router check error: {e}\")\n"
                },
                "verify_moderation.py": {
                    "type": "text",
                    "content": "import sys\nimport os\n\nsys.path.append(os.getcwd())\n\nprint(\"Testing Moderation Service...\")\ntry:\n    from services import moderation\n    \n    # Test 1: Bad Word\n    print(\"Test 1: Bad Word\")\n    safe, reason = moderation.check_message(\"Sen bir aptalsÄ±n\", 50)\n    if not safe:\n        print(f\"PASS: Caught bad word. Reason: {reason}\")\n    else:\n        print(\"FAIL: Failed to catch bad word.\")\n\n    # Test 2: Phone Number (Low Score)\n    print(\"Test 2: Phone Number (Low Score 50)\")\n    safe, reason = moderation.check_message(\"Numaram 05551234567\", 50)\n    if not safe:\n        print(f\"PASS: Caught phone number for low score. Reason: {reason}\")\n    else:\n        print(\"FAIL: Allowed phone number for low score.\")\n\n    # Test 3: Phone Number (High Score)\n    print(\"Test 3: Phone Number (High Score 80)\")\n    safe, reason = moderation.check_message(\"Numaram 05551234567\", 80)\n    if safe:\n        print(\"PASS: Allowed phone number for high score.\")\n    else:\n        print(f\"FAIL: Blocked phone number for high score. Reason: {reason}\")\n\n    # Test 4: Short Message\n    print(\"Test 4: Short Message\")\n    safe, reason = moderation.check_message(\"a\", 50)\n    if not safe:\n        print(f\"PASS: Caught short message. Reason: {reason}\")\n    else:\n        print(\"FAIL: Allowed short message.\")\n\nexcept ImportError as e:\n    print(f\"Import Error: {e}\")\nexcept Exception as e:\n    print(f\"Test Error: {e}\")\n"
                },
                "verify_new_models.py": {
                    "type": "text",
                    "content": "\nimport sys\nimport os\n\n# Add current directory to path\nsys.path.append(os.getcwd())\n\ntry:\n    print(\"Importing models...\")\n    from models import User, Event, Message, Base\n    print(\"Models imported successfully.\")\nexcept ImportError as e:\n    print(f\"FAILED to import models: {e}\")\n    sys.exit(1)\n\ntry:\n    print(\"Importing schemas...\")\n    from schemas import UserOut, EventOut\n    print(\"Schemas imported successfully.\")\nexcept ImportError as e:\n    print(f\"FAILED to import schemas: {e}\")\n    sys.exit(1)\n\n# Check dependencies\ntry:\n    import geoalchemy2\n    print(\"geoalchemy2 is installed.\")\nexcept ImportError:\n    print(\"WARNING: geoalchemy2 is NOT installed. Models will fail to load in runtime.\")\n\ntry:\n    import sqlalchemy\n    print(f\"SQLAlchemy version: {sqlalchemy.__version__}\")\nexcept ImportError:\n    print(\"FAILED: SQLAlchemy not found.\")\n\n# Try to create tables (will verify SQLAlchemy mapping)\nfrom database import engine\nprint(\"Attempting to create tables (Dry Run)...\")\ntry:\n    # Use mock engine or just try print schema\n    from sqlalchemy.schema import CreateTable\n    from sqlalchemy import create_mock_engine\n\n    def dump(sql, *multiparams, **params):\n        print(sql.compile(dialect=engine.dialect))\n    \n    # We can try to compile the CREATE TABLE statements\n    # This checks generic SQL generation validity\n    # But since we use PostGIS types, we need PostGIS dialect usually.\n    # If engine is SQLite, it might fail.\n    \n    # Just try Base.metadata.create_all(bind=engine) and catch error\n    Base.metadata.create_all(bind=engine)\n    print(\"Tables created successfully (or already exist).\")\n\nexcept Exception as e:\n    print(f\"ERROR creating tables: {e}\")\n    print(\"Note: If this is an SQLite database, PostGIS types like GEOGRAPHY might fallback or fail.\")\n\nprint(\"Verification complete.\")\n"
                },
                "verify_phase2.py": {
                    "type": "text",
                    "content": "from schemas import UserCreate\nfrom pydantic import ValidationError\n\ndef test_validation():\n    print(\"Testing Validation Logic...\")\n    \n    # 1. Valid User\n    try:\n        UserCreate(\n            email=\"valid@example.com\", \n            full_name=\"Valid User\", \n            password=\"StrongPassword1\", \n            phone_number=\"+905551234567\"\n        )\n        print(\"âœ… Valid user accepted.\")\n    except ValidationError as e:\n        print(f\"âŒ Valid user rejected: {e}\")\n\n    # 2. Invalid Phone\n    try:\n        UserCreate(\n            email=\"invalid_phone@example.com\", \n            full_name=\"Invalid Phone\", \n            password=\"StrongPassword1\", \n            phone_number=\"123\"\n        )\n        print(\"âŒ Invalid phone accepted (FAILED).\")\n    except ValidationError as e:\n        print(\"âœ… Invalid phone rejected (PASSED).\")\n\n    # 3. Invalid Password (Short)\n    try:\n        UserCreate(\n            email=\"short_pw@example.com\", \n            full_name=\"Short PW\", \n            password=\"short\", \n            phone_number=\"+905551234567\"\n        )\n        print(\"âŒ Short password accepted (FAILED).\")\n    except ValidationError as e:\n        print(\"âœ… Short password rejected (PASSED).\")\n\n    # 4. Invalid Password (No Digit)\n    try:\n        UserCreate(\n            email=\"nodigit@example.com\",\n            full_name=\"No Digit\", \n            password=\"NoDigitPassword\", \n            phone_number=\"+905551234567\"\n        )\n        print(\"âŒ No-digit password accepted (FAILED).\")\n    except ValidationError as e:\n        print(\"âœ… No-digit password rejected (PASSED).\")\n\nif __name__ == \"__main__\":\n    test_validation()\n"
                }
            }
        },
        "uploads": {
            "directories": [
                "images"
            ],
            "files": {}
        },
        "uploads/images": {
            "directories": [],
            "files": {}
        },
        "utils": {
            "directories": [],
            "files": {
                "edevlet_verifier.py": {
                    "type": "text",
                    "content": "import requests\nfrom bs4 import BeautifulSoup\n\ndef ogrenci_belgesi_barkod_kontrol(barkod_kodu: str, kullanici_adi_soyadi: str) -> tuple[bool, str]:\n    \"\"\"\n    KullanÄ±cÄ± e-devletten aldÄ±ÄŸÄ± belgenin barkodunu girer.\n    Sistem arka planda turkiye.gov.tr'ye gider ve belge sahibini kontrol eder.\n    \n    Args:\n        barkod_kodu (str): E-Devlet belge barkodu\n        kullanici_adi_soyadi (str): Kontrol edilecek kiÅŸinin adÄ± soyadÄ±\n        \n    Returns:\n        tuple[bool, str]: (BaÅŸarÄ±lÄ± mÄ±, Mesaj)\n    \"\"\"\n    # Barkod genelde 2 kÄ±sÄ±mdan oluÅŸur ama link tek parÃ§a kabul eder veya kullanÄ±cÄ±dan tam link istenir.\n    # Burada sadece barkod kodu (Ã¶rn: \"ABC123XYZ\") varsayÄ±yoruz.\n    # Turkiye.gov.tr link yapÄ±sÄ±: https://www.turkiye.gov.tr/belge-dogrulama?belge=true&barkod=<KOD>\n    \n    url = f\"https://www.turkiye.gov.tr/belge-dogrulama?belge=true&barkod={barkod_kodu}\"\n    \n    try:\n        # User-Agent eklemek iyi bir pratik olabilir, bazÄ± siteler botsuz isteÄŸi reddeder.\n        headers = {\n            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'\n        }\n        \n        response = requests.get(url, headers=headers, timeout=15)\n        \n        if response.status_code == 200:\n            # Sayfa iÃ§eriÄŸinde isim arama\n            soup = BeautifulSoup(response.content, 'html.parser')\n            sayfa_metni = soup.get_text().upper()\n            \n            # TÃ¼rkÃ§e karakter dÃ¶nÃ¼ÅŸÃ¼mleri iÃ§in basit upper() bazen sorunlu olabilir (.replace('i','Ä°') vb.)\n            # Ancak basit kontrol iÃ§in:\n            kullanici_adi_upper = kullanici_adi_soyadi.upper().replace('i', 'Ä°')\n            \n            # \"Ã–ÄRENCÄ° BELGESÄ°\" veya benzeri anahtar kelimeler belgenin tÃ¼rÃ¼nÃ¼ doÄŸrular\n            # Ancak en kritiÄŸi isim eÅŸleÅŸmesidir.\n            \n            # E-Devlet genelde hatalÄ± barkodda \"Belge BulunamadÄ±\" der.\n            if \"BELGE BULUNAMADI\" in sayfa_metni or \"HATA\" in sayfa_metni:\n                 return False, \"GeÃ§ersiz Barkod veya Belge BulunamadÄ±.\"\n\n            if kullanici_adi_upper in sayfa_metni:\n                return True, \"Belge ve Ä°sim DoÄŸrulandÄ±\"\n            else:\n                return False, \"Belge geÃ§erli ancak isim sistemdeki isimle uyuÅŸmuyor.\"\n        else:\n            return False, f\"E-Devlet EriÅŸim HatasÄ±: {response.status_code}\"\n            \n    except Exception as e:\n        return False, f\"DoÄŸrulama HatasÄ±: {str(e)}\"\n"
                },
                "nvi_verifier.py": {
                    "type": "text",
                    "content": "import requests\n\ndef verify_tckn(tc_no: int, ad: str, soyad: str, dogum_yili: int) -> bool:\n    \"\"\"\n    NVÄ° (NÃ¼fus ve VatandaÅŸlÄ±k Ä°ÅŸleri) Public API Ã¼zerinden TCKN doÄŸrulamasÄ± yapar.\n    \n    Args:\n        tc_no (int): 11 haneli TC Kimlik NumarasÄ±\n        ad (str): KiÅŸinin adÄ± (BÃ¼yÃ¼k harfle gÃ¶nderilmeli, ancak fonksiyon iÃ§inde Ã§evrilecek)\n        soyad (str): KiÅŸinin soyadÄ±\n        dogum_yili (int): DoÄŸum yÄ±lÄ± (Ã–rn: 2003)\n        \n    Returns:\n        bool: DoÄŸrulama baÅŸarÄ±lÄ±ysa True, deÄŸilse False\n    \"\"\"\n    url = \"https://tckimlik.nvi.gov.tr/Service/KPSPublic.asmx\"\n    \n    # TÃ¼rkÃ§e karakter sorunu ve bÃ¼yÃ¼k harf dÃ¶nÃ¼ÅŸÃ¼mÃ¼ iÃ§in basit bir dÃ¼zeltme\n    # Not: Daha kapsamlÄ± bir TÃ¼rkÃ§e uppercase fonksiyonu gerekebilir ama ÅŸimdilik basic upper.\n    ad_upper = ad.upper().replace('i', 'Ä°').replace('Ä±', 'I')\n    soyad_upper = soyad.upper().replace('i', 'Ä°').replace('Ä±', 'I')\n    \n    body = f\"\"\"\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">\n      <soap:Body>\n        <TCKimlikNoDogrula xmlns=\"http://tckimlik.nvi.gov.tr/WS\">\n          <TCKimlikNo>{tc_no}</TCKimlikNo>\n          <Ad>{ad_upper}</Ad>\n          <Soyad>{soyad_upper}</Soyad>\n          <DogumYili>{dogum_yili}</DogumYili>\n        </TCKimlikNoDogrula>\n      </soap:Body>\n    </soap:Envelope>\n    \"\"\"\n    headers = {'Content-Type': 'text/xml; charset=utf-8'}\n    \n    try:\n        response = requests.post(url, data=body.encode('utf-8'), headers=headers)\n        # YanÄ±t kontrolÃ¼\n        return \"<TCKimlikNoDogrulaResult>true</TCKimlikNoDogrulaResult>\" in response.text\n    except Exception as e:\n        print(f\"NVI Error: {e}\")\n        return False\n"
                },
                "tracking.py": {
                    "type": "text",
                    "content": "import json\nimport os\nfrom datetime import datetime\nfrom typing import Any, Dict\n\nTRACKING_FILE = os.path.join(\"data\", \"tracking.json\")\n\ndef ensure_tracking_file():\n    \"\"\"Takip dosyasÄ±nÄ±n ve klasÃ¶rÃ¼nÃ¼n varlÄ±ÄŸÄ±nÄ± kontrol eder.\"\"\"\n    os.makedirs(os.path.dirname(TRACKING_FILE), exist_ok=True)\n    if not os.path.exists(TRACKING_FILE):\n        with open(TRACKING_FILE, \"w\", encoding=\"utf-8\") as f:\n            json.dump([], f)\n\ndef log_event(event_type: str, data: Dict[str, Any], user_id: str = None):\n    \"\"\"\n    Kritik bir iÅŸlemi JSON dosyasÄ±na kaydeder.\n    \n    Args:\n        event_type: Ä°ÅŸlem tipi (Ã¶rn: 'CREATE_EVENT', 'USER_REGISTER', 'CHAT_MESSAGE')\n        data: Kaydedilecek veri iÃ§eriÄŸi\n        user_id: Ä°ÅŸlemi yapan kullanÄ±cÄ±nÄ±n ID'si (opsiyonel)\n    \"\"\"\n    ensure_tracking_file()\n    \n    log_entry = {\n        \"timestamp\": datetime.now().isoformat(),\n        \"event_type\": event_type,\n        \"user_id\": str(user_id) if user_id else \"anonymous\",\n        \"details\": data\n    }\n    \n    try:\n        with open(TRACKING_FILE, \"r+\", encoding=\"utf-8\") as f:\n            # DosyayÄ± oku\n            logs = json.load(f)\n            # Yeni kaydÄ± ekle\n            logs.append(log_entry)\n            # BaÅŸa dÃ¶n ve yaz\n            f.seek(0)\n            json.dump(logs, f, ensure_ascii=False, indent=4)\n            f.truncate()\n    except (json.JSONDecodeError, IOError):\n        # Dosya bozuksa veya okunamazsa yeniden oluÅŸtur\n        with open(TRACKING_FILE, \"w\", encoding=\"utf-8\") as f:\n            json.dump([log_entry], f, ensure_ascii=False, indent=4)\n\ndef log_api_request(method: str, path: str, status_code: int, client_ip: str, request_data: Any = None):\n    \"\"\"API isteklerini loglar.\"\"\"\n    # Sadece veri deÄŸiÅŸtiren (POST, PUT, DELETE) veya hatalÄ± istekleri loglayabiliriz\n    # Ya da tÃ¼m istekleri takip etmek istiyorsak filtre uyarlaabiliriz.\n    if method in [\"POST\", \"PUT\", \"DELETE\"] or status_code >= 400:\n        log_event(\"API_REQUEST\", {\n            \"method\": method,\n            \"path\": path,\n            \"status_code\": status_code,\n            \"client_ip\": client_ip,\n            \"payload\": request_data\n        })\n"
                }
            }
        }
    },
    "database": {
        "users": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "UUID",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "email",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "password",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "full_name",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "profile_image",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "phone_number",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "city",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 7,
                    "name": "is_verified",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 8,
                    "name": "student_document_url",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 9,
                    "name": "birth_date",
                    "type": "DATE",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 10,
                    "name": "gender",
                    "type": "VARCHAR(1)",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 11,
                    "name": "trust_score",
                    "type": "INTEGER",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 12,
                    "name": "wallet_balance",
                    "type": "NUMERIC(10, 2)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 13,
                    "name": "department",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 14,
                    "name": "bio",
                    "type": "TEXT",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 15,
                    "name": "favorite_music_url",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 16,
                    "name": "is_private",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 17,
                    "name": "ghost_mode",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 18,
                    "name": "show_way_to_everyone",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 19,
                    "name": "theme_preference",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 20,
                    "name": "language_preference",
                    "type": "VARCHAR(10)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 21,
                    "name": "data_saver_mode",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 22,
                    "name": "notify_event_reminders",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 23,
                    "name": "notify_campus_announcements",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 24,
                    "name": "notify_social",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 25,
                    "name": "current_latitude",
                    "type": "NUMERIC(10, 8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 26,
                    "name": "current_longitude",
                    "type": "NUMERIC(11, 8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 27,
                    "name": "last_location_update",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 28,
                    "name": "tc_no",
                    "type": "VARCHAR(11)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 29,
                    "name": "id_card_front_url",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 30,
                    "name": "id_card_back_url",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 31,
                    "name": "blue_tick_status",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 32,
                    "name": "is_email_verified",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 33,
                    "name": "is_phone_verified",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 34,
                    "name": "email_verification_code",
                    "type": "VARCHAR(6)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 35,
                    "name": "phone_verification_code",
                    "type": "VARCHAR(6)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 36,
                    "name": "password_reset_code",
                    "type": "VARCHAR(6)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 37,
                    "name": "student_document_barcode",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 38,
                    "name": "is_student_verified",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "icebreaker_questions": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "category",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "question_text",
                    "type": "TEXT",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "is_active",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "badges": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "name",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "icon_url",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "criteria_type",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "threshold",
                    "type": "INTEGER",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "campus_venues": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "name",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "latitude",
                    "type": "NUMERIC(10, 8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "longitude",
                    "type": "NUMERIC(11, 8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "address",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "discount_rate",
                    "type": "INTEGER",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "category",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 7,
                    "name": "is_active",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "events": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "UUID",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "host_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "title",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "description",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "date",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "location",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "latitude",
                    "type": "NUMERIC(10, 8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 7,
                    "name": "longitude",
                    "type": "NUMERIC(11, 8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 8,
                    "name": "min_age_limit",
                    "type": "INTEGER",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 9,
                    "name": "max_age_limit",
                    "type": "INTEGER",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 10,
                    "name": "target_gender",
                    "type": "VARCHAR(15)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 11,
                    "name": "status",
                    "type": "VARCHAR(10)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 12,
                    "name": "campus_restriction",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 13,
                    "name": "gender_restriction",
                    "type": "VARCHAR(10)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 14,
                    "name": "deposit_amount",
                    "type": "NUMERIC(10, 2)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 15,
                    "name": "session_token",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 16,
                    "name": "city",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 17,
                    "name": "campus",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 18,
                    "name": "category",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 19,
                    "name": "image_url",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 20,
                    "name": "external_url",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 21,
                    "name": "capacity",
                    "type": "INTEGER",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 22,
                    "name": "price",
                    "type": "NUMERIC(10, 2)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 23,
                    "name": "location_name",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "user_badges": {
            "schema": [
                {
                    "cid": 0,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "badge_id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 2
                },
                {
                    "cid": 2,
                    "name": "earned_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "messages": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "sender_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "receiver_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "content",
                    "type": "VARCHAR",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "timestamp",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "is_read",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "login_devices": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "device_name",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "last_login",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "ip_address",
                    "type": "VARCHAR(45)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "is_active",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "saved_cards": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "card_holder",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "last_four",
                    "type": "VARCHAR(4)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "card_type",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "card_token",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "card_user_key",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 7,
                    "name": "expiry_date",
                    "type": "VARCHAR(5)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "support_tickets": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "subject",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "message",
                    "type": "TEXT",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "status",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "transactions": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "amount",
                    "type": "NUMERIC(10, 2)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "payment_id",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "conversation_id",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "status",
                    "type": "VARCHAR(8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "transaction_type",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 7,
                    "name": "description",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 8,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "marketplace_items": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "owner_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "title",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "description",
                    "type": "TEXT",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "price",
                    "type": "NUMERIC(10, 2)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "category",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "image_url",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 7,
                    "name": "status",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 8,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "notifications": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "title",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "message",
                    "type": "TEXT",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "type",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "is_read",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "event_participants": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "event_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "status",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "payment_status",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "qr_scanned",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "check_in_time",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "user_reports": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "reporter_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "reported_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "event_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "reason",
                    "type": "VARCHAR(50)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "details",
                    "type": "TEXT",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "event_live_tracking": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "event_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "latitude",
                    "type": "NUMERIC(10, 8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "longitude",
                    "type": "NUMERIC(11, 8)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "status",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "transport_type",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 7,
                    "name": "last_updated",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "voice_rooms": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "event_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "room_token",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "is_active",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "expires_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "activity_chat_logs": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "event_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "question_id",
                    "type": "INTEGER",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "sent_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "event_likes": {
            "schema": [
                {
                    "cid": 0,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "event_id",
                    "type": "UUID",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 2
                },
                {
                    "cid": 2,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "user_reviews": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "reviewer_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "reviewed_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "event_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "rating",
                    "type": "INTEGER",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "comment",
                    "type": "TEXT",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "clubs": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "name",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "description",
                    "type": "TEXT",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "logo_url",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "is_official",
                    "type": "BOOLEAN",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "friendships": {
            "schema": [
                {
                    "cid": 0,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "friend_id",
                    "type": "UUID",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 2
                },
                {
                    "cid": 2,
                    "name": "status",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "event_moments": {
            "schema": [
                {
                    "cid": 0,
                    "name": "id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "event_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 2,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "media_url",
                    "type": "VARCHAR(255)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 4,
                    "name": "caption",
                    "type": "VARCHAR(100)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 5,
                    "name": "created_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 6,
                    "name": "expires_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        },
        "club_members": {
            "schema": [
                {
                    "cid": 0,
                    "name": "club_id",
                    "type": "INTEGER",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 1
                },
                {
                    "cid": 1,
                    "name": "user_id",
                    "type": "UUID",
                    "notnull": 1,
                    "dflt_value": null,
                    "pk": 2
                },
                {
                    "cid": 2,
                    "name": "role",
                    "type": "VARCHAR(20)",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                },
                {
                    "cid": 3,
                    "name": "joined_at",
                    "type": "DATETIME",
                    "notnull": 0,
                    "dflt_value": null,
                    "pk": 0
                }
            ],
            "row_count": 0,
            "data": []
        }
    },
    "api_documentation": [
        {
            "path": "/openapi.json",
            "name": "openapi",
            "methods": [
                "GET",
                "HEAD"
            ]
        },
        {
            "path": "/docs",
            "name": "swagger_ui_html",
            "methods": [
                "GET",
                "HEAD"
            ]
        },
        {
            "path": "/docs/oauth2-redirect",
            "name": "swagger_ui_redirect",
            "methods": [
                "GET",
                "HEAD"
            ]
        },
        {
            "path": "/redoc",
            "name": "redoc_html",
            "methods": [
                "GET",
                "HEAD"
            ]
        },
        {
            "path": "/uploads",
            "name": "uploads",
            "methods": []
        },
        {
            "path": "/data",
            "name": "data",
            "methods": []
        },
        {
            "path": "/images",
            "name": "images",
            "methods": []
        },
        {
            "path": "/login",
            "name": "login",
            "methods": [
                "POST"
            ],
            "description": "KullanÄ±cÄ± GiriÅŸi (Login)"
        },
        {
            "path": "/forgot-password",
            "name": "forgot_password",
            "methods": [
                "POST"
            ],
            "description": "Åifre sÄ±fÄ±rlama kodu gÃ¶nderir."
        },
        {
            "path": "/reset-password",
            "name": "reset_password",
            "methods": [
                "POST"
            ],
            "description": "Yeni ÅŸifreyi kaydeder."
        },
        {
            "path": "/events",
            "name": "read_events",
            "methods": [
                "GET"
            ],
            "description": "Etkinlikleri Listele (Konum Filtresi Destekli)"
        },
        {
            "path": "/events/auto-fetch",
            "name": "auto_fetch_events",
            "methods": [
                "POST"
            ],
            "description": "Otomatik Etkinlik Ã‡ek (SimÃ¼lasyon - Rastgele)"
        },
        {
            "path": "/events/fetch-external",
            "name": "fetch_external_events",
            "methods": [
                "GET"
            ],
            "description": "Belirtilen konuma gÃ¶re internetten etkinlikleri tarar ve veritabanÄ±na kaydeder.\nURL Parametresi: ?location=Antalya"
        },
        {
            "path": "/events",
            "name": "create_event",
            "methods": [
                "POST"
            ],
            "description": "Yeni Etkinlik OluÅŸtur"
        },
        {
            "path": "/chat/send",
            "name": "send_message",
            "methods": [
                "POST"
            ],
            "description": "HTTP Ã¼zerinden gÃ¼venli mesaj gÃ¶nderme.\n\"Yapay Zeka KorumasÄ±\" (Security Guard) buradan sorumlu."
        },
        {
            "path": "/ws/chat/{token}",
            "name": "websocket_endpoint",
            "methods": [],
            "description": "WebSocket Ã¼zerinden anlÄ±k mesajlaÅŸma.\nToken URL parametresi olarak alÄ±nÄ±r Ã§Ã¼nkÃ¼ WebSocket header desteklemez."
        },
        {
            "path": "/chat/history/{other_user_id}",
            "name": "get_history",
            "methods": [
                "GET"
            ],
            "description": "Belirli bir kiÅŸiyle olan tÃ¼m mesaj geÃ§miÅŸini getirir.\nMesajlar veritabanÄ±nda ÅŸifreli saklanÄ±r ancak bu endpointte Ã§Ã¶zÃ¼lerek (decrypted) gÃ¶nderilir."
        },
        {
            "path": "/api/location/update",
            "name": "update_location",
            "methods": [
                "POST"
            ],
            "description": "KullanÄ±cÄ± konumu gÃ¼ncelleme veya gizleme endpointi."
        },
        {
            "path": "/api/location/nearby",
            "name": "get_nearby_users",
            "methods": [
                "GET"
            ],
            "description": "Belirli bir konumun etrafÄ±ndaki kullanÄ±cÄ±larÄ± getirir (Radar)."
        },
        {
            "path": "/wallet/balance",
            "name": "get_balance",
            "methods": [
                "GET"
            ],
            "description": "Mevcut cÃ¼zdan bakiyesini getirir."
        },
        {
            "path": "/wallet/top-up",
            "name": "top_up_wallet",
            "methods": [
                "POST"
            ],
            "description": "CÃ¼zdana bakiye yÃ¼kler (SADECE DEBUG/TEST MODUNDA Ã‡ALIÅIR).\nProduction ortamÄ±nda Iyzico callback'leri kullanÄ±lmalÄ±dÄ±r."
        },
        {
            "path": "/wallet/withdraw",
            "name": "withdraw_money",
            "methods": [
                "POST"
            ],
            "description": "CÃ¼zdandan para Ã§eker."
        },
        {
            "path": "/reports/report-user",
            "name": "report_user",
            "methods": [
                "POST"
            ],
            "description": "Bir kullanÄ±cÄ±yÄ± ÅŸikayet eder. Åikayet edilenin gÃ¼ven puanÄ±nÄ± dÃ¼ÅŸÃ¼rÃ¼r."
        },
        {
            "path": "/reports/my-reports",
            "name": "get_my_reports",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n yaptÄ±ÄŸÄ± ÅŸikayetleri listeler."
        },
        {
            "path": "/gamification/badges",
            "name": "get_all_badges",
            "methods": [
                "GET"
            ],
            "description": "Sistemdeki tÃ¼m rozetleri listeler."
        },
        {
            "path": "/gamification/my-badges",
            "name": "get_user_badges",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n kazandÄ±ÄŸÄ± rozetleri listeler."
        },
        {
            "path": "/gamification/check-achievements",
            "name": "check_achievements",
            "methods": [
                "POST"
            ],
            "description": "KullanÄ±cÄ±nÄ±n yeni rozet kazanÄ±p kazanmadÄ±ÄŸÄ±nÄ± kontrol eder (Manuel tetikleme)."
        },
        {
            "path": "/settings/profile",
            "name": "update_profile",
            "methods": [
                "PUT"
            ],
            "description": "KullanÄ±cÄ±nÄ±n profil bilgilerini (isim, biyo, mÃ¼zik vb.) gÃ¼nceller."
        },
        {
            "path": "/settings/preferences",
            "name": "update_preferences",
            "methods": [
                "PUT"
            ],
            "description": "Gizlilik (Hayalet Mod) ve Uygulama (Tema, Dil) tercihlerini gÃ¼nceller."
        },
        {
            "path": "/settings/me",
            "name": "get_current_user_full",
            "methods": [
                "GET"
            ],
            "description": "Mevcut kullanÄ±cÄ±nÄ±n tÃ¼m ayar ve profil verilerini getirir."
        },
        {
            "path": "/activity/history",
            "name": "get_event_history",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n geÃ§miÅŸte katÄ±ldÄ±ÄŸÄ± (veya katÄ±lmadÄ±ÄŸÄ±) tÃ¼m etkinlikleri getirir."
        },
        {
            "path": "/activity/like/{event_id}",
            "name": "like_event",
            "methods": [
                "POST"
            ],
            "description": "Bir etkinliÄŸi beÄŸenir veya beÄŸeniyi geri Ã§eker."
        },
        {
            "path": "/activity/liked-events",
            "name": "get_liked_events",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n beÄŸendiÄŸi tÃ¼m etkinlikleri listeler."
        },
        {
            "path": "/support/tickets",
            "name": "create_ticket",
            "methods": [
                "POST"
            ],
            "description": "Yeni bir destek talebi (Hata bildirimi, ÅŸikayet vb.) oluÅŸturur."
        },
        {
            "path": "/support/tickets",
            "name": "get_my_tickets",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n geÃ§miÅŸ destek taleplerini listeler."
        },
        {
            "path": "/support/rules",
            "name": "get_community_rules",
            "methods": [
                "GET"
            ],
            "description": "Topluluk ve disiplin kurallarÄ±nÄ± getirir."
        },
        {
            "path": "/marketplace/items",
            "name": "create_item",
            "methods": [
                "POST"
            ],
            "description": "Yeni bir pazaryeri ilanÄ± (eÅŸya, kitap vb.) oluÅŸturur."
        },
        {
            "path": "/marketplace/items",
            "name": "list_items",
            "methods": [
                "GET"
            ],
            "description": "TÃ¼m aktif ilanlarÄ± listeler. Kategori filtresi eklenebilir."
        },
        {
            "path": "/marketplace/items/{item_id}",
            "name": "delete_item",
            "methods": [
                "DELETE"
            ],
            "description": "Ä°lanÄ± siler (Sahibi silebilir)."
        },
        {
            "path": "/marketplace/items/{item_id}/buy",
            "name": "buy_item",
            "methods": [
                "POST"
            ],
            "description": "Ä°lanÄ± satÄ±n alÄ±r (CÃ¼zdan bakiyesi ile)."
        },
        {
            "path": "/reviews",
            "name": "create_review",
            "methods": [
                "POST"
            ],
            "description": "Bir kullanÄ±cÄ± iÃ§in yorum ve puan (1-5) bÄ±rakÄ±r."
        },
        {
            "path": "/reviews/user/{user_id}",
            "name": "get_user_reviews",
            "methods": [
                "GET"
            ],
            "description": "Belirli bir kullanÄ±cÄ±ya yapÄ±lmÄ±ÅŸ tÃ¼m yorumlarÄ± getirir."
        },
        {
            "path": "/reviews/average/{user_id}",
            "name": "get_average_rating",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n ortalama puanÄ±nÄ± (Rating) dÃ¶ner."
        },
        {
            "path": "/payments/initialize-3ds",
            "name": "initialize_3ds",
            "methods": [
                "POST"
            ],
            "description": "3D Secure Ã¶demeyi baÅŸlatÄ±r ve banka onay sayfasÄ±na yÃ¶nelecek olan HTML/Form verisini dÃ¶ner."
        },
        {
            "path": "/payments/callback",
            "name": "payment_callback",
            "methods": [
                "POST"
            ],
            "description": "Iyzico 3DS doÄŸrulama sonrasÄ± bu endpoint'e POST atar.\nFlutter WebView bu adresi dinler."
        },
        {
            "path": "/payments/transactions",
            "name": "get_transactions",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n iÅŸlem geÃ§miÅŸini getirir."
        },
        {
            "path": "/venues",
            "name": "list_venues",
            "methods": [
                "GET"
            ],
            "description": "KampÃ¼s Ã§evresindeki indirimli mekanlarÄ± listeler."
        },
        {
            "path": "/venues",
            "name": "create_venue",
            "methods": [
                "POST"
            ],
            "description": "Yeni bir indirimli mekan ekler (Admin yetkisi gerektirir)."
        },
        {
            "path": "/interact/icebreaker/{event_id}",
            "name": "get_icebreaker_question",
            "methods": [
                "GET"
            ],
            "description": "Etkinlik sohbeti iÃ§in rastgele bir buz kÄ±rÄ±cÄ± (tanÄ±ÅŸma) sorusu getirir."
        },
        {
            "path": "/interact/voice-room/{event_id}",
            "name": "get_voice_room",
            "methods": [
                "GET"
            ],
            "description": "EtkinliÄŸe Ã¶zel sesli oda (Voice Room) bilgilerini getirir veya oluÅŸturur."
        },
        {
            "path": "/tracking/update-location",
            "name": "update_event_live_location",
            "methods": [
                "POST"
            ],
            "description": "KullanÄ±cÄ±nÄ±n etkinliÄŸe giderken canlÄ± konumunu gÃ¼nceller."
        },
        {
            "path": "/tracking/event-map/{event_id}",
            "name": "get_event_live_map",
            "methods": [
                "GET"
            ],
            "description": "EtkinliÄŸe giden tÃ¼m kullanÄ±cÄ±larÄ±n canlÄ± konumlarÄ±nÄ± getirir."
        },
        {
            "path": "/tracking/directions",
            "name": "get_route",
            "methods": [
                "GET"
            ],
            "description": "Google Maps API kullanarak iki nokta arasÄ±ndaki rotayÄ± (polyline) getirir."
        },
        {
            "path": "/tracking/ws/{event_id}/{token}",
            "name": "websocket_tracking",
            "methods": [],
            "description": "CanlÄ± takip haritasÄ± iÃ§in WebSocket baÄŸlantÄ±sÄ±.\nÄ°stemciler bu sokete baÄŸlanarak haritadaki hareketleri anlÄ±k izler."
        },
        {
            "path": "/api/upload/image",
            "name": "upload_image",
            "methods": [
                "POST"
            ],
            "description": "KullanÄ±cÄ± profili veya etkinlik iÃ§in resim yÃ¼kleme servisi.\nOtomatik sÄ±kÄ±ÅŸtÄ±rma ve gÃ¼venlik Ã¶nlemi iÃ§erir."
        },
        {
            "path": "/users/",
            "name": "create_user",
            "methods": [
                "POST"
            ],
            "description": "Yeni KullanÄ±cÄ± OluÅŸturma (KayÄ±t Ol)"
        },
        {
            "path": "/users/",
            "name": "read_users",
            "methods": [
                "GET"
            ],
            "description": "TÃ¼m kullanÄ±cÄ±larÄ± listele (KeÅŸfet EkranÄ± Ä°Ã§in)"
        },
        {
            "path": "/users/upload-profile",
            "name": "upload_profile_image",
            "methods": [
                "POST"
            ],
            "description": "Profil Resmi YÃ¼kleme"
        },
        {
            "path": "/users/verify/id-card",
            "name": "upload_id_card",
            "methods": [
                "POST"
            ],
            "description": "Kimlik KartÄ± YÃ¼kleme (GÃœVENLÄ° DEPOLAMA)\nDosyalar 'private_storage' altÄ±nda saklanÄ±r ve doÄŸrudan eriÅŸilemez."
        },
        {
            "path": "/users/verify/identity",
            "name": "verify_identity",
            "methods": [
                "POST"
            ],
            "description": "NVÄ° Ãœzerinden GerÃ§ek Kimlik DoÄŸrulama"
        },
        {
            "path": "/users/verify/student-document",
            "name": "verify_student_document",
            "methods": [
                "POST"
            ],
            "description": "E-Devlet Ã–ÄŸrenci Belgesi Barkod KontrolÃ¼"
        },
        {
            "path": "/verify/send-email-otp",
            "name": "send_email_otp",
            "methods": [
                "POST"
            ],
            "description": "E-posta doÄŸrulama kodu gÃ¶nderir (SMTP ile gerÃ§ek gÃ¶nderim)"
        },
        {
            "path": "/verify/email",
            "name": "verify_email",
            "methods": [
                "POST"
            ],
            "description": "E-posta doÄŸrulama kodunu kontrol eder"
        },
        {
            "path": "/verify/send-phone-otp",
            "name": "send_phone_otp",
            "methods": [
                "POST"
            ],
            "description": "Telefon doÄŸrulama kodu gÃ¶nderir (SMS API ile gerÃ§ek gÃ¶nderim)"
        },
        {
            "path": "/verify/phone",
            "name": "verify_phone",
            "methods": [
                "POST"
            ],
            "description": "Telefon doÄŸrulama kodunu kontrol eder"
        },
        {
            "path": "/me",
            "name": "get_current_user_profile",
            "methods": [
                "GET"
            ],
            "description": "Aktif kullanÄ±cÄ±nÄ±n tÃ¼m profil bilgilerini dÃ¶ner."
        },
        {
            "path": "/update-profile",
            "name": "update_profile",
            "methods": [
                "PATCH"
            ],
            "description": "KullanÄ±cÄ± profil bilgilerini (Bio, Ä°sim vb.) gÃ¼nceller."
        },
        {
            "path": "/update-settings",
            "name": "update_settings",
            "methods": [
                "PATCH"
            ],
            "description": "Uygulama tercihlerini (Tema, Gizlilik, Bildirimler) gÃ¼nceller."
        },
        {
            "path": "/change-password",
            "name": "change_password",
            "methods": [
                "POST"
            ],
            "description": "Aktif oturumda ÅŸifre deÄŸiÅŸtirme iÅŸlemi."
        },
        {
            "path": "/support-ticket",
            "name": "create_support_ticket",
            "methods": [
                "POST"
            ],
            "description": "Destek talebi oluÅŸturur."
        },
        {
            "path": "/notifications/",
            "name": "get_notifications",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n tÃ¼m bildirimlerini listeler."
        },
        {
            "path": "/notifications/{notification_id}/read",
            "name": "mark_as_read",
            "methods": [
                "POST"
            ],
            "description": "Bildirimi okundu olarak iÅŸaretler."
        },
        {
            "path": "/participants/join/{event_id}",
            "name": "join_event",
            "methods": [
                "POST"
            ],
            "description": "EtkinliÄŸe katÄ±lÄ±m isteÄŸi oluÅŸturur ve varsa kapora Ã¼cretini Ã§eker."
        },
        {
            "path": "/participants/scan-qr/{event_id}",
            "name": "scan_qr_code",
            "methods": [
                "POST"
            ],
            "description": "Etkinlik alanÄ±ndaki QR kodu okutarak katÄ±lÄ±mÄ± doÄŸrular (Turnike)."
        },
        {
            "path": "/participants/my-events",
            "name": "get_my_events",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n katÄ±ldÄ±ÄŸÄ± veya oluÅŸturduÄŸu etkinlikleri getirir."
        },
        {
            "path": "/participants/ticket/{event_id}",
            "name": "get_event_ticket",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±ya Ã¶zel, tek kullanÄ±mlÄ±k bilet token'Ä± (Access Key) oluÅŸturur."
        },
        {
            "path": "/participants/validate-ticket",
            "name": "validate_participant_ticket",
            "methods": [
                "POST"
            ],
            "description": "OrganizatÃ¶rÃ¼n (Host), katÄ±lÄ±mcÄ± biletini tarayÄ±p onaylamasÄ±nÄ± saÄŸlar."
        },
        {
            "path": "/participants/leave/{event_id}",
            "name": "leave_event",
            "methods": [
                "DELETE"
            ],
            "description": "KullanÄ±cÄ±nÄ±n etkinlikten ayrÄ±lmasÄ±nÄ± saÄŸlar (Ceza ProtokolÃ¼ dahil)."
        },
        {
            "path": "/security/change-password",
            "name": "change_password",
            "methods": [
                "POST"
            ],
            "description": "KullanÄ±cÄ±nÄ±n ÅŸifresini gÃ¼venli bir ÅŸekilde deÄŸiÅŸtirir."
        },
        {
            "path": "/security/devices",
            "name": "get_login_devices",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±nÄ±n hesabÄ±na giriÅŸ yapmÄ±ÅŸ olan cihazlarÄ± listeler."
        },
        {
            "path": "/security/devices/{device_id}",
            "name": "logout_device",
            "methods": [
                "DELETE"
            ],
            "description": "Belirli bir cihazÄ±n oturumunu sonlandÄ±rÄ±r (AktifliÄŸini kaldÄ±rÄ±r)."
        },
        {
            "path": "/clubs/",
            "name": "create_club",
            "methods": [
                "POST"
            ],
            "description": "Sadece sistem yÃ¶neticileri (veya authorized kullanÄ±cÄ±lar) kulÃ¼p kurabilir."
        },
        {
            "path": "/clubs/",
            "name": "list_clubs",
            "methods": [
                "GET"
            ]
        },
        {
            "path": "/clubs/{club_id}/join",
            "name": "join_club",
            "methods": [
                "POST"
            ]
        },
        {
            "path": "/clubs/{club_id}/members",
            "name": "get_club_members",
            "methods": [
                "GET"
            ]
        },
        {
            "path": "/social/friends/request",
            "name": "send_friend_request",
            "methods": [
                "POST"
            ]
        },
        {
            "path": "/social/friends/accept",
            "name": "accept_friend_request",
            "methods": [
                "POST"
            ]
        },
        {
            "path": "/social/moments",
            "name": "create_moment",
            "methods": [
                "POST"
            ]
        },
        {
            "path": "/social/moments/feed",
            "name": "get_moments_feed",
            "methods": [
                "GET"
            ]
        },
        {
            "path": "/intelligence/recommendations",
            "name": "get_recommendations",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±ya Ã¶zel AI tabanlÄ± etkinlik Ã¶nerileri sunar."
        },
        {
            "path": "/intelligence/moderate",
            "name": "moderate_content",
            "methods": [
                "POST"
            ],
            "description": "GÃ¶nderilen metnin gÃ¼venli olup olmadÄ±ÄŸÄ±nÄ± kontrol eder.\nFrontend giriÅŸlerinde veya yorumlarda kullanÄ±labilir."
        },
        {
            "path": "/search/",
            "name": "global_search",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ±lar, etkinlikler ve kulÃ¼pler arasÄ±nda arama yapar."
        },
        {
            "path": "/feed/home",
            "name": "get_home_feed",
            "methods": [
                "GET"
            ],
            "description": "KullanÄ±cÄ± iÃ§in Ã¶zelleÅŸtirilmiÅŸ ana sayfa akÄ±ÅŸÄ±nÄ± dÃ¶ner."
        },
        {
            "path": "/admin-api/verify-user/{user_id}",
            "name": "verify_user",
            "methods": [
                "POST"
            ],
            "description": "KullanÄ±cÄ±nÄ±n Ã¶ÄŸrenci belgesini manuel olarak onaylar."
        },
        {
            "path": "/admin-api/ban-user/{user_id}",
            "name": "ban_user",
            "methods": [
                "POST"
            ],
            "description": "KullanÄ±cÄ±yÄ± sistemden kÄ±sÄ±tlar (Trust score dÃ¼ÅŸÃ¼rÃ¼lÃ¼r)."
        },
        {
            "path": "/admin-api/system-stats",
            "name": "get_system_stats",
            "methods": [
                "GET"
            ],
            "description": "Sistemin canlÄ± istatistiklerini dÃ¶ner."
        },
        {
            "path": "/",
            "name": "read_root",
            "methods": [
                "GET",
                "HEAD"
            ]
        },
        {
            "path": "/dashboard",
            "name": "get_dashboard",
            "methods": [
                "GET"
            ]
        },
        {
            "path": "/admin",
            "name": "get_admin",
            "methods": [
                "GET"
            ]
        }
    ]
}